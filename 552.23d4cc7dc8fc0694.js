"use strict";(self.webpackChunkmeddler_genz_ui=self.webpackChunkmeddler_genz_ui||[]).push([[552],{2552:(Fl,jo,G)=>{G.r(jo),G.d(jo,{MednetModule:()=>Rl});var A=G(1368),ti=G(6588),yr=G(4025),o=G(4496);class ct{constructor(i,t,e,s,r){this.center=i,this.radiusX=t,this.radiusY=e,this.startAngle=s,this.endAngle=r}}class u{static castToPoint(i){return i||u.initialize()}static initialize(i=0,t=0){return{x:i,y:t}}static copy(i){return u.initialize(i.x,i.y)}static isEqual(i,t){return i.x===t.x&&i.y===t.y}static sum(i,t){return{x:i.x+t.x,y:i.y+t.y}}static sub(i,t){return{x:i.x-t.x,y:i.y-t.y}}static div(i,t){return{x:i.x/t,y:i.y/t}}static mult(i,t){return{x:i.x*t,y:i.y*t}}static interpolatePoints(i,t,e){const s=1-e;return u.initialize(i.x*s+t.x*e,i.y*s+t.y*e)}static roundTo(i,t){return{x:Math.trunc(i.x/t)*t,y:Math.trunc(i.y/t)*t}}static hypotenuse(i,t){const e=t.x-i.x,s=t.y-i.y;return Math.abs(Math.sqrt(e*e+s*s))}static distance(i,t){const e=i.x-t.x,s=i.y-t.y;return Math.sqrt(e*e+s*s)}static getMinimum(i,t){return u.initialize(Math.min(i.x,t.x),Math.min(i.y,t.y))}static getMaximum(i,t){return u.initialize(Math.max(i.x,t.x),Math.max(i.y,t.y))}static matrixTransform(i,t){let e=u.initialize(i.x,i.y),s=t.getScreenCTM();if(s){const r=t.createSVGPoint();r.x=i.x,r.y=i.y,e=r.matrixTransform(s.inverse())}return e}static elementTransform(i,t){let e=u.initialize(i.x,i.y),s=t.getBoundingClientRect();return e=u.sub(e,u.initialize(s.left,s.top)),e}}class C{constructor(i=0,t=0){this.x=i,this.y=t}static fromPoint(i){return new C(i.x,i.y)}add(i){const t=u.sum(this,i);return C.fromPoint(t)}sub(i){const t=u.sub(this,i);return C.fromPoint(t)}subNumber(i){const t=u.sub(this,new C(i,i));return C.fromPoint(t)}div(i){const t=u.div(this,i);return C.fromPoint(t)}mult(i){const t=u.mult(this,i);return C.fromPoint(t)}matrixTransform(i){const t=u.matrixTransform(this,i);return C.fromPoint(t)}elementTransform(i){const t=u.elementTransform(this,i);return C.fromPoint(t)}}class ei{static initialize(i=u.initialize(),t=u.initialize()){return{point1:i,point2:t}}static copy(i){return{point1:i.point1,point2:i.point2}}static hypotenuse(i){return Math.sqrt(Math.pow(i.point1.x-i.point2.x,2)+Math.pow(i.point1.y-i.point2.y,2))}}class dt{constructor(i,t){this.point1=i,this.point2=t}}class p{static initialize(i=0,t=0,e=0,s=0){return e<0&&(i+=e,e=-e),s<0&&(t+=s,s=-s),{x:i,y:t,width:e,height:s,gravityCenter:u.initialize(i+e/2,t+s/2)}}static copy(i){return p.initialize(i.x,i.y,i.width,i.height)}static fromElement(i){const{x:t,y:e,width:s,height:r}=i.getBoundingClientRect();return p.initialize(t,e,s,r)}static isIncludePoint(i,t){return t.x>=p.left(i)&&t.x<=p.right(i)&&t.y>=p.top(i)&&t.y<=p.bottom(i)}static intersectionWithRect(i,t){return!(i.x+i.width<t.x||t.x+t.width<i.x||i.y+i.height<t.y||t.y+t.height<i.y)}static left(i){return i.x}static top(i){return i.y}static right(i){return i.x+i.width}static bottom(i){return i.y+i.height}static addPoint(i,t){const e=p.copy(i);return e.x+=t.x,e.y+=t.y,this.initialize(e.x,e.y,e.width,e.height)}static mult(i,t){const e=p.copy(i);return e.x*=t,e.y*=t,e.width*=t,e.height*=t,this.initialize(e.x,e.y,e.width,e.height)}static div(i,t){const e=p.copy(i);return e.x/=t,e.y/=t,e.width/=t,e.height/=t,this.initialize(e.x,e.y,e.width,e.height)}static addPointToSize(i,t){const e=p.copy(i);return e.width+=t.x,e.height+=t.y,this.initialize(e.x,e.y,e.width,e.height)}static union(i){return i&&0!==i.length?i.reduce((t,e)=>{const s=Math.min(t.x,e.x),r=Math.min(t.y,e.y),a=Math.max(t.x+t.width,e.x+e.width),c=Math.max(t.y+t.height,e.y+e.height);return p.initialize(s,r,a-s,c-r)},i[0]):null}static elementTransform(i,t){const e=t.getBoundingClientRect(),s=u.sub(i,u.initialize(e.left,e.top));return p.initialize(s.x,s.y,i.width,i.height)}static updateIsNotFinite(i){return Number.isFinite(i.width)&&Number.isFinite(i.height)&&Number.isFinite(i.x)&&Number.isFinite(i.y)?i:p.initialize(0,0,0,0)}}class _{constructor(i=0,t=0,e=0,s=0,r=0,a=0,c=0,g=0){this.x=i,this.y=t,this.width=e,this.height=s,this.radius1=r,this.radius2=a,this.radius3=c,this.radius4=g,this.gravityCenter=u.initialize(),this.gravityCenter=this.calculateGravityCenter(this)}calculateGravityCenter(i){return new C(i.x+i.width/2,i.y+i.height/2)}static fromRect(i){return new _(i.x,i.y,i.width,i.height)}static fromRoundedRect(i){return new _(i.x,i.y,i.width,i.height,i.radius1,i.radius2,i.radius3,i.radius4)}addPoint(i){const t=_.fromRoundedRect(this);return t.x+=i.x,t.y+=i.y,t.gravityCenter=this.calculateGravityCenter(t),t}}class ft{static initialize(i=0,t=0){return{width:i,height:t}}}class j{static toString(i){const t=u.sum(i.position,i.scaledPosition);return`matrix(${i.scale}, 0, 0, ${i.scale}, ${t.x}, ${t.y})`}static fromString(i){return function Rr(n){let i;if(n){const t=(n=(n=n.replace("matrix(","")).replace(")","")).split(" ");i={position:{x:Number(t[4]),y:Number(t[5])},scaledPosition:u.initialize(),scale:Number(t[0]),rotate:0}}return i}(i)}static default(){return function Nr(){return{position:u.initialize(),scaledPosition:u.initialize(),scale:1,rotate:0}}()}}class E{static initialize(i=0,t=0){return u.initialize(i,t)}static fromPoints(i,t){return E.initialize(t.x-i.x,t.y-i.y)}static vectorLength(i){return Math.sqrt(E.magnitudeSquared(i))}static magnitudeSquared(i){return i.x*i.x+i.y*i.y}static dotProduct(i,t){return i.x*t.x+i.y*t.y}static crossProduct(i,t){return i.x*t.y-i.y*t.x}static subtract(i,t){return E.initialize(i.x-t.x,i.y-t.y)}static add(i,t){return E.initialize(i.x+t.x,i.y+t.y)}static scale(i,t){return E.initialize(i.x*t,i.y*t)}static angle(i,t){const e=Math.acos(Math.max(-1,Math.min(E.dotProduct(i,t)/(E.vectorLength(i)*E.vectorLength(t)),1)));return E.crossProduct(i,t)<0?-e:e}}class Pr{static parseRoundedRect(i){const t=.5*Math.PI,e=i.x,s=i.y,r=i.x+i.width,a=i.y+i.height,c=i.x+i.radius1,g=i.y+i.radius1,m=i.x+i.width-i.radius2,x=i.y+i.radius2,S=i.x+i.width-i.radius3,R=i.y+i.height-i.radius3,M=i.x+i.radius4,I=i.y+i.height-i.radius4;return[new ct({x:c,y:g},i.radius1,i.radius1,2*t,3*t),new dt({x:c,y:s},{x:m,y:s}),new ct({x:m,y:x},i.radius2,i.radius2,3*t,4*t),new dt({x:r,y:x},{x:r,y:R}),new ct({x:S,y:R},i.radius3,i.radius3,0,t),new dt({x:S,y:a},{x:M,y:a}),new ct({x:M,y:I},i.radius4,i.radius4,t,2*t),new dt({x:e,y:I},{x:e,y:g})]}}class ao{static getRoundedRectIntersections(i,t,e){const s=Pr.parseRoundedRect(e);for(const r of s)if(r instanceof ct){const a=this.intersectArcWithLine(r,i,t);if(a.length>0)return a}else if(r instanceof dt){const a=this.intersectLineSegments(i,t,r.point1,r.point2);if(a)return[a]}return[]}static getRoundedRectIntersectionsWithSVGPath(i,t){const e=i.getTotalLength(),s=[];for(let r=0;r<=e;r+=1){const a=i.getPointAtLength(r);s.push({x:a.x,y:a.y})}for(let r=1;r<s.length;r++){const a=this.getRoundedRectIntersections(s[r-1],s[r],t);if(a.length>0)return a}return[]}static intersectArcWithLine(i,t,e){return this.filterPointsWithinArc(this.findEllipseLineIntersections(i.center,i.radiusX,i.radiusY,t,e),i)}static intersectLineSegments(i,t,e,s){const r=t.x-i.x,a=t.y-i.y,c=s.x-e.x,g=s.y-e.y,m=(-a*(i.x-e.x)+r*(i.y-e.y))/(-c*a+r*g),x=(c*(i.y-e.y)-g*(i.x-e.x))/(-c*a+r*g);return m>=0&&m<=1&&x>=0&&x<=1?{x:i.x+x*r,y:i.y+x*a}:null}static filterPointsWithinArc(i,t){let{center:e,startAngle:s,endAngle:r}=t;if(0===i.length)return i;r<s&&([s,r]=[r,s]),(s<0||r<0)&&(s+=2*Math.PI,r+=2*Math.PI);const a=[];for(const c of i){let g=this.normalizeAngle(E.angle(E.initialize(1,0),E.initialize(c.x-e.x,c.y-e.y)));g<s&&(g+=2*Math.PI),s<=g&&g<=r&&a.push(c)}return a}static normalizeAngle(i){const t=i%(2*Math.PI);return t<0?t+2*Math.PI:t}static findEllipseLineIntersections(i,t,e,s,r){const a=E.initialize(s.x,s.y),c=E.fromPoints(s,r),g=E.initialize(i.x,i.y),m=E.subtract(a,g),x=E.initialize(c.x/(t*t),c.y/(e*e)),S=E.initialize(m.x/(t*t),m.y/(e*e)),R=E.dotProduct(c,x),M=E.dotProduct(c,S),st=M*M-R*(E.dotProduct(m,S)-1);return st<0?[]:this.calculateIntersectionPoints(st,R,M,s,r)}static calculateIntersectionPoints(i,t,e,s,r){const a=[];if(i>0){const c=Math.sqrt(i),g=(-e-c)/t,m=(-e+c)/t;g>=0&&g<=1&&a.push(u.interpolatePoints(s,r,g)),m>=0&&m<=1&&a.push(u.interpolatePoints(s,r,m))}else{const c=-e/t;c>=0&&c<=1&&a.push(u.interpolatePoints(s,r,c))}return a}}var d=G(1316);class Fr{handle(i,t){let e=!0;if(this.validator&&(e=t.get(this.validator).handle(i)),e)return t.get(this.execution).handle(i)}execute(i,t){return t.get(this.execution).handle(i)}setValidator(i){this.validator=i}setExecution(i){this.execution=i}}class h{constructor(i){this.injector=i}static registerPipeline(i,t,e){const s=this.pipelines.get(i.name)||new Fr;e?s.setValidator(t):s.setExecution(t),this.pipelines.set(i.name,s)}send(i){const t=h.pipelines.get(i.constructor.name);if(t)return t.handle(i,this.injector);throw new Error("Handler not registered for request type.")}execute(i){return h.pipelines.get(i.constructor.name).execute(i,this.injector)}}function f(n){return function(i){h.registerPipeline(n,i,!1)}}function P(n){return function(i){h.registerPipeline(n,i,!0)}}h.pipelines=new Map,h.\u0275fac=function(i){return new(i||h)(o.CoB(o.zZn))},h.\u0275prov=o.wxM({token:h,factory:h.\u0275fac});let br=(()=>{class n{setItem(t,e){localStorage.setItem(t,e)}getItem(t){return localStorage.getItem(t)}removeItem(t){localStorage.removeItem(t)}clear(){localStorage.clear()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Or=(()=>{class n{storage={};setItem(t,e){this.storage[t]=e}getItem(t){return this.storage[t]||null}removeItem(t){delete this.storage[t]}clear(){this.storage={}}static \u0275fac=function(e){return new(e||n)};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Tr=new o.UbH("F_LOCAL_STORAGE",{providedIn:"root",factory:()=>(0,A.c0)((0,o.uUt)(o.AHE))?(0,o.uUt)(br):(0,o.uUt)(Or)});let Ar=(()=>{class n{getComputedStyle(t){return window.getComputedStyle(t)}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get pageXOffset(){return window.pageXOffset}get pageYOffset(){return window.pageYOffset}isMediaQuery(t){return window.matchMedia(t).matches}requestAnimationFrame(t){return window.requestAnimationFrame(t)}get location(){return window.location}open(t,e,s){window.open(t,e,s)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Br=(()=>{class n{getComputedStyle(t){return new Proxy({getPropertyValue:e=>"0"},{get:(e,s)=>"getPropertyValue"===s?e.getPropertyValue:"0"})}get innerWidth(){return 0}get innerHeight(){return 0}get pageXOffset(){return 0}get pageYOffset(){return 0}isMediaQuery(t){return!1}requestAnimationFrame(t){return setTimeout(t,0)}get location(){return{href:"",pathname:"",search:"",hash:"",origin:""}}open(t,e,s){}static \u0275fac=function(e){return new(e||n)};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const Ur=new o.UbH("F_WINDOW",{providedIn:"root",factory:()=>(0,A.c0)((0,o.uUt)(o.AHE))?(0,o.uUt)(Ar):(0,o.uUt)(Br)});var q=function(n){return n.MAC_OS="macos",n.IOS="ios",n.WINDOWS="windows",n.ANDROID="android",n.LINUX="linux",n}(q||{});let co;try{co=typeof Intl<"u"&&Intl.v8BreakIterator}catch{co=!1}let oi=(()=>{class n{_platformId;isBrowser=!1;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!(!window.chrome&&!co)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(t){this._platformId=t,this.isBrowser=this._platformId?(0,A.c0)(this._platformId):"object"==typeof document&&!!document}getOS(){let r,t=navigator.userAgent.toLowerCase();return/(macintosh|macintel|macppc|mac68k|macos)/i.test(t)?r=q.MAC_OS:this.IOS?r=q.IOS:/(win32|win64|windows|wince)/i.test(t)?r=q.WINDOWS:this.ANDROID?r=q.ANDROID:!r&&/linux/.test(t)&&(r=q.LINUX),r}static \u0275fac=function(e){return new(e||n)(o.CoB(o.AHE))};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),y=(()=>{class n{injectedDocument;windowService;localStorageService;platformService;constructor(t,e,s,r){this.injectedDocument=t,this.windowService=e,this.localStorageService=s,this.platformService=r}isBrowser(){return this.platformService.isBrowser}get window(){return this.windowService}get localStorage(){return this.localStorageService}get document(){return this.injectedDocument}toPixels(t,e,s,r){if(t.endsWith("px"))return parseFloat(t);if(t.endsWith("%")){const a=parseFloat(t)/100;return Math.max(e,s)*a}if(t.endsWith("em"))return parseFloat(t)*parseFloat(r);if(t.endsWith("rem"))return parseFloat(t)*parseFloat(getComputedStyle(this.document.documentElement).fontSize);if(t.endsWith("vh")){const a=this.window.innerHeight/100;return parseFloat(t)*a}if(t.endsWith("vw")){const a=this.window.innerWidth/100;return parseFloat(t)*a}return parseFloat(t)||0}static \u0275fac=function(e){return new(e||n)(o.CoB(A.Ud),o.CoB(Ur),o.CoB(Tr),o.CoB(oi))};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ii(n,i){return n.reduce((t,e)=>[...t,...i(e)],[])}function si(n,i,t,e){const s=i.querySelectorAll(n);if(s.length){const r=t.querySelectorAll(n);for(let a=0;a<s.length;a++)e(s[a],r[a])}}let Gr=0;function ri(n,i){"file"!==i.type&&(i.value=n.value),"radio"===i.type&&i.name&&(i.name=`mat-clone-${i.name}-${Gr++}`)}function ai(n,i){const t=i.getContext("2d");if(t)try{t.drawImage(n,0,0)}catch{}}function ci(n,i){const t=function Hr(n,i){return n.closest(i)}(n,i);return!!t&&!t.classList.contains(i+"-disabled")}function B(n){return n.match(/^[a-zA-Z_]/)||(n="_"+n),n.replace(/[^a-zA-Z0-9_\-:.]/g,"_")}function tt(n,i,t){const e=t[n.toUpperCase()]||function Wr(n,i){return Object.keys(n).find(t=>n[t]===i)}(t,n.toLowerCase());if(void 0===e)throw new Error(`Unknown ${i}: ${n}. Accepted values: ${Object.keys(t).join(", ")}`);return e}class ht{constructor(i,t){this.event=i,this.target=t,this.event=i}get originalEvent(){return this.event}get targetElement(){return this.target||this.originalEvent.target}setTarget(i){this.target=i}preventDefault(){this.originalEvent.preventDefault()}get isEventInLockedContext(){return null!==this.targetElement.closest("[fLockedContext]")}}class fo extends ht{constructor(i,t){super(i,t)}isMouseLeftButton(){return 0===this.originalEvent.button}isMouseRightButton(){return 2===this.originalEvent.buttons}getPosition(){return{x:this.originalEvent.clientX,y:this.originalEvent.clientY}}}class qr extends ht{constructor(i){super(i)}isMouseLeftButton(){return!0}isMouseRightButton(){return!1}getPosition(){return{x:this.originalEvent.touches[0].clientX,y:this.originalEvent.touches[0].clientY}}}class Xr extends ht{constructor(i,t){super(i,t)}isMouseLeftButton(){return!0}isMouseRightButton(){return!1}getPosition(){return{x:this.originalEvent.targetTouches[0].clientX,y:this.originalEvent.targetTouches[0].clientY}}}class Zr extends ht{constructor(i){super(i)}isMouseLeftButton(){return!0}isMouseRightButton(){return!1}getPosition(){return{x:this.originalEvent.changedTouches[0].clientX,y:this.originalEvent.changedTouches[0].clientY}}}class w{static isPassiveEventListenerSupported(){if(null==w.isSupported&&typeof window<"u")try{window.addEventListener("test",w.emptyListener,{passive:!0}),w.isSupported=!0}catch{w.isSupported=!1}return w.isSupported}static passiveEventListener(i){return w.isPassiveEventListenerSupported()?i:!!i.capture}static activeListener(){return w.passiveEventListener({passive:!1})}static passiveListener(){return w.passiveEventListener({passive:!0})}static emptyListener(){return()=>{}}}class Kr{constructor(i){this.ngZone=i,this.mouseListeners=w.emptyListener(),this.touchListeners=w.emptyListener(),this.startListeners=w.emptyListener(),this.lastTouchEventTime=0,this.isDragStarted=!1,this.dragStartThreshold=3,this.dragStartDelay=0,this.dragStartTime=0,this.dragStartPosition={x:0,y:0},this.moveHandler=this.checkDragSequenceToStart,this.pointerDownElement=null,this.onMouseDown=t=>{var e;const s=this.isSyntheticEvent(t),r=function Jr(n){return 0===n.buttons||0===n.offsetX&&0===n.offsetY}(t),a=new fo(t);this.pointerDownElement=a.targetElement,s||r||this.disabled||this.onPointerDown(a)&&(this.dragStartTime=Date.now(),this.dragStartPosition=a.getPosition(),null===(e=this.ngZone)||void 0===e||e.runOutsideAngular(()=>{var g,m,x;null===(g=this.document)||void 0===g||g.addEventListener("selectstart",this.onSelectStart,w.activeListener()),null===(m=this.document)||void 0===m||m.addEventListener("mousemove",this.onMouseMove),null===(x=this.document)||void 0===x||x.addEventListener("mouseup",this.onMouseUp)}),this.mouseListeners=()=>{var g,m,x;null===(g=this.document)||void 0===g||g.removeEventListener("selectstart",this.onSelectStart,w.activeListener()),null===(m=this.document)||void 0===m||m.removeEventListener("mousemove",this.onMouseMove),null===(x=this.document)||void 0===x||x.removeEventListener("mouseup",this.onMouseUp)})},this.onTouchDown=t=>{var e;const s=function jr(n){const i=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0];return!(!i||-1!==i.identifier||null!=i.radiusX&&1!==i.radiusX||null!=i.radiusY&&1!==i.radiusY)}(t),r=new qr(t);this.pointerDownElement=r.targetElement,s||this.disabled||this.onPointerDown(r)&&(this.dragStartTime=Date.now(),this.dragStartPosition=r.getPosition(),null===(e=this.ngZone)||void 0===e||e.runOutsideAngular(()=>{var c,g,m;null===(c=this.document)||void 0===c||c.addEventListener("selectstart",this.onSelectStart,w.activeListener()),null===(g=this.document)||void 0===g||g.addEventListener("touchmove",this.onTouchMove),null===(m=this.document)||void 0===m||m.addEventListener("touchend",this.onTouchUp)}),this.touchListeners=()=>{var c,g,m;null===(c=this.document)||void 0===c||c.removeEventListener("selectstart",this.onSelectStart,w.activeListener()),null===(g=this.document)||void 0===g||g.removeEventListener("touchmove",this.onTouchMove),null===(m=this.document)||void 0===m||m.removeEventListener("touchend",this.onTouchUp)})},this.onSelectStart=t=>{this.onSelect(t)},this.onMouseMove=t=>{this.moveHandler(new fo(t))},this.onTouchMove=t=>{this.moveHandler(new Xr(t))},this.onMouseUp=t=>{this.isDragStarted&&this.onPointerUp(new fo(t)),this.endDragSequence()},this.onTouchUp=t=>{this.isDragStarted&&this.onPointerUp(new Zr(t)),this.endDragSequence()}}isSyntheticEvent(i){return!!this.lastTouchEventTime&&this.lastTouchEventTime+800>Date.now()}checkDragSequenceToStart(i){const t=i.getPosition();if(!this.isDragStarted&&this.pointerDownElement&&(i.setTarget(this.pointerDownElement),Math.abs(t.x-this.dragStartPosition.x)+Math.abs(t.y-this.dragStartPosition.y)>=this.dragStartThreshold)){if(!(Date.now()>=this.dragStartTime+this.dragStartDelay))return void this.endDragSequence();i.preventDefault(),this.prepareDragSequence(i),this.isDragStarted=!0,this.moveHandler=this.onPointerMove,function Qr(n){return"t"===n.type[0]}(i.originalEvent)&&(this.lastTouchEventTime=Date.now())}}endDragSequence(){this.isDragStarted=!1,this.pointerDownElement=null,this.moveHandler=this.checkDragSequenceToStart,this.mouseListeners(),this.mouseListeners=w.emptyListener(),this.touchListeners(),this.touchListeners=w.emptyListener(),this.finalizeDragSequence()}subscribe(i){var t;this.document&&this.unsubscribe(),this.document=i,null===(t=this.ngZone)||void 0===t||t.runOutsideAngular(()=>{i.addEventListener("mousedown",this.onMouseDown,w.activeListener()),i.addEventListener("touchstart",this.onTouchDown,w.passiveListener())}),this.startListeners=()=>{i.removeEventListener("mousedown",this.onMouseDown,w.activeListener()),i.removeEventListener("touchstart",this.onTouchDown,w.passiveListener())}}unsubscribe(){this.startListeners(),this.startListeners=w.emptyListener(),this.touchListeners(),this.touchListeners=w.emptyListener(),this.mouseListeners(),this.mouseListeners=w.emptyListener()}}const ta=["f-connection-text",""],ea=["f-connection-drag-handle",""],na=["fConnectionGradient",""],oa=["f-connection-path",""],ia=["fConnectionSelection",""],lo=["defs"],uo=["fConnectionCenter"],ho=["*",[["","fConnectionCenter",""]]],go=["*","[fConnectionCenter]"];function ra(n,i){1&n&&(o.S2Z(),o.gRP(),o.I0R(0,"div",9,10),o._Xx(2,1),o.C$Y())}const da=["fGroupsContainer"],fa=["fNodesContainer"],la=["fConnectionsContainer"],ua=[[["","fGroup",""]],[["f-snap-connection"]],[["f-connection"]],[["f-connection-for-create"]],[["","fNode",""]]],ha=["[fGroup]","f-snap-connection","f-connection","f-connection-for-create","[fNode]"],ga=[[["","fDefinitions",""]],[["f-background"]],[["f-line-alignment"]],[["f-canvas"]],[["f-selection-area"]],[["f-minimap"]]],pa=["[fDefinitions]","f-background","f-line-alignment","f-canvas","f-selection-area","f-minimap"];new o.UbH("F_BACKGROUND_PATTERN");class fi{element;constructor(i){this.element=i}}let ma=(()=>{let n=class bt{_fBrowser=(0,o.uUt)(y);handle(t){return this._getRoundedRect(p.fromElement(t.element),t.element,this._getComputedStyle(t.element))}_getRoundedRect(t,e,s){return new _(t.x,t.y,t.width,t.height,this._toPixels(s.borderTopLeftRadius,e,s.fontSize),this._toPixels(s.borderTopRightRadius,e,s.fontSize),this._toPixels(s.borderBottomRightRadius,e,s.fontSize),this._toPixels(s.borderBottomLeftRadius,e,s.fontSize))}_getComputedStyle(t){return this._fBrowser.window.getComputedStyle(t)}_toPixels(t,e,s){return this._fBrowser.toPixels(t,e.clientWidth,e.clientHeight,s)||0}static \u0275fac=function(e){return new(e||bt)};static \u0275prov=o.wxM({token:bt,factory:bt.\u0275fac})};return n=(0,d.UN)([f(fi)],n),n})();class li{fBackground;constructor(i){this.fBackground=i}}class et{}let Ca=(()=>{let n=class Ot{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.dataChanged()}static \u0275fac=function(e){return new(e||Ot)};static \u0275prov=o.wxM({token:Ot,factory:Ot.\u0275fac})};return n=(0,d.UN)([f(et)],n),n})();class ui{}function gt(n){let i;return t=>()=>{clearTimeout(i),i=setTimeout(()=>t(),n)}}class X{_listeners=new Set;notify(){this._listeners.forEach(i=>i())}listen(i){return this._listeners.add(i),()=>this.stop(i)}stop(i){this._listeners.delete(i)}}class va extends X{_htmlElement;_observer=new ResizeObserver(()=>this.notify());_isObserving=!1;constructor(i){super(),this._htmlElement=i}listen(i){return this._isObserving||(this._observer.observe(this._htmlElement),this._isObserving=!0),super.listen(i)}stop(i){super.stop(i),0===this._listeners.size&&this._disconnect()}_disconnect(){this._observer.unobserve(this._htmlElement),this._observer.disconnect(),this._isObserving=!1}}class L{_channels=[];_operators=[];constructor(...i){this._channels=[...i]}pipe(...i){const t=new L(...this._channels);return t._operators=[...this._operators,...i],t}listen(i,t){let e=t;this._operators.forEach(r=>{e=r(e)});const s=this._channels.map(r=>r.listen(()=>e()));i.onDestroy(()=>{s.forEach(r=>r())})}}let xa=(()=>{let n=class Tt{_fComponentsStore=(0,o.uUt)(l);handle(t){return new L(this._fComponentsStore.dataChanges$).pipe(n=>(n(),n),gt(1))}static \u0275fac=function(e){return new(e||Tt)};static \u0275prov=o.wxM({token:Tt,factory:Tt.\u0275fac})};return n=(0,d.UN)([f(ui)],n),n})();class hi{}let Da=(()=>{let n=class At{_fComponentsStore=(0,o.uUt)(l);handle(t){return new L(this._fComponentsStore.countChanges$).pipe(n=>(n(),n),gt(1))}static \u0275fac=function(e){return new(e||At)};static \u0275prov=o.wxM({token:At,factory:At.\u0275fac})};return n=(0,d.UN)([f(hi)],n),n})();class gi{}let Sa=(()=>{let n=class Bt{_fComponentsStore=(0,o.uUt)(l);handle(t){return new L(this._fComponentsStore.transformChanges$,this._fComponentsStore.dataChanges$,this._fComponentsStore.countChanges$)}static \u0275fac=function(e){return new(e||Bt)};static \u0275prov=o.wxM({token:Bt,factory:Bt.\u0275fac})};return n=(0,d.UN)([f(gi)],n),n})();class ot{}let l=(()=>{class n{transformChanges$=new X;dataChanges$=new X;countChanges$=new X;get flowHost(){return this.fFlow?.hostElement}fFlow;fCanvas;fBackground;fNodes=[];fConnections=[];fTempConnection;fSnapConnection;fMarkers=[];fOutputs=[];fInputs=[];fOutlets=[];fDraggable;fLineAlignment;addComponent(t,e){t.push(e),this.countChanged()}removeComponent(t,e){const s=t.indexOf(e);s>-1&&(t.splice(s,1),this.countChanged())}countChanged(){this.countChanges$.notify()}dataChanged(){this.dataChanges$.notify()}transformChanged(){this.transformChanges$.notify()}static \u0275fac=function(e){return new(e||n)};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac})}return n})();const wa=[Ca,Da,xa,Sa,(()=>{let n=class Ut{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.transformChanged()}static \u0275fac=function(e){return new(e||Ut)};static \u0275prov=o.wxM({token:Ut,factory:Ut.\u0275fac})};return n=(0,d.UN)([f(ot)],n),n})(),l];let Ea=(()=>{let n=class zt{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fBackground=t.fBackground}static \u0275fac=function(e){return new(e||zt)};static \u0275prov=o.wxM({token:zt,factory:zt.\u0275fac})};return n=(0,d.UN)([f(li)],n),n})();class pi{fPattern;constructor(i){this.fPattern=i}}let ya=0,Ma=(()=>{let n=class Gt{fComponentsStore;fBrowser;get fBackground(){return this.fComponentsStore.fBackground}constructor(t,e){this.fComponentsStore=t,this.fBrowser=e}handle(t){const e=t.fPattern?.hostElement.getElementsByTagName("pattern")||[],s=e.length?e[0]:void 0;if(s){const r=W("defs",this.fBrowser);s.id="f-background-pattern-"+ya++,t.fPattern?.hostElement.remove(),r.appendChild(s),this.fBackground.hostElement?.firstChild?.appendChild(r);const a=W("rect",this.fBrowser);a.setAttribute("fill","url(#"+s.id+")"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),this.fBackground.hostElement.firstChild?.appendChild(a);const c=this.fComponentsStore.fCanvas?.transform||j.default();t.fPattern?.setTransform(c)}}static \u0275fac=function(e){return new(e||Gt)(o.CoB(l),o.CoB(y))};static \u0275prov=o.wxM({token:Gt,factory:Gt.\u0275fac})};return n=(0,d.UN)([f(pi)],n),n})();class mi{fConnection;constructor(i){this.fConnection=i}}let Ia=(()=>{let n=class Lt{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fBackground=void 0}static \u0275fac=function(e){return new(e||Lt)};static \u0275prov=o.wxM({token:Lt,factory:Lt.\u0275fac})};return n=(0,d.UN)([f(mi)],n),n})();class mo{fTransform;constructor(i){this.fTransform=i}}const _a=[Ea,Ma,Ia,(()=>{let n=class kt{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fBackground?.setTransform(t.fTransform)}static \u0275fac=function(e){return new(e||kt)};static \u0275prov=o.wxM({token:kt,factory:kt.\u0275fac})};return n=(0,d.UN)([f(mo)],n),n})()];class Ci{fCanvas;constructor(i){this.fCanvas=i}}let Na=(()=>{let n=class Ht{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fCanvas=t.fCanvas}static \u0275fac=function(e){return new(e||Ht)};static \u0275prov=o.wxM({token:Ht,factory:Ht.\u0275fac})};return n=(0,d.UN)([f(Ci)],n),n})();class vi{id;animated;constructor(i,t){this.id=i,this.animated=t}}let Ra=(()=>{let n=class Vt{_fComponentsStore=(0,o.uUt)(l);get transform(){return this._fComponentsStore.fCanvas.transform}_fMediator=(0,o.uUt)(h);handle(t){const e=this.getNode(t.id);e&&(this.toCenter(this.getNodeRect(e),this.getFlowRect(),e.position),this._fMediator.send(new pt(t.animated)))}toCenter(t,e,s){this.transform.scaledPosition=u.initialize(),this.transform.position=u.initialize((e.width-t.width)/2-s.x*this.transform.scale,(e.height-t.height)/2-s.y*this.transform.scale)}getNode(t){return this._fComponentsStore.fNodes.find(e=>e.fId===t)}getNodeRect(t){return p.fromElement(t.hostElement)}getFlowRect(){return p.fromElement(this._fComponentsStore.fFlow.hostElement)}static \u0275fac=function(e){return new(e||Vt)};static \u0275prov=o.wxM({token:Vt,factory:Vt.\u0275fac})};return n=(0,d.UN)([f(vi)],n),n})();class xi{toCenter;animated;constructor(i,t){this.toCenter=i,this.animated=t}}let Pa=(()=>{let n=class Wt{_fComponentsStore=(0,o.uUt)(l);get transform(){return this._fComponentsStore.fCanvas.transform}_fMediator=(0,o.uUt)(h);handle(t){const e=this._fMediator.send(new Pt)||p.initialize();0===e.width||0===e.height||(this.fitToParent(e,p.fromElement(this._fComponentsStore.fFlow.hostElement),this._fComponentsStore.fNodes.map(s=>s.position),t.toCenter),this._fMediator.send(new pt(t.animated)))}fitToParent(t,e,s,r){this.transform.scaledPosition=u.initialize(),this.transform.position=this.getZeroPositionWithoutScale(s);const a=t.width/this.transform.scale+r.x,c=t.height/this.transform.scale+r.y;(a>e.width||c>e.height||a<e.width&&c<e.height)&&(this.transform.scale=Math.min(e.width/a,e.height/c)),this.transform.position=u.initialize((e.width-a*this.transform.scale)/2-this.transform.position.x*this.transform.scale+r.x/2*this.transform.scale,(e.height-c*this.transform.scale)/2-this.transform.position.y*this.transform.scale+r.y/2*this.transform.scale)}getZeroPositionWithoutScale(t){const e=t.length?Math.min(...t.map(r=>r.x)):0,s=t.length?Math.min(...t.map(r=>r.y)):0;return u.initialize(e,s)}static \u0275fac=function(e){return new(e||Wt)};static \u0275prov=o.wxM({token:Wt,factory:Wt.\u0275fac})};return n=(0,d.UN)([f(xi)],n),n})();class Di{}let Fa=(()=>{let n=class $t{_fComponentsStore=(0,o.uUt)(l);handle(t){const e=this._fComponentsStore.fCanvas;if(!e)throw new Error("Canvas not found in store");return e}static \u0275fac=function(e){return new(e||$t)};static \u0275prov=o.wxM({token:$t,factory:$t.\u0275fac})};return n=(0,d.UN)([f(Di)],n),n})();class Si{transform;position;constructor(i,t){this.transform=i,this.position=t}}let ba=(()=>{let n=class qt{_fComponentsStore=(0,o.uUt)(l);handle(t){if(!t.position)return;const e=u.sum(t.transform.position,t.transform.scaledPosition);u.isEqual(e,t.position)||(t.transform.position=t.position,t.transform.scaledPosition=u.initialize(),this._fComponentsStore.fCanvas?.redraw())}static \u0275fac=function(e){return new(e||qt)};static \u0275prov=o.wxM({token:qt,factory:qt.\u0275fac})};return n=(0,d.UN)([f(Si)],n),n})();class wi{transform;scale;constructor(i,t){this.transform=i,this.scale=t}}let Oa=(()=>{let n=class Xt{_fComponentsStore=(0,o.uUt)(l);handle(t){t.scale&&(t.transform.scale=t.scale,this._fComponentsStore.fCanvas?.redraw())}static \u0275fac=function(e){return new(e||Xt)};static \u0275prov=o.wxM({token:Xt,factory:Xt.\u0275fac})};return n=(0,d.UN)([f(wi)],n),n})();class pt{animated;constructor(i){this.animated=i}}function Ei(n,i){const t=e=>{"transform"===e.propertyName&&(n.removeEventListener("transitionend",t),i(e))};n.addEventListener("transitionend",t)}let Ta=(()=>{let n=class Zt{_fComponentsStore=(0,o.uUt)(l);get _fCanvasElement(){return this._fComponentsStore.fCanvas.hostElement}handle(t){t.animated?this._redrawWithAnimation():this._redraw(),this._fComponentsStore.fCanvas.emitCanvasChangeEvent()}_redrawWithAnimation(){this._fComponentsStore.fCanvas.redrawWithAnimation(),Ei(this._fCanvasElement,()=>this._fComponentsStore.dataChanged())}_redraw(){this._fComponentsStore.fCanvas.redraw(),this._fComponentsStore.dataChanged()}static \u0275fac=function(e){return new(e||Zt)};static \u0275prov=o.wxM({token:Zt,factory:Zt.\u0275fac})};return n=(0,d.UN)([f(pt)],n),n})();class yi{}let Aa=(()=>{let n=class Yt{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fCanvas=void 0}static \u0275fac=function(e){return new(e||Yt)};static \u0275prov=o.wxM({token:Yt,factory:Yt.\u0275fac})};return n=(0,d.UN)([f(yi)],n),n})();class Mi{}let Ba=(()=>{let n=class Kt{_fComponentsStore=(0,o.uUt)(l);get transform(){return this._fComponentsStore.fCanvas.transform}handle(t){this.transform.scale=1,this.transform.scaledPosition=u.initialize()}static \u0275fac=function(e){return new(e||Kt)};static \u0275prov=o.wxM({token:Kt,factory:Kt.\u0275fac})};return n=(0,d.UN)([f(Mi)],n),n})();class Ii{animated;constructor(i){this.animated=i}}let Ua=(()=>{let n=class Qt{_fComponentsStore=(0,o.uUt)(l);get transform(){return this._fComponentsStore.fCanvas.transform}_fMediator=(0,o.uUt)(h);handle(t){const e=this._fMediator.send(new Pt)||p.initialize();0===e.width||0===e.height||(this.oneToOneCentering(e,p.fromElement(this._fComponentsStore.fFlow.hostElement),this._fComponentsStore.fNodes.map(s=>s.position)),this._fMediator.send(new pt(t.animated)))}oneToOneCentering(t,e,s){this.transform.scaledPosition=u.initialize(),this.transform.position=this.getZeroPositionWithoutScale(s);const r=(e.width-t.width/this.transform.scale)/2-this.transform.position.x,a=(e.height-t.height/this.transform.scale)/2-this.transform.position.y;this.transform.scale=1,this.transform.position=u.initialize(r,a)}getZeroPositionWithoutScale(t){const e=t.length?Math.min(...t.map(r=>r.x)):0,s=t.length?Math.min(...t.map(r=>r.y)):0;return u.initialize(e,s)}static \u0275fac=function(e){return new(e||Qt)};static \u0275prov=o.wxM({token:Qt,factory:Qt.\u0275fac})};return n=(0,d.UN)([f(Ii)],n),n})();class _i{scale;toPosition;constructor(i,t){this.scale=i,this.toPosition=t}}const za=[Na,Ra,Pa,Fa,ba,Oa,Ta,Aa,Ba,Ua,(()=>{let n=class Jt{_fComponentsStore=(0,o.uUt)(l);get transform(){return this._fComponentsStore.fCanvas.transform}handle(t){if(t.scale!==this.transform.scale){const e=u.sum(this.transform.scaledPosition,this.transform.position),s=t.toPosition.x-(t.toPosition.x-e.x)*t.scale/this.transform.scale,r=t.toPosition.y-(t.toPosition.y-e.y)*t.scale/this.transform.scale;this.transform.scale=t.scale,this.transform.scaledPosition=u.sub(u.initialize(s,r),this.transform.position)}}static \u0275fac=function(e){return new(e||Jt)};static \u0275prov=o.wxM({token:Jt,factory:Jt.\u0275fac})};return n=(0,d.UN)([f(_i)],n),n})()];class Ni{fConnection;constructor(i){this.fConnection=i}}let Ga=(()=>{let n=class jt{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fTempConnection=t.fConnection}static \u0275fac=function(e){return new(e||jt)};static \u0275prov=o.wxM({token:jt,factory:jt.\u0275fac})};return n=(0,d.UN)([f(Ni)],n),n})();class Ri{fComponent;constructor(i){this.fComponent=i}}let La=(()=>{let n=class te{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.addComponent(this._fComponentsStore.fMarkers,t.fComponent)}static \u0275fac=function(e){return new(e||te)};static \u0275prov=o.wxM({token:te,factory:te.\u0275fac})};return n=(0,d.UN)([f(Ri)],n),n})();class Pi{fConnection;constructor(i){this.fConnection=i}}let ka=(()=>{let n=class ee{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fConnections.push(t.fConnection),this._fComponentsStore.dataChanged()}static \u0275fac=function(e){return new(e||ee)};static \u0275prov=o.wxM({token:ee,factory:ee.\u0275fac})};return n=(0,d.UN)([f(Pi)],n),n})();class Fi{fConnection;constructor(i){this.fConnection=i}}let Ha=(()=>{let n=class ne{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fSnapConnection=t.fConnection}static \u0275fac=function(e){return new(e||ne)};static \u0275prov=o.wxM({token:ne,factory:ne.\u0275fac})};return n=(0,d.UN)([f(Fi)],n),n})();class bi{fConnection;constructor(i){this.fConnection=i}}let Va=(()=>{let n=class oe{fBrowser;fComponentsStore;constructor(t,e){this.fBrowser=t,this.fComponentsStore=e}handle(t){const e=Oi("defs",this.fBrowser),s=t.fConnection;this.getMarkers(s).forEach(r=>{const a=this.createMarkerElement(r,s.fId),c=r.hostElement.cloneNode(!0);c.setAttribute("height",`${r.height}`),c.setAttribute("width",`${r.width}`),c.removeAttribute("markerUnits"),c.style.display="unset",a.append(c),e.append(a)}),s.fDefs.nativeElement.innerHTML=e.innerHTML,this.makeSafariCompatible(s)}getMarkers(t){return this.fComponentsStore.fMarkers.filter(e=>t.hostElement.contains(e.hostElement))}makeSafariCompatible(t){t.fPath.hostElement.replaceWith(t.fPath.hostElement)}createMarkerElement(t,e){const s=Oi("marker",this.fBrowser);return s.setAttribute("id",B(t.type+"-"+e)),s.setAttribute("markerHeight",`${t.height}`),s.setAttribute("markerWidth",`${t.width}`),s.setAttribute("orient",`${t.orient}`),s.setAttribute("refX",`${t.refX}`),s.setAttribute("refY",`${t.refY}`),s.setAttribute("markerUnits",`${t.markerUnits}`),s}static \u0275fac=function(e){return new(e||oe)(o.CoB(y),o.CoB(l))};static \u0275prov=o.wxM({token:oe,factory:oe.\u0275fac})};return n=(0,d.UN)([f(bi)],n),n})();function Oi(n,i){return i.document.createElementNS("http://www.w3.org/2000/svg",n)}class Co{position;canBeConnectedInputs;constructor(i,t){this.position=i,this.canBeConnectedInputs=t}}let Wa=(()=>{let n=class ie{handle(t){let e,s=1/0;for(const r of t.canBeConnectedInputs){const a=this.distanceToRectangle(t.position,r);a<s&&(s=a,e=r)}return e?{...e,distance:s}:void 0}distanceToRectangle(t,e){const s=this.clamp(t.x,e.fRect.x,e.fRect.x+e.fRect.width),r=this.clamp(t.y,e.fRect.y,e.fRect.y+e.fRect.height),a=t.x-s,c=t.y-r;return Math.sqrt(a*a+c*c)}clamp(t,e,s){return Math.max(e,Math.min(s,t))}static \u0275fac=function(e){return new(e||ie)};static \u0275prov=o.wxM({token:ie,factory:ie.\u0275fac})};return n=(0,d.UN)([f(Co)],n),n})();class vo{fOutputId;constructor(i){this.fOutputId=i}}class Z{connector;constructor(i){this.connector=i}}class N{element;isRoundedRect;constructor(i,t=!0){this.element=i,this.isRoundedRect=t}}let $a=(()=>{let n=class se{_fComponentsStore=(0,o.uUt)(l);_fMediator=(0,o.uUt)(h);get _transform(){return this._fComponentsStore.fCanvas.transform}handle(t){const e=this._getElementRoundedRect(t),s=this._normalizePosition(e),r=this._normalizeSize(e);return new _(s.x,s.y,r.width,r.height,e.radius1,e.radius2,e.radius3,e.radius4)}_getElementRoundedRect(t){return t.isRoundedRect?this._fMediator.send(new fi(t.element)):_.fromRect(p.fromElement(t.element))}_normalizePosition(t){return C.fromPoint(t).elementTransform(this._fComponentsStore.flowHost).sub(this._transform.scaledPosition).sub(this._transform.position).div(this._transform.scale)}_normalizeSize(t){return ft.initialize(t.width/this._transform.scale,t.height/this._transform.scale)}static \u0275fac=function(e){return new(e||se)};static \u0275prov=o.wxM({token:se,factory:se.\u0275fac})};return n=(0,d.UN)([f(N)],n),n})(),qa=(()=>{let n=class re{_fMediator=(0,o.uUt)(h);handle(t){return{fConnector:t.connector,fRect:this._fMediator.send(new N(t.connector.hostElement,!0))}}static \u0275fac=function(e){return new(e||re)};static \u0275prov=o.wxM({token:re,factory:re.\u0275fac})};return n=(0,d.UN)([f(Z)],n),n})(),Xa=(()=>{let n=class ae{fComponentsStore;fMediator;get fNodes(){return this.fComponentsStore.fNodes}get fInputs(){return this.fComponentsStore.fInputs}constructor(t,e){this.fComponentsStore=t,this.fMediator=e}handle(t){return this.getCanBeConnectedInputs(this.getOutput(t.fOutputId)).map(e=>this.fMediator.send(new Z(e)))}getOutput(t){return this.findOutputById(t)||this.findOutletById(t)}findOutputById(t){return this.fComponentsStore.fOutputs.find(e=>e.fId===t)}findOutletById(t){return this.fComponentsStore.fOutlets.find(e=>e.fId===t)}getCanBeConnectedInputs(t){return t.isSelfConnectable?this.fInputs.filter(e=>e.canBeConnected):this.filterSelfConnectable(this.fInputs.filter(e=>e.canBeConnected),t)}filterSelfConnectable(t,e){return t.filter(s=>this.getNodeOfConnector(e)?.hostElement!==this.getNodeOfConnector(s)?.hostElement)}getNodeOfConnector(t){return this.fNodes.find(e=>e.isContains(t.hostElement))}static \u0275fac=function(e){return new(e||ae)(o.CoB(l),o.CoB(h))};static \u0275prov=o.wxM({token:ae,factory:ae.\u0275fac})};return n=(0,d.UN)([f(vo)],n),n})();class U{outputRect;inputRect;behavior;outputSide;inputSide;constructor(i,t,e,s,r){this.outputRect=i,this.inputRect=t,this.behavior=e,this.outputSide=s,this.inputSide=r}}class Za{handle(i){const{source:t,target:e}=i,s=Math.abs(e.x-t.x)/2,r=e.x<t.x?e.x+s:e.x-s,a=Math.abs(e.y-t.y)/2;return u.initialize(r,e.y<t.y?e.y+a:e.y-a)}}class Ya{source;target;constructor(i,t){this.source=i,this.target=t}}class xo{handle(i){const{points:t}=i;let e=0,s=[];for(let m=0;m<t.length-1;m++){const x=this.calculateDistance(t[m],t[m+1]);s.push(x),e+=x}let r=0,a=0;const c=e/2;for(let m=0;m<s.length;m++)if(r+=s[m],r>=c){a=m;break}return this.findPointAtDistance(t[a],t[a+1],c-(r-s[a]))}calculateDistance(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}findPointAtDistance(i,t,e){const r=e/this.calculateDistance(i,t);return{x:(1-r)*i.x+r*t.x,y:(1-r)*i.y+r*t.y}}}class Do{points;constructor(i){this.points=i}}var D=function(n){return n.LEFT="left",n.TOP="top",n.RIGHT="right",n.BOTTOM="bottom",n.AUTO="auto",n}(D||{});class Ka{handle(i){let t;return t=i.fConnector.userFConnectableSide===D.AUTO?this.getSideByDelta(i.fConnector.hostElement,i.fNodeHost):i.fConnector.userFConnectableSide,t}getSideByDelta(i,t){let e;const s=p.fromElement(i),r=t.getBoundingClientRect(),a=s.gravityCenter.x-r.left,c=r.right-s.gravityCenter.x,g=s.gravityCenter.y-r.top,x=Math.min(a,c,g,r.bottom-s.gravityCenter.y);return e=x===a?D.LEFT:x===c?D.RIGHT:x===g?D.TOP:D.BOTTOM,e}}class Qa{fConnector;fNodeHost;constructor(i,t){this.fConnector=i,this.fNodeHost=t}}class So{_isConnected=!1;get isConnected(){return this._isConnected}toConnector;isSelfConnectable=!0;fConnectableSide=D.AUTO;userFConnectableSide=D.AUTO;isContains(i){return this.hostElement.contains(i)}setConnected(i,t){this._isConnected=i,this.toConnector=t}}const Ja=new o.UbH("F_NODE_INPUT");let ja=(()=>{class n extends So{get canBeConnected(){return!(this.disabled||!this.multiple&&this.isConnected)}static \u0275fac=(()=>{let t;return function(s){return(t||(t=o.otF(n)))(s||n)}})();static \u0275dir=o.Sc5({type:n,features:[o.eg9]})}return n})();var z=function(n){return n.LEFT_TOP="left-top",n.RIGHT_TOP="right-top",n.LEFT_BOTTOM="left-bottom",n.RIGHT_BOTTOM="right-bottom",n}(z||{});new o.UbH("F_RESIZE_HANDLE");const nc=new o.UbH("F_DRAG_HANDLE");let Ti=(()=>{class n{_elementReference=(0,o.uUt)(o.GMv);get hostElement(){return this._elementReference.nativeElement}static \u0275fac=function(e){return new(e||n)};static \u0275dir=o.Sc5({type:n,selectors:[["","fDragHandle",""]],hostAttrs:[1,"f-drag-handle","f-component"],features:[o.M5G([{provide:nc,useExisting:n}])]})}return n})();const wo="f-selected";function Ai(n){return class extends n{fId="";fSelectionDisabled=!1;deselect(){this.deselectChild?.(),this.hostElement.classList.remove(wo)}select(){this.selectChild?.(),this.isSelected()||this.hostElement.classList.add(wo)}isSelected(){return this.hostElement.classList.contains(wo)}selectChild(){}deselectChild(){}constructor(...i){super(...i)}}}const lt=new o.UbH("F_NODE"),ic=Ai(class{hostElement;constructor(n){this.hostElement=n}});class Bi extends ic{stateChanges=new X;_position=u.initialize();_size;fCanBeResizedByChild=!0;connectors=[];isContains(i){return this.hostElement.contains(i)}redraw(){this.size&&(this.setStyle("width",this.size.width+"px"),this.setStyle("height",this.size.height+"px")),this.setStyle("transform",`translate(${this.position.x}px,${this.position.y}px)`)}updatePosition(i){this._position=i}updateSize(i){this._size=i}setClass(i){this.hostElement.classList.add(i)}removeClass(i){this.hostElement.classList.remove(i)}addConnector(i){this.connectors.push(i),this.refresh()}removeConnector(i){const t=this.connectors.indexOf(i);-1!==t&&this.connectors.splice(t,1),this.refresh()}}let sc=0,Ui=(()=>{class n extends Bi{renderer;fBrowser;fId="f-group-"+sc++;fParentId=null;set position(t){this._position=u.castToPoint(t),this.refresh()}get position(){return this._position}positionChange=new o._w7;set size(t){this._size=t,this.refresh()}get size(){return this._size}sizeChange=new o._w7;fDraggingDisabled=!1;fSelectionDisabled=!1;fIncludePadding=!0;fConnectOnNode=!0;_destroyRef=(0,o.uUt)(o.eM9);_fMediator=(0,o.uUt)(h);constructor(t,e,s){super(t.nativeElement),this.renderer=e,this.fBrowser=s}ngOnInit(){this.setStyle("position","absolute"),this.setStyle("transform-origin","center"),this.setStyle("user-select","none"),this.setStyle("pointer-events","all"),this.setStyle("left","0"),this.setStyle("top","0"),super.redraw(),this._fMediator.send(new Wo(this))}setStyle(t,e){this.renderer.setStyle(this.hostElement,t,e)}redraw(){super.redraw(),this._fMediator.send(new ot)}ngAfterViewInit(){this.fBrowser.isBrowser()&&this._listenStateSizeChanges()}_listenStateSizeChanges(){this._fMediator.send(new Xo(this,this._destroyRef))}refresh(){this.stateChanges.notify()}ngOnDestroy(){this._fMediator.send(new Zo(this))}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv),o.GI1(o.q87),o.GI1(y))};static \u0275dir=o.Sc5({type:n,selectors:[["","fGroup",""]],hostAttrs:[1,"f-group","f-component"],hostVars:5,hostBindings:function(e,s){2&e&&(o.e48("data-f-group-id",s.fId),o.eAK("f-group-dragging-disabled",s.fDraggingDisabled)("f-group-selection-disabled",s.fSelectionDisabled))},inputs:{fId:[o.Wk5.None,"fGroupId","fId"],fParentId:[o.Wk5.None,"fGroupParentId","fParentId"],position:[o.Wk5.None,"fGroupPosition","position"],size:[o.Wk5.None,"fGroupSize","size"],fDraggingDisabled:[o.Wk5.None,"fGroupDraggingDisabled","fDraggingDisabled"],fSelectionDisabled:[o.Wk5.None,"fGroupSelectionDisabled","fSelectionDisabled"],fIncludePadding:"fIncludePadding",fConnectOnNode:"fConnectOnNode"},outputs:{positionChange:"fGroupPositionChange",sizeChange:"fGroupSizeChange"},exportAs:["fComponent"],features:[o.M5G([{provide:lt,useExisting:n}]),o.eg9]})}return n})(),rc=0,mt=(()=>{class n extends Bi{renderer;fBrowser;fId="f-node-"+rc++;fParentId=null;set position(t){this._position=u.castToPoint(t),this.refresh()}get position(){return this._position}positionChange=new o._w7;set size(t){this._size=t,this.refresh()}get size(){return this._size}sizeChange=new o._w7;fDraggingDisabled=!1;fSelectionDisabled=!1;fIncludePadding=!0;fConnectOnNode=!0;_destroyRef=(0,o.uUt)(o.eM9);_fMediator=(0,o.uUt)(h);constructor(t,e,s){super(t.nativeElement),this.renderer=e,this.fBrowser=s}ngOnInit(){this.setStyle("position","absolute"),this.setStyle("transform-origin","center"),this.setStyle("user-select","none"),this.setStyle("pointer-events","all"),this.setStyle("left","0"),this.setStyle("top","0"),super.redraw(),this._fMediator.send(new Wo(this))}setStyle(t,e){this.renderer.setStyle(this.hostElement,t,e)}redraw(){super.redraw(),this._fMediator.send(new ot)}ngAfterViewInit(){this.fBrowser.isBrowser()&&this._listenStateSizeChanges()}_listenStateSizeChanges(){this._fMediator.send(new Xo(this,this._destroyRef))}refresh(){this.stateChanges.notify()}ngOnDestroy(){this._fMediator.send(new Zo(this))}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv),o.GI1(o.q87),o.GI1(y))};static \u0275dir=o.Sc5({type:n,selectors:[["","fNode",""]],hostAttrs:[1,"f-node","f-component"],hostVars:5,hostBindings:function(e,s){2&e&&(o.e48("data-f-node-id",s.fId),o.eAK("f-node-dragging-disabled",s.fDraggingDisabled)("f-node-selection-disabled",s.fSelectionDisabled))},inputs:{fId:[o.Wk5.None,"fNodeId","fId"],fParentId:[o.Wk5.None,"fNodeParentId","fParentId"],position:[o.Wk5.None,"fNodePosition","position"],size:[o.Wk5.None,"fNodeSize","size"],fDraggingDisabled:[o.Wk5.None,"fNodeDraggingDisabled","fDraggingDisabled"],fSelectionDisabled:[o.Wk5.None,"fNodeSelectionDisabled","fSelectionDisabled"],fIncludePadding:"fIncludePadding",fConnectOnNode:"fConnectOnNode"},outputs:{positionChange:"fNodePositionChange",sizeChange:"fNodeSizeChange"},exportAs:["fComponent"],features:[o.M5G([{provide:lt,useExisting:n}]),o.eg9]})}return n})(),cc=0,zi=(()=>{class n extends ja{fNode;fId="f-node-input-"+cc++;multiple=!0;disabled=!1;userFConnectableSide=D.AUTO;get hostElement(){return this._elementReference.nativeElement}_elementReference=(0,o.uUt)(o.GMv);_fMediator=(0,o.uUt)(h);constructor(t){super(),this.fNode=t}ngOnInit(){this._fMediator.send(new Qi(this)),this.fNode.addConnector(this)}ngOnChanges(t){t.userFConnectableSide&&this.fNode.refresh()}setConnected(t,e){super.setConnected(t,e),this.hostElement.classList.toggle("f-node-input-connected",t),this.hostElement.classList.toggle("f-node-input-not-connectable",!this.canBeConnected)}ngOnDestroy(){this.fNode.removeConnector(this),this._fMediator.send(new ts(this))}static \u0275fac=function(e){return new(e||n)(o.GI1(lt))};static \u0275dir=o.Sc5({type:n,selectors:[["","fNodeInput",""]],hostAttrs:[1,"f-component","f-node-input"],hostVars:5,hostBindings:function(e,s){2&e&&(o.e48("data-f-input-id",s.fId),o.eAK("f-node-input-multiple",s.multiple)("f-node-input-disabled",s.disabled))},inputs:{fId:[o.Wk5.None,"fInputId","fId"],multiple:[o.Wk5.None,"fInputMultiple","multiple"],disabled:[o.Wk5.HasDecoratorInputTransform,"fInputDisabled","disabled",o.cZD],userFConnectableSide:[o.Wk5.HasDecoratorInputTransform,"fInputConnectableSide","userFConnectableSide",t=>tt(t,"fInputConnectableSide",D)]},exportAs:["fNodeInput"],features:[o.M5G([{provide:Ja,useExisting:n}]),o.QJr,o.eg9,o.SYr]})}return n})();function Gi(n){return!!n.closest("[fNodeOutlet]")}new o.UbH("F_NODE_OUTLET");const hc=new o.UbH("F_NODE_OUTPUT");let gc=(()=>{class n extends So{get canBeConnected(){return!(this.disabled||!this.multiple&&this.isConnected)}static \u0275fac=(()=>{let t;return function(s){return(t||(t=o.otF(n)))(s||n)}})();static \u0275dir=o.Sc5({type:n,features:[o.eg9]})}return n})();function Li(n){return!!n.closest("[fNodeOutput]")}let pc=0,ki=(()=>{class n extends gc{fNode;fId="f-node-output-"+pc++;multiple=!1;disabled=!1;userFConnectableSide=D.AUTO;isSelfConnectable=!0;get hostElement(){return this._elementReference.nativeElement}_elementReference=(0,o.uUt)(o.GMv);_fMediator=(0,o.uUt)(h);constructor(t){super(),this.fNode=t}ngOnInit(){this._fMediator.send(new ji(this)),this.fNode.addConnector(this)}ngOnChanges(t){t.userFConnectableSide&&this.fNode.refresh()}setConnected(t,e){super.setConnected(t,e),this.hostElement.classList.toggle("f-node-output-connected",t),this.hostElement.classList.toggle("f-node-output-not-connectable",!this.canBeConnected)}ngOnDestroy(){this.fNode.removeConnector(this),this._fMediator.send(new ns(this))}static \u0275fac=function(e){return new(e||n)(o.GI1(lt))};static \u0275dir=o.Sc5({type:n,selectors:[["","fNodeOutput",""]],hostAttrs:[1,"f-component","f-node-output"],hostVars:7,hostBindings:function(e,s){2&e&&(o.e48("data-f-output-id",s.fId),o.eAK("f-node-output-multiple",s.multiple)("f-node-output-disabled",s.disabled)("f-node-output-self-connectable",s.isSelfConnectable))},inputs:{fId:[o.Wk5.None,"fOutputId","fId"],multiple:[o.Wk5.None,"fOutputMultiple","multiple"],disabled:[o.Wk5.HasDecoratorInputTransform,"fOutputDisabled","disabled",o.cZD],userFConnectableSide:[o.Wk5.HasDecoratorInputTransform,"fOutputConnectableSide","userFConnectableSide",t=>tt(t,"fOutputConnectableSide",D)],isSelfConnectable:"isSelfConnectable"},exportAs:["fNodeOutput"],features:[o.M5G([{provide:hc,useExisting:n}]),o.QJr,o.eg9,o.SYr]})}return n})();class k{static getConnectorOffset(i,t){return i>=t?i:t*Math.sqrt(t-i)}static getAnglePoint(i,t,e,s){let r={x:t.x,y:t.y};switch(i){case D.LEFT:r.x-=k.getConnectorOffset(t.x-e.x,s);break;case D.RIGHT:r.x+=k.getConnectorOffset(e.x-t.x,s);break;case D.TOP:r.y-=k.getConnectorOffset(t.y-e.y,s);break;case D.BOTTOM:r.y+=k.getConnectorOffset(e.y-t.y,s)}return r}handle(i){const{source:t,sourceSide:e,target:s,targetSide:r,offset:a}=i,c=k.getAnglePoint(e,t,s,a),g=k.getAnglePoint(r,s,t,a);return{path:`M ${t.x} ${t.y} C ${c.x} ${c.y}, ${g.x} ${g.y}, ${s.x+2e-4} ${s.y+2e-4}`,connectionCenter:(new xo).handle(new Do([t,c,g,s])),penultimatePoint:g}}}const Hi={[D.LEFT]:u.initialize(-1,0),[D.RIGHT]:u.initialize(1,0),[D.TOP]:u.initialize(0,-1),[D.BOTTOM]:u.initialize(0,1),[D.AUTO]:u.initialize(0,0)};class mc{handle(i){const{source:t,sourceSide:e,target:s,targetSide:r}=i,{points:a,center:c}=this.getPathPoints(t,e,s,r,i.offset);return{path:this.buildPath(a,i.radius),connectionCenter:c,penultimatePoint:a.length>1?a[a.length-2]:t}}getPathPoints(i,t,e,s,r){const a=Hi[t],c=Hi[s],g={x:i.x+a.x*r,y:i.y+a.y*r},m={x:e.x+c.x*r,y:e.y+c.y*r},x=this.getDirection(g,t,m),S=0!==x.x?"x":"y",R=x[S];let M=[];const I=u.initialize(),st=u.initialize(),Ft=(new Za).handle(new Ya(i,e));if(a[S]*c[S]==-1){const rt=[{x:Ft.x,y:g.y},{x:Ft.x,y:m.y}],at=[{x:g.x,y:Ft.y},{x:m.x,y:Ft.y}];M=a[S]===R?"x"===S?rt:at:"x"===S?at:rt}else{const rt=[{x:g.x,y:m.y}],at=[{x:m.x,y:g.y}];if(M="x"===S?a.x===R?at:rt:a.y===R?rt:at,t===s){const $=Math.abs(i[S]-e[S]);if($<=r){const J=Math.min(r-1,r-$);a[S]===R?I[S]=(g[S]>i[S]?-1:1)*J:st[S]=(m[S]>e[S]?-1:1)*J}}if(t!==s){const $="x"===S?"y":"x",J=a[S]===c[$],wr=g[$]>m[$],Er=g[$]<m[$];(1===a[S]&&(!J&&wr||J&&Er)||1!==a[S]&&(!J&&Er||J&&wr))&&(M="x"===S?rt:at)}}const Sr=[i,{x:g.x+I.x,y:g.y+I.y},...M,{x:m.x+st.x,y:m.y+st.y},e];return{points:Sr,center:(new xo).handle(new Do(Sr))}}getDirection(i,t,e){return t===D.LEFT||t===D.RIGHT?u.initialize(i.x<e.x?1:-1,0):u.initialize(0,i.y<e.y?1:-1)}distance(i,t){return Math.sqrt(Math.pow(t.x-i.x,2)+Math.pow(t.y-i.y,2))}buildPath(i,t){let e="";for(let s=0;s<i.length;s++){const r=i[s];let a="";a=s>0&&s<i.length-1?this.getBend(i[s-1],r,i[s+1],t):s===i.length-1?this.buildLastLineSegment(s,r):this.buildMoveOrLineSegment(s,r),e+=a}return e}getBend(i,t,e,s){const r=Math.min(this.distance(i,t)/2,this.distance(t,e)/2,s),{x:a,y:c}=t;return i.x===a&&a===e.x||i.y===c&&c===e.y?`L${a} ${c}`:i.y===c?`L ${a+r*(i.x<e.x?-1:1)},${c}Q ${a},${c} ${a},${c+r*(i.y<e.y?1:-1)}`:`L ${a},${c+r*(i.y<e.y?-1:1)}Q ${a},${c} ${a+r*(i.x<e.x?1:-1)},${c}`}buildMoveOrLineSegment(i,t){return`${0===i?"M":"L"}${t.x} ${t.y}`}buildLastLineSegment(i,t){return`L${t.x+2e-4} ${t.y+2e-4}`}}class Cc{handle(i){const{source:t,target:e}=i;return{path:`M ${t.x} ${t.y} L ${e.x+2e-4} ${e.y+2e-4}`,connectionCenter:(new xo).handle(new Do([t,e])),penultimatePoint:t}}}const H={textId:n=>B("connection_text_"+n),connectionForSelectionId:n=>B("connection_for_selection_"+n),connectionId:n=>B("connection_"+n),gradientId:n=>B("connection_gradient_"+n),linkToGradient:n=>`url(#${H.gradientId(n)})`,linkToConnection:n=>`#${H.connectionId(n)}`},V=new o.UbH("F_CONNECTION");let Eo=(()=>{class n{elementReference;base;fBrowser;get linkToConnection(){return H.linkToConnection(this.base.fId+this.base.fOutputId+this.base.fInputId)}get hostElement(){return this.elementReference.nativeElement}symbolWidth=8;fontSize="12px";constructor(t,e,s){this.elementReference=t,this.base=e,this.fBrowser=s}ngOnInit(){this.hostElement.setAttribute("startOffset",this.base.fTextStartOffset||"50%"),this.hostElement.setAttribute("text-anchor","middle"),this.symbolWidth=this.getSymbolWidth(this.base.fText||"")}getBBox(){return this.hostElement.getBBox()}getFontStyles(t){const e=this.fBrowser.window.getComputedStyle(t);return{fontSize:e.fontSize,fontFamily:e.fontFamily}}getSymbolWidth(t){const e=t||"connection",{fontFamily:s,fontSize:r}=this.getFontStyles(this.hostElement);this.fontSize=r||"12px";const a=this.fBrowser.document.createElement("canvas");let c;try{c=a.getContext("2d")}catch{c=null}return c?(c.font=`${r} ${s}`,c.measureText(e).width/e.length):0}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv),o.GI1(V),o.GI1(y))};static \u0275dir=o.Sc5({type:n,selectors:[["textPath","f-connection-text-path",""]],hostVars:1,hostBindings:function(e,s){2&e&&o.e48("href",s.linkToConnection)}})}return n})();const Ct=new o.UbH("CONNECTION_TEXT");let vt=(()=>{class n{elementReference;base;get textId(){return H.textId(this.base.fId+this.base.fOutputId+this.base.fInputId)}get hostElement(){return this.elementReference.nativeElement}get text(){return this.base.fText||""}textPathDirective;constructor(t,e){this.elementReference=t,this.base=e}redraw(t){const e=n.isTextReverse(t),s=this.calculateDy(this.textPathDirective.fontSize,e);this.hostElement.setAttribute("dy",s);const r=this.textPathDirective.getBBox();this.hostElement.setAttribute("transform",e?`rotate(180, ${[r.x+r.width/2,r.y+r.height/2]})`:""),this.hostElement.style.display=n.getTextStartOffset(t,this.base.fText||"",this.textPathDirective.symbolWidth)<0?"none":"unset"}calculateDy(t,e){const s=parseFloat(t);return(e?1.5*s:-.8*s).toString()}static isTextReverse(t){return t.point1.x>t.point2.x}static getTextStartOffset(t,e,s){return u.hypotenuse(t.point1,t.point2)/2-(e||"").length*s/2}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv),o.GI1(V))};static \u0275cmp=o.In1({type:n,selectors:[["text","f-connection-text",""]],viewQuery:function(e,s){if(1&e&&o.CC$(Eo,7),2&e){let r;o.wto(r=o.Gqi())&&(s.textPathDirective=r.first)}},hostAttrs:[1,"f-component","f-connection-text"],hostVars:1,hostBindings:function(e,s){2&e&&o.e48("id",s.textId)},features:[o.M5G([{provide:Ct,useExisting:n}])],attrs:ta,decls:3,vars:1,consts:[[0,"xmlns","svg","http://www.w3.org/2000/svg"],["f-connection-text-path",""]],template:function(e,s){1&e&&(o.SAx(0,0),o.S2Z(),o.I0R(1,"textPath",1),o.OEk(2),o.C$Y(),o.k70()),2&e&&(o.yG2(2),o.oRS(" ",s.text," "))},dependencies:[Eo],encapsulation:2,changeDetection:0})}return n})(),Y=(()=>{class n{elementReference;point;radius=8;class="f-connection-drag-handle";get hostElement(){return this.elementReference.nativeElement}constructor(t){this.elementReference=t}redraw(t,e){this.point=this._calculateCircleCenter(t,e,8),this.hostElement.setAttribute("cx",this.point.x.toString()),this.hostElement.setAttribute("cy",this.point.y.toString())}_calculateCircleCenter(t,e,s){const r_x=e.x-t.x,r_y=e.y-t.y,a=Math.sqrt(r_x*r_x+r_y*r_y)||1;return{x:e.x-r_x/a*s,y:e.y-r_y/a*s}}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv))};static \u0275cmp=o.In1({type:n,selectors:[["circle","f-connection-drag-handle",""]],hostVars:2,hostBindings:function(e,s){2&e&&o.m8U(s.class)},attrs:ea,decls:0,vars:0,template:function(e,s){},encapsulation:2,changeDetection:0})}return n})();const xt=new o.UbH("CONNECTION_GRADIENT");let Dt=(()=>{class n{elementReference;base;get gradientId(){return H.gradientId(this.base.fId+this.base.fOutputId+this.base.fInputId)}get hostElement(){return this.elementReference.nativeElement}get stop1Element(){return this.elementReference.nativeElement.children.item(0)}get stop2Element(){return this.elementReference.nativeElement.children.item(1)}constructor(t,e){this.elementReference=t,this.base=e}initialize(){this.stop1Element.setAttribute("offset","0%"),this.stop2Element.setAttribute("offset","100%")}updateGradient(){this.setFromColor(this.base.fStartColor),this.setToColor(this.base.fEndColor)}setFromColor(t){this.stop1Element.setAttribute("stop-color",t||"transparent")}setToColor(t){this.stop2Element.setAttribute("stop-color",t||"transparent")}redraw(t){const e=t.point2.x-t.point1.x,s=t.point2.y-t.point1.y,r=Math.sqrt(e*e+s*s)||.01,a=new C(.5-.5*e/r,.5-.5*s/r);this.hostElement.setAttribute("x1",a.x.toString()),this.hostElement.setAttribute("y1",a.y.toString());const c=new C(.5+.5*e/r,.5+.5*s/r);this.hostElement.setAttribute("x2",c.x.toString()),this.hostElement.setAttribute("y2",c.y.toString()),this.updateGradient()}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv),o.GI1(V))};static \u0275cmp=o.In1({type:n,selectors:[["linearGradient","fConnectionGradient",""]],hostAttrs:[1,"f-component","f-connection-gradient"],hostVars:1,hostBindings:function(e,s){2&e&&o.e48("id",s.gradientId)},features:[o.M5G([{provide:xt,useExisting:n}])],attrs:na,decls:3,vars:0,consts:[[0,"xmlns","svg","http://www.w3.org/2000/svg"]],template:function(e,s){1&e&&(o.SAx(0,0),o.S2Z(),o.wR5(1,"stop")(2,"stop"),o.k70())},encapsulation:2,changeDetection:0})}return n})();const St=new o.UbH("CONNECTION_PATH");let wt=(()=>{class n{elementReference;base;get fPathId(){return this.base.fId}get linkToGradient(){return H.linkToGradient(this.base.fId+this.base.fOutputId+this.base.fInputId)}get attrConnectionId(){return H.connectionId(this.base.fId+this.base.fOutputId+this.base.fInputId)}get hostElement(){return this.elementReference.nativeElement}constructor(t,e){this.elementReference=t,this.base=e}initialize(){this.deselect()}setPath(t){this.hostElement.setAttribute("d",`${t}`)}select(){this.hostElement.setAttribute("marker-start",`url(#${function Sc(n){return B(`f-connection-selected-marker-start-${n}`)}(this.base.fId)})`),this.hostElement.setAttribute("marker-end",`url(#${function wc(n){return B(`f-connection-selected-marker-end-${n}`)}(this.base.fId)})`)}deselect(){this.hostElement.setAttribute("marker-start",`url(#${function xc(n){return B(`f-connection-marker-start-${n}`)}(this.base.fId)})`),this.hostElement.setAttribute("marker-end",`url(#${function Dc(n){return B(`f-connection-marker-end-${n}`)}(this.base.fId)})`)}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv),o.GI1(V))};static \u0275cmp=o.In1({type:n,selectors:[["path","f-connection-path",""]],hostAttrs:[1,"f-component","f-connection-path"],hostVars:3,hostBindings:function(e,s){2&e&&o.e48("id",s.attrConnectionId)("data-f-path-id",s.fPathId)("stroke",s.linkToGradient)},features:[o.M5G([{provide:St,useExisting:n}])],attrs:oa,decls:0,vars:0,template:function(e,s){},encapsulation:2,changeDetection:0})}return n})(),K=(()=>{class n{elementReference;base;get connectionForSelectionId(){return H.connectionForSelectionId(this.base.fId+this.base.fOutputId+this.base.fInputId)}get hostElement(){return this.elementReference.nativeElement}constructor(t,e){this.elementReference=t,this.base=e}setPath(t){this.hostElement.setAttribute("d",`${t}`)}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv),o.GI1(V))};static \u0275cmp=o.In1({type:n,selectors:[["path","fConnectionSelection",""]],hostAttrs:[1,"f-component","f-connection-selection"],hostVars:1,hostBindings:function(e,s){2&e&&o.e48("id",s.connectionForSelectionId)},attrs:ia,decls:0,vars:0,template:function(e,s){},encapsulation:2,changeDetection:0})}return n})();const Ec=new o.UbH("F_CONNECTION_BUILDERS");let ut=(()=>{class n{builders={[Q.STRAIGHT]:new Cc,[Q.BEZIER]:new k,[Q.SEGMENT]:new mc};constructor(t){t&&(this.builders={...this.builders,...t})}handle(t){const e=this.builders[t.type];if(!e)throw new Error(`FConnectionBuilder not found for type ${t.type}`);return e.handle(t.payload)}static \u0275fac=function(e){return new(e||n)(o.CoB(Ec,8))};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac})}return n})();const yc=Ai(function oc(n){return class extends n{show(){this.hostElement.style.display="unset"}hide(){this.hostElement.style.display="none"}constructor(...i){super(...i)}}}(class{hostElement;constructor(n){this.hostElement=n}}));let Et=(()=>{class n extends yc{cFactory;path="";line=ei.initialize();penultimatePoint=u.initialize();constructor(t,e){super(t.nativeElement),this.cFactory=e}initialize(){this.fPath.initialize(),this.fGradient.initialize(),this.redraw()}isContains(t){return(this.hostElement.firstChild?.lastChild).contains(t)}setLine(t,e,s,r){this.line=ei.initialize(t,s);const a=this.getPathResult(t,e,s,r);this.path=a.path,this.penultimatePoint=a.penultimatePoint||t,this.fConnectionCenter?.nativeElement?.setAttribute("style",this.getTransform(a.connectionCenter))}getPathResult(t,e,s,r){return this.cFactory.handle({type:this.fType,payload:{source:t,sourceSide:e,target:s,targetSide:r,radius:this.fRadius>0?this.fRadius:0,offset:this.fOffset>0?this.fOffset:1}})}getTransform(t){return`position: absolute; pointerEvents: all; transform: translate(-50%, -50%); left: ${t.x}px; top: ${t.y}px`}selectChild(){this.fPath.select()}deselectChild(){this.fPath.deselect()}redraw(){this.fPath.setPath(this.path),this.fSelection.setPath(this.path),this.fGradient.redraw(this.line),this.fDragHandle.redraw(this.penultimatePoint,this.line.point2),this.fTextComponent.redraw(this.line)}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv),o.GI1(ut))};static \u0275dir=o.Sc5({type:n,features:[o.eg9]})}return n})();var F=function(n){return n.FIXED="fixed",n.FIXED_CENTER="fixed_center",n.FLOATING="floating",n}(F||{}),Q=function(n){return n.SEGMENT="segment",n.STRAIGHT="straight",n.BEZIER="bezier",n}(Q||{});let yt=(()=>{class n{static \u0275fac=function(e){return new(e||n)};static \u0275dir=o.Sc5({type:n,selectors:[["","fConnectionCenter",""]]})}return n})(),_c=0,Vi=(()=>{class n extends Et{fId="f-connection-"+_c++;fText="";fTextStartOffset="";fStartColor="black";fEndColor="black";fOutputId="";fInputId="";fRadius=8;fOffset=32;fBehavior=F.FIXED;fType=Q.STRAIGHT;fDraggingDisabled=!1;fSelectionDisabled=!1;fDefs;fPath;fGradient;fDragHandle;fSelection;fTextComponent;fConnectionCenter;fConnectionCenters;get boundingElement(){return this.fPath.hostElement}_fMediator=(0,o.uUt)(h);constructor(t,e){super(t,e)}ngOnInit(){this._fMediator.send(new Pi(this))}ngOnChanges(){this._fMediator.send(new et)}ngOnDestroy(){this._fMediator.send(new Zi(this))}static \u0275fac=function(e){return new(e||n)(o.GI1(o.GMv),o.GI1(ut))};static \u0275cmp=o.In1({type:n,selectors:[["f-connection"]],contentQueries:function(e,s,r){if(1&e&&o.szK(r,yt,5),2&e){let a;o.wto(a=o.Gqi())&&(s.fConnectionCenters=a)}},viewQuery:function(e,s){if(1&e&&(o.CC$(lo,7),o.CC$(St,7),o.CC$(xt,7),o.CC$(Y,7),o.CC$(K,7),o.CC$(Ct,7),o.CC$(uo,5)),2&e){let r;o.wto(r=o.Gqi())&&(s.fDefs=r.first),o.wto(r=o.Gqi())&&(s.fPath=r.first),o.wto(r=o.Gqi())&&(s.fGradient=r.first),o.wto(r=o.Gqi())&&(s.fDragHandle=r.first),o.wto(r=o.Gqi())&&(s.fSelection=r.first),o.wto(r=o.Gqi())&&(s.fTextComponent=r.first),o.wto(r=o.Gqi())&&(s.fConnectionCenter=r.first)}},hostAttrs:[1,"f-component","f-connection"],hostVars:5,hostBindings:function(e,s){2&e&&(o.e48("id",s.fId),o.eAK("f-connection-selection-disabled",s.fSelectionDisabled)("f-connection-reassign-disabled",s.fDraggingDisabled))},inputs:{fId:[o.Wk5.None,"fConnectionId","fId"],fText:"fText",fTextStartOffset:"fTextStartOffset",fStartColor:"fStartColor",fEndColor:"fEndColor",fOutputId:"fOutputId",fInputId:"fInputId",fRadius:"fRadius",fOffset:"fOffset",fBehavior:[o.Wk5.HasDecoratorInputTransform,"fBehavior","fBehavior",t=>tt(t,"fBehavior",F)],fType:"fType",fDraggingDisabled:[o.Wk5.HasDecoratorInputTransform,"fReassignDisabled","fDraggingDisabled",o.cZD],fSelectionDisabled:[o.Wk5.HasDecoratorInputTransform,"fSelectionDisabled","fSelectionDisabled",o.cZD]},exportAs:["fComponent"],features:[o.M5G([{provide:V,useExisting:n}]),o.QJr,o.eg9,o.SYr],ngContentSelectors:go,decls:12,vars:3,consts:[["xmlns","http://www.w3.org/2000/svg",2,"overflow","visible","display","block","vertical-align","middle"],["defs",""],[1,"f-connection-group"],["fConnectionGradient",""],["fConnectionSelection",""],["f-connection-path",""],["f-connection-drag-handle","","r","8"],["f-connection-text",""],["class","f-connection-center",4,"ngIf"],[1,"f-connection-center"],["fConnectionCenter",""]],template:function(e,s){1&e&&(o.kPM(ho),o.S2Z(),o.I0R(0,"svg",0),o.wR5(1,"defs",null,1),o._Xx(3),o.I0R(4,"g",2),o.wR5(5,"linearGradient",3)(6,"path",4),o.I0R(7,"g"),o.wR5(8,"path",5)(9,"circle",6),o.C$Y(),o.wR5(10,"text",7),o.C$Y()(),o.yuY(11,ra,3,0,"div",8)),2&e&&(o.yG2(6),o.e48("d",s.path),o.yG2(2),o.e48("d",s.path),o.yG2(3),o.E7m("ngIf",s.fConnectionCenters.length))},dependencies:[A.u_,vt,Y,Dt,wt,K],styles:["[_nghost-%COMP%]{pointer-events:none;position:absolute}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]{overflow:visible}[_nghost-%COMP%]   svg[_ngcontent-%COMP%]   .f-connection-group[_ngcontent-%COMP%]{pointer-events:all}[_nghost-%COMP%]   .f-connection-center[_ngcontent-%COMP%]{pointer-events:all}"],changeDetection:0})}return n})();function bc(n){return function Ac(n,i,t){return{point1:n||t.outputRect.gravityCenter,point2:i||t.inputRect.gravityCenter}}(function Oc(n){return ao.getRoundedRectIntersections(n.outputRect.gravityCenter,n.inputRect.gravityCenter,n.outputRect)[0]}(n),function Tc(n){return ao.getRoundedRectIntersections(n.inputRect.gravityCenter,n.outputRect.gravityCenter,n.inputRect)[0]}(n),n)}function Bc(n){return{point1:n.outputRect.gravityCenter,point2:n.inputRect.gravityCenter}}function Uc(n){return{point1:$i(n.outputRect,n.outputSide===D.AUTO?D.BOTTOM:n.outputSide),point2:$i(n.inputRect,n.inputSide===D.AUTO?D.TOP:n.inputSide)}}function $i(n,i){switch(i){case D.TOP:return{x:n.x+n.width/2,y:n.y};case D.BOTTOM:return{x:n.x+n.width/2,y:n.y+n.height};case D.LEFT:return{x:n.x,y:n.y+n.height/2};case D.RIGHT:return{x:n.x+n.width,y:n.y+n.height/2};default:throw new Error(`Unknown side: ${i}`)}}new o.UbH("F_MARKER");let zc=(()=>{let n=class ce{_handlers={[F.FLOATING.toString()]:bc,[F.FIXED_CENTER.toString()]:Bc,[F.FIXED.toString()]:Uc};handle(t){return this._handlers[t.behavior](t)}static \u0275fac=function(e){return new(e||ce)};static \u0275prov=o.wxM({token:ce,factory:ce.\u0275fac})};return n=(0,d.UN)([f(U)],n),n})();class qi{}let Gc=(()=>{let n=class de{fComponentsStore;fMediator;constructor(t,e){this.fComponentsStore=t,this.fMediator=e}handle(t){this.resetConnectors(),this.fComponentsStore.fTempConnection&&this.setMarkers(this.fComponentsStore.fTempConnection),this.fComponentsStore.fSnapConnection&&this.setMarkers(this.fComponentsStore.fSnapConnection),this.fComponentsStore.fConnections.forEach(e=>{const s=this.fComponentsStore.fOutputs.find(a=>a.fId===e.fOutputId),r=this.fComponentsStore.fInputs.find(a=>a.fId===e.fInputId);s&&r&&this.setupConnection(s,r,e)})}resetConnectors(){this.fComponentsStore.fOutputs.forEach(t=>t.setConnected(!1,void 0)),this.fComponentsStore.fInputs.forEach(t=>t.setConnected(!1,void 0))}setupConnection(t,e,s){t.setConnected(!0,e),e.setConnected(!0,t);const r=this.getLine(t,e,s);this.setMarkers(s),s.setLine(r.point1,t.fConnectableSide,r.point2,e.fConnectableSide),s.initialize(),s.isSelected()&&s.select()}getLine(t,e,s){return this.fMediator.execute(new U(this.fMediator.execute(new N(t.hostElement,!0)),this.fMediator.execute(new N(e.hostElement,!0)),s.fBehavior,t.fConnectableSide,e.fConnectableSide))}setMarkers(t){this.fMediator.send(new bi(t))}static \u0275fac=function(e){return new(e||de)(o.CoB(l),o.CoB(h))};static \u0275prov=o.wxM({token:de,factory:de.\u0275fac})};return n=(0,d.UN)([f(qi)],n),n})();class Xi{}let Lc=(()=>{let n=class fe{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fTempConnection=void 0}static \u0275fac=function(e){return new(e||fe)};static \u0275prov=o.wxM({token:fe,factory:fe.\u0275fac})};return n=(0,d.UN)([f(Xi)],n),n})();class Zi{fConnection;constructor(i){this.fConnection=i}}let kc=(()=>{let n=class le{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fConnections.splice(this._getIndexOfConnection(t.fConnection),1),this._fComponentsStore.dataChanged()}_getIndexOfConnection(t){const e=this._fComponentsStore.fConnections.indexOf(t);if(-1===e)throw new Error("Connection not found in store");return e}static \u0275fac=function(e){return new(e||le)};static \u0275prov=o.wxM({token:le,factory:le.\u0275fac})};return n=(0,d.UN)([f(Zi)],n),n})();class Yi{fComponent;constructor(i){this.fComponent=i}}let Hc=(()=>{let n=class ue{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.removeComponent(this._fComponentsStore.fMarkers,t.fComponent)}static \u0275fac=function(e){return new(e||ue)};static \u0275prov=o.wxM({token:ue,factory:ue.\u0275fac})};return n=(0,d.UN)([f(Yi)],n),n})();class Ki{}const Vc=[Ga,La,ka,Ha,Va,Wa,Xa,zc,qa,Gc,Lc,kc,Hc,(()=>{let n=class he{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fSnapConnection=void 0}static \u0275fac=function(e){return new(e||he)};static \u0275prov=o.wxM({token:he,factory:he.\u0275fac})};return n=(0,d.UN)([f(Ki)],n),n})()];class Qi{fComponent;constructor(i){this.fComponent=i}}let Wc=(()=>{let n=class ge{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.addComponent(this._fComponentsStore.fInputs,t.fComponent)}static \u0275fac=function(e){return new(e||ge)};static \u0275prov=o.wxM({token:ge,factory:ge.\u0275fac})};return n=(0,d.UN)([f(Qi)],n),n})();class Ji{fComponent;constructor(i){this.fComponent=i}}let $c=(()=>{let n=class pe{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.addComponent(this._fComponentsStore.fOutlets,t.fComponent)}static \u0275fac=function(e){return new(e||pe)};static \u0275prov=o.wxM({token:pe,factory:pe.\u0275fac})};return n=(0,d.UN)([f(Ji)],n),n})();class ji{fComponent;constructor(i){this.fComponent=i}}let qc=(()=>{let n=class me{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.addComponent(this._fComponentsStore.fOutputs,t.fComponent)}static \u0275fac=function(e){return new(e||me)};static \u0275prov=o.wxM({token:me,factory:me.\u0275fac})};return n=(0,d.UN)([f(ji)],n),n})();class ts{fComponent;constructor(i){this.fComponent=i}}let Xc=(()=>{let n=class Ce{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.removeComponent(this._fComponentsStore.fInputs,t.fComponent)}static \u0275fac=function(e){return new(e||Ce)};static \u0275prov=o.wxM({token:Ce,factory:Ce.\u0275fac})};return n=(0,d.UN)([f(ts)],n),n})();class es{fComponent;constructor(i){this.fComponent=i}}let Zc=(()=>{let n=class ve{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.removeComponent(this._fComponentsStore.fOutlets,t.fComponent)}static \u0275fac=function(e){return new(e||ve)};static \u0275prov=o.wxM({token:ve,factory:ve.\u0275fac})};return n=(0,d.UN)([f(es)],n),n})();class ns{fComponent;constructor(i){this.fComponent=i}}const Yc=[Wc,$c,qc,Xc,Zc,(()=>{let n=class xe{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.removeComponent(this._fComponentsStore.fOutputs,t.fComponent)}static \u0275fac=function(e){return new(e||xe)};static \u0275prov=o.wxM({token:xe,factory:xe.\u0275fac})};return n=(0,d.UN)([f(ns)],n),n})()];class os{fComponent;constructor(i){this.fComponent=i}}let Kc=(()=>{let n=class De{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fDraggable=t.fComponent}static \u0275fac=function(e){return new(e||De)};static \u0275prov=o.wxM({token:De,factory:De.\u0275fac})};return n=(0,d.UN)([f(os)],n),n})();class yo{}class is{event;constructor(i){this.event=i}}class ss{fComponentsStore;onPointerDownPosition=u.initialize();constructor(i){this.fComponentsStore=i}prepareDragSequence(){this.onPointerDownPosition=this.fComponentsStore.fCanvas.transform.position}onPointerMove(i){this.fComponentsStore.fCanvas.setPosition(C.fromPoint(this.onPointerDownPosition).add(i)),this.fComponentsStore.fCanvas.redraw()}onPointerUp(){this.fComponentsStore.fCanvas.emitCanvasChangeEvent()}}let v=(()=>{class n{selectedItems=[];isSelectedChanged=!1;onPointerDownScale=1;onPointerDownPosition=new C(0,0);draggableItems=[];reset(){this.draggableItems=[],this.onPointerDownScale=1,this.onPointerDownPosition=new C(0,0)}markSelectionAsChanged(){this.isSelectedChanged=!0}isEmpty(){return!this.draggableItems.length}static \u0275fac=function(e){return new(e||n)};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac})}return n})();const Qc=[(()=>{let n=class Se{fDraggableDataContext;constructor(t){this.fDraggableDataContext=t}handle(t){this._isValid()&&this.fDraggableDataContext.draggableItems.forEach(e=>e.onPointerUp?.())}_isValid(){return this.fDraggableDataContext.draggableItems.some(t=>t instanceof ss)}static \u0275fac=function(e){return new(e||Se)(o.CoB(v))};static \u0275prov=o.wxM({token:Se,factory:Se.\u0275fac})};return n=(0,d.UN)([f(is)],n),n})()];class Mo{event;constructor(i){this.event=i}}const jc=[...Qc,(()=>{let n=class we{fComponentsStore;fDraggableDataContext;get flowHost(){return this.fComponentsStore.fFlow.hostElement}constructor(t,e){this.fComponentsStore=t,this.fDraggableDataContext=e}handle(t){this.fDraggableDataContext.onPointerDownScale=1,this.fDraggableDataContext.onPointerDownPosition=C.fromPoint(t.event.getPosition()).elementTransform(this.flowHost),this.fDraggableDataContext.draggableItems=[new ss(this.fComponentsStore)]}static \u0275fac=function(e){return new(e||we)(o.CoB(l),o.CoB(v))};static \u0275prov=o.wxM({token:we,factory:we.\u0275fac})};return n=(0,d.UN)([f(Mo)],n),n})(),(()=>{let n=class Ee{fComponentsStore;fDraggableDataContext;get flowHost(){return this.fComponentsStore.fFlow.hostElement}constructor(t,e){this.fComponentsStore=t,this.fDraggableDataContext=e}handle(t){return!this.fDraggableDataContext.draggableItems.length&&(this.isBackgroundElement(t.event.targetElement)||this.isDragOnHost(t.event.targetElement))}isBackgroundElement(t){return this.fComponentsStore.fBackground?.hostElement.contains(t)}isDragOnHost(t){return this.flowHost.contains(t)&&!this.getNode(t)}getNode(t){let e=this.fComponentsStore.fNodes.find(s=>s.isContains(t));return e&&e.fDraggingDisabled&&(e=void 0),e}static \u0275fac=function(e){return new(e||Ee)(o.CoB(l),o.CoB(v))};static \u0275prov=o.wxM({token:Ee,factory:Ee.\u0275fac})};return n=(0,d.UN)([P(Mo)],n),n})()];class rs{event;constructor(i){this.event=i}}function as(n){const t=n(e=>{Error.call(e)});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const cs=as(n=>function(t){n(this),this.message=t||"The requested resource was not found.",this.code=404}),td=as(n=>function(t){n(this),this.message=t||"Conflict error occurred.",this.code=409});function ds(n){return new cs(`Output with fOutputId ${n} not found. Make sure there is no f-connection to a non-existent fOutput.`)}function fs(){return new td("The fNode must contain at least one fOutput if there is an fOutlet")}class Mt{outlet;constructor(i){this.outlet=i}}let ed=(()=>{let n=class ye{fComponentsStore;get fNodes(){return this.fComponentsStore.fNodes}get fOutputs(){return this.fComponentsStore.fOutputs}constructor(t){this.fComponentsStore=t}handle(t){const e=this.getConnectableOutputs(this.getNode(t.outlet));if(!e.length)throw fs();return e.length>0?e[0]:void 0}getConnectableOutputs(t){return this.fOutputs.filter(e=>t.isContains(e.hostElement)&&e.canBeConnected)}getNode(t){return this.fNodes.find(e=>e.isContains(t.hostElement))}static \u0275fac=function(e){return new(e||ye)(o.CoB(l))};static \u0275prov=o.wxM({token:ye,factory:ye.\u0275fac})};return n=(0,d.UN)([f(Mt)],n),n})(),nd=(()=>{let n=class Me{fComponentsStore;get fNodes(){return this.fComponentsStore.fNodes}constructor(t){this.fComponentsStore=t}handle(t){return!!this.fNodes.find(e=>e.isContains(t.outlet.hostElement))}static \u0275fac=function(e){return new(e||Me)(o.CoB(l))};static \u0275prov=o.wxM({token:Me,factory:Me.\u0275fac})};return n=(0,d.UN)([P(Mt)],n),n})();class od{fOutputId;fInputId;fDropPosition;constructor(i,t,e){this.fOutputId=i,this.fInputId=t,this.fDropPosition=e}}class ls{fMediator;fComponentsStore;fOutput;onPointerDownPosition;toConnectorRect=new _;get fConnection(){return this.fComponentsStore.fTempConnection}get fSnapConnection(){return this.fComponentsStore.fSnapConnection}fOutputWithRect;canBeConnectedInputs=[];constructor(i,t,e,s){this.fMediator=i,this.fComponentsStore=t,this.fOutput=e,this.onPointerDownPosition=s}prepareDragSequence(){this._initializeSnapConnection(),this._initializeConnectionForCreate(),this.canBeConnectedInputs=this.fMediator.send(new vo(this.fOutput.fId)),this.fOutputWithRect=this.fMediator.send(new Z(this.fOutput)),this.toConnectorRect=_.fromRect(p.initialize(this.onPointerDownPosition.x,this.onPointerDownPosition.y)),this.fConnection.show(),this.onPointerMove(u.initialize())}_initializeSnapConnection(){this.fSnapConnection&&(this.fSnapConnection.fOutputId=this.fOutput.fId,this.fSnapConnection.initialize())}_initializeConnectionForCreate(){this.fConnection.fOutputId=this.fOutput.fId,this.fConnection.initialize()}onPointerMove(i){const t=this._findClosestInput(i);this._drawConnectionForCreate(this.toConnectorRect.addPoint(i),t?.fConnector.fConnectableSide||D.TOP),this.fSnapConnection&&this._drawSnapConnection(this._getClosestInputForSnapConnection(t))}_drawConnectionForCreate(i,t){const e=this.fMediator.execute(new U(this.fOutputWithRect.fRect,i,this.fConnection.fBehavior,this.fOutputWithRect.fConnector.fConnectableSide,t));this.fConnection.setLine(e.point1,this.fOutputWithRect.fConnector.fConnectableSide,e.point2,t),this.fConnection.redraw()}_drawSnapConnection(i){if(i){const t=this.fMediator.execute(new U(this.fOutputWithRect.fRect,i.fRect,this.fSnapConnection.fBehavior,this.fOutputWithRect.fConnector.fConnectableSide,i.fConnector.fConnectableSide));this.fSnapConnection.show(),this.fSnapConnection.setLine(t.point1,this.fOutputWithRect.fConnector.fConnectableSide,t.point2,i.fConnector.fConnectableSide),this.fSnapConnection.redraw()}else this.fSnapConnection?.hide()}getClosetInput(i){if(this.fSnapConnection)return this._getClosestInputForSnapConnection(this._findClosestInput(i))}_findClosestInput(i){return this.fMediator.send(new Co(C.fromPoint(this.toConnectorRect).add(i),this.canBeConnectedInputs))}_getClosestInputForSnapConnection(i){return i&&i.distance<this.fSnapConnection.fSnapThreshold?i:void 0}onPointerUp(){this.fConnection.redraw(),this.fConnection.hide(),this.fSnapConnection?.hide()}}class It{event;dragHandler;constructor(i,t){this.event=i,this.dragHandler=t}}let id=(()=>{let n=class Ie{fComponentsStore;fDraggableDataContext;fBrowser;get fNodes(){return this.fComponentsStore.fNodes}get fInputs(){return this.fComponentsStore.fInputs}constructor(t,e,s){this.fComponentsStore=t,this.fDraggableDataContext=e,this.fBrowser=s}handle(t){const e=this.getOutput(t.dragHandler)||this.getOutlet(t.dragHandler),s=this.getInputsUnderPointer(t.event.getPosition(),t.dragHandler),r=e.isSelfConnectable?s:this.filterSelfConnectable(s,e);return r.length>0?r[0]:void 0}getOutput(t){return this.fComponentsStore.fOutputs.find(e=>e.fId===t.fConnection.fOutputId)}getOutlet(t){return this.fComponentsStore.fOutlets.find(e=>e.fId===t.fConnection.fOutputId)}getInputsUnderPointer(t,e){const s=this.getInputsInPosition(t),r=e.getClosetInput(this.getDifference(t));r&&s.push(r.fConnector);const a=this.getFirstConnectableInputOfNodeInPosition(t);return a&&s.push(a),s}getDifference(t){return C.fromPoint(t).elementTransform(this.fComponentsStore.flowHost).div(this.fDraggableDataContext.onPointerDownScale).sub(this.fDraggableDataContext.onPointerDownPosition)}getInputsInPosition(t){return this.getElementsFromPoint(t).map(e=>this.fInputs.find(s=>s.isContains(e)&&s.canBeConnected)).filter(e=>!!e)}getElementsFromPoint(t){return this.fBrowser.document.elementsFromPoint(t.x,t.y)}getFirstConnectableInputOfNodeInPosition(t){return this.getNodesInPosition(t).map(e=>this.fInputs.find(s=>e.isContains(s.hostElement)&&s.canBeConnected)).find(e=>!!e)}getNodesInPosition(t){return this.getElementsFromPoint(t).map(e=>this.fNodes.find(s=>s.isContains(e)&&s.fConnectOnNode)).filter(e=>!!e)}filterSelfConnectable(t,e){return t.filter(s=>{const r=this.fNodes.find(c=>c.isContains(s.hostElement));return this.fNodes.find(c=>c.isContains(e.hostElement))?.hostElement!==r?.hostElement})}static \u0275fac=function(e){return new(e||Ie)(o.CoB(l),o.CoB(v),o.CoB(y))};static \u0275prov=o.wxM({token:Ie,factory:Ie.\u0275fac})};return n=(0,d.UN)([f(It)],n),n})(),sd=(()=>{let n=class _e{fComponentsStore;constructor(t){this.fComponentsStore=t}handle(t){if(!this.getOutput(t.dragHandler)&&!this.getOutlet(t.dragHandler))throw ds(t.dragHandler.fConnection.fOutputId);return!0}getOutput(t){return this.fComponentsStore.fOutputs.find(e=>e.fId===t.fConnection.fOutputId)}getOutlet(t){return this.fComponentsStore.fOutlets.find(e=>e.fId===t.fConnection.fOutputId)}static \u0275fac=function(e){return new(e||_e)(o.CoB(l))};static \u0275prov=o.wxM({token:_e,factory:_e.\u0275fac})};return n=(0,d.UN)([P(It)],n),n})(),rd=(()=>{let n=class Ne{fComponentsStore;fDraggableDataContext;fMediator;get dragHandler(){return this.fDraggableDataContext.draggableItems[0]}constructor(t,e,s){this.fComponentsStore=t,this.fDraggableDataContext=e,this.fMediator=s}handle(t){this._isValid()&&(this.emitEvent(t.event),this.dragHandler.onPointerUp())}_isValid(){return this.fDraggableDataContext.draggableItems.some(t=>t instanceof ls)}getTargetOutput(t){if(!t)throw ds(this.dragHandler.fConnection.fOutputId);return Gi(t.hostElement)?this.fMediator.send(new Mt(t)):t}getOutput(){return this.fComponentsStore.fOutputs.find(t=>t.fId===this.dragHandler.fConnection.fOutputId)}getOutlet(){return this.fComponentsStore.fOutlets.find(t=>t.fId===this.dragHandler.fConnection.fOutputId)}emitEvent(t){this.fComponentsStore.fDraggable?.fCreateConnection.emit(new od(this.getTargetOutput(this.getOutput()||this.getOutlet()).fId,this.getInputUnderPointer(t)?.fId,t.getPosition()))}getInputUnderPointer(t){return this.fMediator.send(new It(t,this.dragHandler))}static \u0275fac=function(e){return new(e||Ne)(o.CoB(l),o.CoB(v),o.CoB(h))};static \u0275prov=o.wxM({token:Ne,factory:Ne.\u0275fac})};return n=(0,d.UN)([f(rs)],n),n})();class Io{onPointerDownPosition;connector;constructor(i,t){this.onPointerDownPosition=i,this.connector=t}}let ad=(()=>{let n=class Re{fComponentsStore;fDraggableDataContext;fMediator;get flowHost(){return this.fComponentsStore.flowHost}get transform(){return this.fComponentsStore.fCanvas.transform}constructor(t,e,s){this.fComponentsStore=t,this.fDraggableDataContext=e,this.fMediator=s}handle(t){this.fDraggableDataContext.onPointerDownScale=this.transform.scale;const e=C.fromPoint(t.onPointerDownPosition).elementTransform(this.flowHost).div(this.transform.scale);this.fDraggableDataContext.onPointerDownPosition=e;const s=C.fromPoint(e).mult(this.transform.scale).sub(this.transform.position).sub(this.transform.scaledPosition).div(this.transform.scale);this.fDraggableDataContext.draggableItems=[new ls(this.fMediator,this.fComponentsStore,t.connector,s)]}static \u0275fac=function(e){return new(e||Re)(o.CoB(l),o.CoB(v),o.CoB(h))};static \u0275prov=o.wxM({token:Re,factory:Re.\u0275fac})};return n=(0,d.UN)([f(Io)],n),n})();class us{event;constructor(i){this.event=i}}let cd=(()=>{let n=class Pe{fComponentsStore;fMediator;constructor(t,e){this.fComponentsStore=t,this.fMediator=e}handle(t){const{event:e}=t,s=this.fComponentsStore.fNodes.find(c=>c.isContains(e.targetElement)),r=this.fComponentsStore.fOutlets.find(c=>c.hostElement.contains(e.targetElement));if(!r)throw new Error("Outlet not found");const a=this.fComponentsStore.fOutputs.filter(c=>s.isContains(c.hostElement));if(r.setOutputs(a),r.canBeConnected)if(r.isConnectionFromOutlet)this.createDragHandler(e.getPosition(),r);else{const c=this.fMediator.send(new Mt(r));if(!c)throw fs();this.createDragHandler(e.getPosition(),c)}}createDragHandler(t,e){this.fMediator.send(new Io(t,e))}static \u0275fac=function(e){return new(e||Pe)(o.CoB(l),o.CoB(h))};static \u0275prov=o.wxM({token:Pe,factory:Pe.\u0275fac})};return n=(0,d.UN)([f(us)],n),n})();class _o{event;constructor(i){this.event=i}}let dd=(()=>{let n=class Fe{fComponentsStore;fMediator;constructor(t,e){this.fComponentsStore=t,this.fMediator=e}handle(t){const{event:e}=t,s=this.fComponentsStore.fOutputs.find(r=>r.hostElement.contains(e.targetElement));if(!s)throw new Error("Output not found");s.canBeConnected&&this.createDragHandler(e.getPosition(),s)}createDragHandler(t,e){this.fMediator.send(new Io(t,e))}static \u0275fac=function(e){return new(e||Fe)(o.CoB(l),o.CoB(h))};static \u0275prov=o.wxM({token:Fe,factory:Fe.\u0275fac})};return n=(0,d.UN)([f(_o)],n),n})(),fd=(()=>{let n=class be{fComponentsStore;constructor(t){this.fComponentsStore=t}handle(t){return this.isNodeOutput(t.event.targetElement,this.getNode(t.event))}getNode(t){return this.fComponentsStore.fNodes.find(e=>e.isContains(t.targetElement))}isNodeOutput(t,e){return Li(t)&&!this.getOutlets(e).length}getOutlets(t){return this.fComponentsStore.fOutlets.filter(e=>t.isContains(e.hostElement))}static \u0275fac=function(e){return new(e||be)(o.CoB(l))};static \u0275prov=o.wxM({token:be,factory:be.\u0275fac})};return n=(0,d.UN)([P(_o)],n),n})();class hs{event;constructor(i){this.event=i}}let ld=(()=>{let n=class Oe{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);_fDraggableDataContext=(0,o.uUt)(v);handle(t){this._isValid(t)&&(Gi(t.event.targetElement)?this._fMediator.send(new us(t.event)):this.isNodeOutput(t.event.targetElement,this._getNode(t.event))&&this._fMediator.send(new _o(t.event)))}_isValid(t){return!!this._getNode(t.event)&&this._isValidConditions()}_getNode(t){return this._fComponentsStore.fNodes.find(e=>e.isContains(t.targetElement))}_isValidConditions(){return!this._fDraggableDataContext.draggableItems.length&&!!this._fComponentsStore.fTempConnection}isNodeOutput(t,e){return Li(t)&&!this.getOutlets(e).length}getOutlets(t){return this._fComponentsStore.fOutlets.filter(e=>t.isContains(e.hostElement))}static \u0275fac=function(e){return new(e||Oe)};static \u0275prov=o.wxM({token:Oe,factory:Oe.\u0275fac})};return n=(0,d.UN)([f(hs)],n),n})();class gs{event;constructor(i){this.event=i}}class ps{fMediator;fComponentsStore;fConnection;toConnectorRect=new _;get fSnapConnection(){return this.fComponentsStore.fSnapConnection}fOutputWithRect;fInputWithRect;canBeConnectedInputs=[];constructor(i,t,e){this.fMediator=i,this.fComponentsStore=t,this.fConnection=e}prepareDragSequence(){this._initializeSnapConnection(),this.canBeConnectedInputs=this.fMediator.send(new vo(this.fConnection.fOutputId)),this.fOutputWithRect=this.fMediator.send(new Z(this.getOutput())),this.fInputWithRect=this.fMediator.send(new Z(this.getInput())),this.toConnectorRect=_.fromRect(p.initialize(this.fConnection.line.point2.x,this.fConnection.line.point2.y))}_initializeSnapConnection(){this.fSnapConnection&&(this.fSnapConnection.fOutputId=this.fConnection.fOutputId,this.fSnapConnection.initialize())}getOutput(){return this.fComponentsStore.fOutputs.find(i=>i.fId===this.fConnection.fOutputId)}getInput(){return this.fComponentsStore.fInputs.find(i=>i.fId===this.fConnection.fInputId)}onPointerMove(i){const t=this._findClosestInput(i);this._drawConnection(this.toConnectorRect.addPoint(i),t?.fConnector.fConnectableSide||this.fInputWithRect.fConnector.fConnectableSide),this.fSnapConnection&&this._drawSnapConnection(this._getClosestInputForSnapConnection(t))}_drawConnection(i,t){const e=this._getLineToPointer(i,t);this.fConnection.setLine(e.point1,this.fOutputWithRect.fConnector.fConnectableSide,e.point2,t),this.fConnection.redraw()}_getLineToPointer(i,t){return this.fMediator.execute(new U(this.fOutputWithRect.fRect,i,this.fConnection.fBehavior,this.fOutputWithRect.fConnector.fConnectableSide,t))}_drawSnapConnection(i){if(i){const t=this._getLineToClosestInput(i);this.fSnapConnection.show(),this.fSnapConnection.setLine(t.point1,this.fOutputWithRect.fConnector.fConnectableSide,t.point2,i.fConnector.fConnectableSide),this.fSnapConnection.redraw()}else this.fSnapConnection?.hide()}_getLineToClosestInput(i){return this.fMediator.execute(new U(this.fOutputWithRect.fRect,i.fRect,this.fSnapConnection.fBehavior,this.fOutputWithRect.fConnector.fConnectableSide,i.fConnector.fConnectableSide))}getClosetInput(i){if(this.fSnapConnection)return this._getClosestInputForSnapConnection(this._findClosestInput(i))}_findClosestInput(i){return this.fMediator.send(new Co(C.fromPoint(this.toConnectorRect).add(i),this.canBeConnectedInputs))}_getClosestInputForSnapConnection(i){return i&&i.distance<this.fSnapConnection.fSnapThreshold?i:void 0}onPointerUp(){this._drawConnection(this.fInputWithRect.fRect,this.fInputWithRect.fConnector.fConnectableSide),this.fSnapConnection?.hide()}}class ud{fConnectionId;fOutputId;oldFInputId;newFInputId;fDropPosition;constructor(i,t,e,s,r){this.fConnectionId=i,this.fOutputId=t,this.oldFInputId=e,this.newFInputId=s,this.fDropPosition=r}}let hd=(()=>{let n=class Te{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);_fDraggableDataContext=(0,o.uUt)(v);get _fDraggable(){return this._fComponentsStore.fDraggable}get _fDragHandler(){return this._fDraggableDataContext.draggableItems[0]}handle(t){this._isDroppedConnectionReassignEvent()&&(this._applyReassignEvent(t.event),this._fDragHandler.onPointerUp())}_isDroppedConnectionReassignEvent(){return this._fDraggableDataContext.draggableItems.some(t=>t instanceof ps)}_applyReassignEvent(t){const e=this._getInputUnderPointer(t);e&&!this._isReassignToDifferentInput(e)||this._emitReassignConnectionEvent(t,e)}_getInputUnderPointer(t){return this._fMediator.send(new It(t,this._fDragHandler))}_isReassignToDifferentInput(t){return this._fDragHandler.fConnection.fInputId!==t.fId}_emitReassignConnectionEvent(t,e){this._fDraggable.fReassignConnection.emit(this._getEventData(t,e))}_getEventData(t,e){return new ud(this._fDragHandler.fConnection.fId,this._fDragHandler.fConnection.fOutputId,this._fDragHandler.fConnection.fInputId,e?.fId,t.getPosition())}static \u0275fac=function(e){return new(e||Te)};static \u0275prov=o.wxM({token:Te,factory:Te.\u0275fac})};return n=(0,d.UN)([f(gs)],n),n})();class ms{event;constructor(i){this.event=i}}const gd=[id,sd,rd,ad,cd,ed,nd,dd,fd,ld,hd,(()=>{let n=class Ae{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);_fDraggableDataContext=(0,o.uUt)(v);_fConnection;get _transform(){return this._fComponentsStore.fCanvas.transform}get _fHost(){return this._fComponentsStore.fFlow.hostElement}get _fConnections(){return this._fComponentsStore.fConnections}handle(t){this._isValid(t)&&(this._fDraggableDataContext.onPointerDownScale=this._transform.scale,this._fDraggableDataContext.onPointerDownPosition=C.fromPoint(t.event.getPosition()).elementTransform(this._fHost).div(this._transform.scale),this._fDraggableDataContext.draggableItems=[new ps(this._fMediator,this._fComponentsStore,this._fConnection)],setTimeout(()=>this._updateConnectionLayer()))}_isValid(t){return this._fConnection=this._getConnectionToReassign(this._getPointInFlow(t)),!!this._fConnection&&!this._fDraggableDataContext.draggableItems.length}_getPointInFlow(t){return C.fromPoint(t.event.getPosition()).elementTransform(this._fHost).sub(this._transform.scaledPosition).sub(this._transform.position).div(this._transform.scale)}_getConnectionToReassign(t){const e=this._getConnectionsFromPoint(t);return e.length?e[0]:void 0}_getConnectionsFromPoint(t){return this._fConnections.filter(e=>this._isPointInsideCircle(t,e.fDragHandle.point)&&!e.fDraggingDisabled)}_isPointInsideCircle(t,e){return(t.x-e.x)**2+(t.y-e.y)**2<=64}_updateConnectionLayer(){this._fMediator.execute(new Rt(this._fConnection,this._fComponentsStore.fCanvas.fConnectionsContainer.nativeElement))}static \u0275fac=function(e){return new(e||Ae)};static \u0275prov=o.wxM({token:Ae,factory:Ae.\u0275fac})};return n=(0,d.UN)([f(ms)],n),n})()];class No{fNode;constructor(i){this.fNode=i}}let pd=(()=>{let n=class Be{fComponentsStore;fMediator;constructor(t,e){this.fComponentsStore=t,this.fMediator=e}handle(t){let e=p.initialize(-1/0,-1/0,1/0,1/0);const s=this.getNode(t.fNode.fParentId);return s&&(e=this.getParentRect(s)),e}getNode(t){return this.fComponentsStore.fNodes.find(e=>e.fId===t)}getParentRect(t){const e=this._getNodeRect(t),s=this.getNodePadding(t,e);return p.initialize(e.x+s[0],e.y+s[1],e.width-s[0]-s[2],e.height-s[1]-s[3])}_getNodeRect(t){return this.fMediator.send(new N(t.hostElement,!1))}getNodePadding(t,e){return this.fMediator.send(new $o(t,e))}static \u0275fac=function(e){return new(e||Be)(o.CoB(l),o.CoB(h))};static \u0275prov=o.wxM({token:Be,factory:Be.\u0275fac})};return n=(0,d.UN)([f(No)],n),n})();class Cs{fParentNodes;fDraggedNodes;constructor(i,t){this.fParentNodes=i,this.fDraggedNodes=t}}let md=(()=>{let n=class Ue{handle(t){return this._isParentNodeInArray(this._getParentNodeIds(t.fParentNodes),t.fDraggedNodes)}_getParentNodeIds(t){return t.map(e=>e.fId)}_isParentNodeInArray(t,e){return e.some(s=>t.includes(s.fId))}static \u0275fac=function(e){return new(e||Ue)};static \u0275prov=o.wxM({token:Ue,factory:Ue.\u0275fac})};return n=(0,d.UN)([f(Cs)],n),n})();class Cd{fNodeId;fConnectionIds;constructor(i,t){this.fNodeId=i,this.fConnectionIds=t}}class vs{fNode;constructor(i){this.fNode=i}}const vd=[pd,md,(()=>{let n=class ze{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);handle(t){const e=this._getOutputConnectors(t.fNode),s=this._getInputConnectors(t.fNode);if(!e.length||!s.length)return;const r=this._getOutputConnectionsId(e),a=this._getInputConnectionsId(s),c=this._calculateConnectionsUnderNode(t.fNode).filter(g=>!r.includes(g.fId)&&!a.includes(g.fId));c.length&&this._emitNodeIntersectedWithConnections(t.fNode,c)}_getOutputConnectors(t){return this._fComponentsStore.fOutputs.filter(e=>t.isContains(e.hostElement)&&e.canBeConnected)}_getInputConnectors(t){return this._fComponentsStore.fInputs.filter(e=>t.isContains(e.hostElement)&&e.canBeConnected)}_getOutputConnectionsId(t){const e=this._getConnectorsId(t);return this._fComponentsStore.fConnections.filter(s=>e.includes(s.fOutputId)).map(s=>s.fId)}_getInputConnectionsId(t){const e=this._getConnectorsId(t);return this._fComponentsStore.fConnections.filter(s=>e.includes(s.fInputId)).map(s=>s.fId)}_getConnectorsId(t){return t.map(e=>e.fId)}_calculateConnectionsUnderNode(t){const e=this._fMediator.send(new N(t.hostElement,!0));return this._fComponentsStore.fConnections.filter(s=>this._isConnectionHasIntersectionsWithNode(s,e))}_isConnectionHasIntersectionsWithNode(t,e){return ao.getRoundedRectIntersectionsWithSVGPath(t.fPath.hostElement,e).length>0}_emitNodeIntersectedWithConnections(t,e){this._fComponentsStore.fDraggable?.fNodeIntersectedWithConnections.emit(new Cd(t.fId,e.map(s=>s.fId)))}static \u0275fac=function(e){return new(e||ze)};static \u0275prov=o.wxM({token:ze,factory:ze.\u0275fac})};return n=(0,d.UN)([f(vs)],n),n})()];class xs{}let xd=(()=>{let n=class Ge{_fComponentsStore=(0,o.uUt)(l);handle(t){return!!this._fComponentsStore.fDraggable?.isDragStarted}static \u0275fac=function(e){return new(e||Ge)};static \u0275prov=o.wxM({token:Ge,factory:Ge.\u0275fac})};return n=(0,d.UN)([f(xs)],n),n})();class Ds{restrictions;constructor(i){this.restrictions=i}}let Dd=(()=>{let n=class Le{handle(t){return this._calculateCommonRestrictions(t.restrictions)}_calculateCommonRestrictions(t){return t.reduce((e,s)=>this._clampRestrictions(e,s),t[0])}_clampRestrictions(t,e){return t.min=this._clampMinRestrictions(t.min,e.min),t.max=this._clampMaxRestrictions(t.max,e.max),t}_clampMinRestrictions(t,e){return{x:Math.max(t.x,e.x),y:Math.max(t.y,e.y)}}_clampMaxRestrictions(t,e){return{x:Math.min(t.x,e.x),y:Math.min(t.y,e.y)}}static \u0275fac=function(e){return new(e||Le)};static \u0275prov=o.wxM({token:Le,factory:Le.\u0275fac})};return n=(0,d.UN)([f(Ds)],n),n})();class Ss{nodeDragHandler;outputIds;result;constructor(i,t,e){this.nodeDragHandler=i,this.outputIds=t,this.result=e}}let Ro=(()=>{class n{fMediator;fComponentsStore;connection;fOutputWithRect;fInputWithRect;constructor(t,e,s){this.fMediator=t,this.fComponentsStore=e,this.connection=s}prepareDragSequence(){this.fOutputWithRect=this.fMediator.send(new Z(this.getOutput())),this.fInputWithRect=this.fMediator.send(new Z(this.getInput()))}getOutput(){const t=this.fComponentsStore.fOutputs.find(e=>e.fId===this.connection.fOutputId);if(!t)throw new Error(this.connectorNotFoundPrefix(`fOutput with id ${this.connection.fOutputId} not found`));return t}getInput(){const t=this.fComponentsStore.fInputs.find(e=>e.fId===this.connection.fInputId);if(!t)throw new Error(this.connectorNotFoundPrefix(`fInput with id ${this.connection.fInputId} not found`));return t}connectorNotFoundPrefix(t){return`ConnectionDragHandler Error: Connection From (fOutput)${this.connection.fOutputId} To (fInput)${this.connection.fInputId}. ${t}. Please ensure that all f-connections are associated with existing connectors`}getRestrictedDifference(t,e){return{x:Math.min(Math.max(t.x,e.min.x),e.max.x),y:Math.min(Math.max(t.y,e.min.y),e.max.y)}}redrawConnection(t){this.connection.setLine(t.point1,this.fOutputWithRect.fConnector.fConnectableSide,t.point2,this.fInputWithRect.fConnector.fConnectableSide),this.connection.redraw()}static \u0275fac=function(e){return new(e||n)(o.GI1(h),o.GI1(l),o.GI1(Et))};static \u0275dir=o.Sc5({type:n})}return n})();class _t extends Ro{sourceRestrictions;targetRestrictions;constructor(i,t,e){super(i,t,e)}setOutputRestrictions(i){this.sourceRestrictions=i}setInputRestrictions(i){this.targetRestrictions=i}onPointerMove(i){this.redrawConnection(this.getNewLineValue(i))}getNewLineValue(i){return this.fMediator.execute(new U(_.fromRoundedRect(this.fOutputWithRect.fRect).addPoint(this.getRestrictedDifference({...i},this.sourceRestrictions)),_.fromRoundedRect(this.fInputWithRect.fRect).addPoint(this.getRestrictedDifference({...i},this.targetRestrictions)),this.connection.fBehavior,this.fOutputWithRect.fConnector.fConnectableSide,this.fInputWithRect.fConnector.fConnectableSide))}}class Sd extends Ro{restrictions;constructor(i,t,e,s){super(i,t,e),this.restrictions=s}onPointerMove(i){this.redrawConnection(this.getNewLineValue(i))}getNewLineValue(i){return this.fMediator.execute(new U(this.fOutputWithRect.fRect,_.fromRoundedRect(this.fInputWithRect.fRect).addPoint(this.getRestrictedDifference({...i},this.restrictions)),this.connection.fBehavior,this.fOutputWithRect.fConnector.fConnectableSide,this.fInputWithRect.fConnector.fConnectableSide))}}let wd=(()=>{let n=class ke{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);get _fConnections(){return this._fComponentsStore.fConnections}handle(t){this.getInputConnections(t.nodeDragHandler.fNode).forEach(e=>{const s=this.getExistingConnectionHandlerIndex(t.result,e);-1!==s?this.updateExistingConnectionHandler(t.result,s,t.nodeDragHandler):t.result.push(this.createNewConnectionHandler(t.nodeDragHandler,t.outputIds,e))})}getInputConnections(t){const e=new Set(this.getInputsForNode(t).map(s=>s.fId));return this._fConnections.filter(s=>e.has(s.fInputId))}getInputsForNode(t){return this._fComponentsStore.fInputs.filter(e=>t.isContains(e.hostElement))}getExistingConnectionHandlerIndex(t,e){return t.findIndex(s=>s instanceof _t&&s.connection.fId===e.fId)}createNewConnectionHandler(t,e,s){let r;return r=e.includes(s.fOutputId)?this.getNewConnectionHandler(s,t):this.getNewSourceConnectionHandler(s,t),r}getNewConnectionHandler(t,e){const s=new _t(this._fMediator,this._fComponentsStore,t);return s.setInputRestrictions(e.restrictions),s}updateExistingConnectionHandler(t,e,s){t[e].setInputRestrictions(s.restrictions)}getNewSourceConnectionHandler(t,e){return new Sd(this._fMediator,this._fComponentsStore,t,e.restrictions)}static \u0275fac=function(e){return new(e||ke)};static \u0275prov=o.wxM({token:ke,factory:ke.\u0275fac})};return n=(0,d.UN)([f(Ss)],n),n})();class ws{nodeDragHandler;inputIds;result;constructor(i,t,e){this.nodeDragHandler=i,this.inputIds=t,this.result=e}}class Ed extends Ro{restrictions;constructor(i,t,e,s){super(i,t,e),this.restrictions=s}onPointerMove(i){this.redrawConnection(this.getNewLineValue(i))}getNewLineValue(i){return this.fMediator.execute(new U(_.fromRoundedRect(this.fOutputWithRect.fRect).addPoint(this.getRestrictedDifference({...i},this.restrictions)),this.fInputWithRect.fRect,this.connection.fBehavior,this.fOutputWithRect.fConnector.fConnectableSide,this.fInputWithRect.fConnector.fConnectableSide))}}let yd=(()=>{let n=class He{fComponentsStore;fMediator;get fConnections(){return this.fComponentsStore.fConnections}constructor(t,e){this.fComponentsStore=t,this.fMediator=e}handle(t){this.getOutputConnections(t.nodeDragHandler.fNode).forEach(e=>{const s=this.getExistingConnectionHandlerIndex(t.result,e);-1!==s?this.updateExistingConnectionHandler(t.result,s,t.nodeDragHandler):t.result.push(this.createNewConnectionHandler(t.nodeDragHandler,t.inputIds,e))})}getOutputConnections(t){const e=new Set(this.getOutputsForNode(t).map(s=>s.fId));return this.fConnections.filter(s=>e.has(s.fOutputId))}getOutputsForNode(t){return this.fComponentsStore.fOutputs.filter(e=>t.isContains(e.hostElement))}getExistingConnectionHandlerIndex(t,e){return t.findIndex(s=>s instanceof _t&&s.connection.fId===e.fId)}createNewConnectionHandler(t,e,s){let r;return r=e.includes(s.fInputId)?this.getNewConnectionHandler(s,t):this.getNewSourceConnectionHandler(s,t),r}getNewConnectionHandler(t,e){const s=new _t(this.fMediator,this.fComponentsStore,t);return s.setOutputRestrictions(e.restrictions),s}updateExistingConnectionHandler(t,e,s){t[e].setOutputRestrictions(s.restrictions)}getNewSourceConnectionHandler(t,e){return new Ed(this.fMediator,this.fComponentsStore,t,e.restrictions)}static \u0275fac=function(e){return new(e||He)(o.CoB(l),o.CoB(h))};static \u0275prov=o.wxM({token:He,factory:He.\u0275fac})};return n=(0,d.UN)([f(ws)],n),n})();class Es{fNode;hasParentNodeInSelected;constructor(i,t){this.fNode=i,this.hasParentNodeInSelected=t}}let Md=(()=>{let n=class Ve{_fMediator=(0,o.uUt)(h);handle(t){if(!t.fNode.fParentId||t.hasParentNodeInSelected)return{...Id};const e=this._getParentNodeRect(t.fNode),s=this._getNodeRect(t.fNode);return{min:u.initialize(e.x-s.x,e.y-s.y),max:u.initialize(e.x+e.width-(s.x+s.width),e.y+e.height-(s.y+s.height))}}_getNodeRect(t){return this._fMediator.execute(new N(t.hostElement,!1))}_getParentNodeRect(t){return this._fMediator.execute(new No(t))}static \u0275fac=function(e){return new(e||Ve)};static \u0275prov=o.wxM({token:Ve,factory:Ve.\u0275fac})};return n=(0,d.UN)([f(Es)],n),n})();const Id={min:u.initialize(-1/0,-1/0),max:u.initialize(1/0,1/0)};class ys{nodeWithDisabledSelection;constructor(i){this.nodeWithDisabledSelection=i}}class b{_fComponentsStore;fNode;restrictions;_onPointerDownPosition=u.initialize();constructor(i,t,e){this._fComponentsStore=i,this.fNode=t,this.restrictions=e,this._onPointerDownPosition={...t.position}}onPointerMove(i){const t=this._getDifference(i);this._redraw(this._getPosition(t))}_getPosition(i){return C.fromPoint(this._onPointerDownPosition).add(i)}_getDifference(i){return{x:Math.min(Math.max(i.x,this.restrictions.min.x),this.restrictions.max.x),y:Math.min(Math.max(i.y,this.restrictions.min.y),this.restrictions.max.y)}}_redraw(i){this.fNode.updatePosition(i),this.fNode.redraw()}onPointerUp(){this.fNode.positionChange.emit(this.fNode.position)}getDifferenceWithCellSize(i){const t=this._getPosition(this._getDifference(i));return C.fromPoint(this._applyCellSize(t)).sub(this._onPointerDownPosition)}_applyCellSize(i){const t=this._fComponentsStore.fDraggable.hCellSize,e=this._fComponentsStore.fDraggable.vCellSize;return{x:Math.round(i.x/t)*t,y:Math.round(i.y/e)*e}}}class _d{fDraggableDataContext;onPointerDownPosition=u.initialize();constructor(i){this.fDraggableDataContext=i}prepareDragSequence(){}onPointerMove(i){}onPointerUp(){}}const Nd=[Dd,Md,wd,yd,(()=>{let n=class We{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);_fDraggableDataContext=(0,o.uUt)(v);handle(t){const e=this._getNodesWithRestrictions(this._getDraggedNodes(t.nodeWithDisabledSelection));return this.getDragHandlersWithConnections(this.getDragHandlersFromNodes(e),this.getAllOutputIds(e),this.getAllInputIds(e))}_getDraggedNodes(t){const e=this._getNodesFromSelection();return t&&e.push(t),e}_getNodesFromSelection(){return this._fDraggableDataContext.selectedItems.map(t=>this._findNode(t.hostElement)).filter(t=>!!t)}_findNode(t){return this._fComponentsStore.fNodes.find(e=>e.isContains(t))}_getNodesWithRestrictions(t){const e=[];return t.forEach(s=>{const r=this._fMediator.execute(new qo(s)),a=this._getNodeMoveRestrictions(s,r,t);e.push({fDraggedNode:s,fParentNodes:r,...a},...this._getChildrenItemsToDrag(s,a))}),this._applyCommonRestrictions(e),e}_getNodeMoveRestrictions(t,e,s){return this._fMediator.execute(new Es(t,this._isParentNodeInArray(e,s)))}_isParentNodeInArray(t,e){return this._fMediator.execute(new Cs(t,e))}_getChildrenItemsToDrag(t,e){return this._getChildrenNodes(t.fId).map(s=>({fDraggedNode:s,...e}))}_getChildrenNodes(t){return this._fMediator.execute(new it(t))}_applyCommonRestrictions(t){const e=this._fMediator.execute(new Ds(t));t.forEach(s=>{s.min=e.min,s.max=e.max})}getAllOutputIds(t){return ii(t,e=>this.getOutputsForNode(e.fDraggedNode).map(s=>s.fId))}getOutputsForNode(t){return this._fComponentsStore.fOutputs.filter(e=>t.isContains(e.hostElement))}getAllInputIds(t){return ii(t,e=>this.getInputsForNode(e.fDraggedNode).map(s=>s.fId))}getInputsForNode(t){return this._fComponentsStore.fInputs.filter(e=>t.isContains(e.hostElement))}getDragHandlersFromNodes(t){let e=[];return t.forEach(s=>{e.push(new b(this._fComponentsStore,s.fDraggedNode,{min:s.min,max:s.max}),...(s.fParentNodes||[]).map(()=>new _d(this._fDraggableDataContext)))}),e}getDragHandlersWithConnections(t,e,s){let r=t;return t.filter(a=>a instanceof b).forEach(a=>{this._fMediator.execute(new ws(a,s,r)),this._fMediator.execute(new Ss(a,e,r))}),r}static \u0275fac=function(e){return new(e||We)};static \u0275prov=o.wxM({token:We,factory:We.\u0275fac})};return n=(0,d.UN)([f(ys)],n),n})()];class Ms{}class Is{_fComponentsStore;_lineService;_size;_draggedNodeRect;_rects;_restrictions;_debounceTimer=null;_transform;constructor(i,t,e,s,r,a){this._fComponentsStore=i,this._lineService=t,this._size=e,this._draggedNodeRect=s,this._rects=r,this._restrictions=a,this._transform=this._fComponentsStore.fCanvas?.transform}onPointerMove(i){const t=this._getDifference(i);this._debounceTimer&&clearTimeout(this._debounceTimer),this._debounceTimer=setTimeout(()=>this._drawIntersectingLines(t),15)}_drawIntersectingLines(i){const t=this.findNearestCoordinate(i);void 0!==t.xResult.value?this._lineService.drawVerticalLine(t.xResult.value,this._size,this._transform):this._lineService.hideVerticalLine(),void 0!==t.yResult.value?this._lineService.drawHorizontalLine(t.yResult.value,this._size,this._transform):this._lineService.hideHorizontalLine()}_getDifference(i){return{x:Math.min(Math.max(i.x,this._restrictions.min.x),this._restrictions.max.x),y:Math.min(Math.max(i.y,this._restrictions.min.y),this._restrictions.max.y)}}findNearestCoordinate(i){const t=p.addPoint(this._draggedNodeRect,i);return function Ir(n,i,t=10){let e,s,r,a;for(const c of n){const x=c.x+c.width,S=c.y+c.height,R={x:[{value:c.x,distance:i.x-c.x},{value:x,distance:i.x-x},{value:c.gravityCenter.x,distance:i.gravityCenter.x-c.gravityCenter.x},{value:c.x,distance:i.x+i.width-c.x},{value:x,distance:i.x+i.width-x}],y:[{value:c.y,distance:i.y-c.y},{value:S,distance:i.y-S},{value:c.gravityCenter.y,distance:i.gravityCenter.y-c.gravityCenter.y},{value:c.y,distance:i.y+i.height-c.y},{value:S,distance:i.y+i.height-S}]};for(const{value:M,distance:I}of R.x)Math.abs(I)<=t&&(void 0===s||Math.abs(I)<Math.abs(s))&&(s=I,e=M);for(const{value:M,distance:I}of R.y)Math.abs(I)<=t&&(void 0===a||Math.abs(I)<Math.abs(a))&&(a=I,r=M)}return{xResult:{value:e,distance:s},yResult:{value:r,distance:a}}}(this._rects,t,this._fComponentsStore.fLineAlignment.fAlignThreshold)}onPointerUp(){this._lineService.hideVerticalLine(),this._lineService.hideHorizontalLine(),this._debounceTimer&&(clearTimeout(this._debounceTimer),this._debounceTimer=null)}}class _s{hostElement;element;constructor(i,t){this.hostElement=t,this.element=i.document.createElement("div"),this.hostElement.appendChild(this.element),this.element.classList.add("f-line")}hide(){this.element.style.display="none"}show(){this.element.style.display="block"}draw(i){this.element.style.position="absolute",Object.keys(i).forEach(t=>{this.element.style[t]=i[t]+"px"})}}class Rd{hostElement;fHorizontalLine;fVerticalLine;constructor(i,t){this.hostElement=t,this.fHorizontalLine=new _s(i,this.hostElement),this.fVerticalLine=new _s(i,this.hostElement),this.fHorizontalLine.hide(),this.fVerticalLine.hide()}drawVerticalLine(i,t,e){this.fVerticalLine.show(),this.fVerticalLine.draw({left:i*e.scale+e.position.x+e.scaledPosition.x,top:0,width:1,height:t.height})}drawHorizontalLine(i,t,e){this.fHorizontalLine.show(),this.fHorizontalLine.draw({left:0,top:i*e.scale+e.position.y+e.scaledPosition.y,width:t.width,height:1})}hideVerticalLine(){this.fVerticalLine.hide()}hideHorizontalLine(){this.fHorizontalLine.hide()}}new o.UbH("F_LINE_ALIGNMENT");let bd=(()=>{let n=class $e{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);_fDraggableDataContext=(0,o.uUt)(v);_fBrowser=(0,o.uUt)(y);_lineService;handle(t){this._addLineAlignmentDragHandler(this._getDraggedNodes())}_getDraggedNodes(){return this._fDraggableDataContext.draggableItems.filter(t=>t instanceof b).map(t=>t.fNode)}_addLineAlignmentDragHandler(t){this._fDraggableDataContext.draggableItems.push(new Is(this._fComponentsStore,this._lineService||this._createLineService(),this._getFlowHostSize(),this._getDraggedNodesBoundingRect(t),this._getStaticNodeRects(t),this._getCommonRestrictions()))}_getFlowHostSize(){return this._fMediator.send(new Ho).getBoundingClientRect()}_createLineService(){return this._lineService=new Rd(this._fBrowser,this._fComponentsStore.fLineAlignment.hostElement),this._lineService}_getDraggedNodesBoundingRect(t){return p.union(t.map(e=>this._fMediator.execute(new N(e.hostElement,!1))))||p.initialize()}_getStaticNodeRects(t){return this._getStaticNodes(t).map(e=>this._fMediator.execute(new N(e.hostElement,!1)))}_getStaticNodes(t){return this._fComponentsStore.fNodes.filter(e=>!t.includes(e))}_getCommonRestrictions(){return this._fDraggableDataContext.draggableItems.filter(t=>t instanceof b)[0].restrictions}static \u0275fac=function(e){return new(e||$e)};static \u0275prov=o.wxM({token:$e,factory:$e.\u0275fac})};return n=(0,d.UN)([f(Ms)],n),n})();class Ns{event;constructor(i){this.event=i}}let Nt=(()=>{class n{fComponentsStore;fDraggableDataContext;notDraggedNodesRects;DEBOUNCE_TIME=15;get _transform(){return this.fComponentsStore.fCanvas.transform}_onPointerDownPosition=u.initialize();_debounceTimer=null;fNodeWithRect=null;constructor(t,e,s){this.fComponentsStore=t,this.fDraggableDataContext=e,this.notDraggedNodesRects=s,this._onPointerDownPosition=this.fDraggableDataContext.onPointerDownPosition}_toggleParentNode(t){const e=this._isNodeInsideAnotherNode(this._getNewPosition(t));e?this._markIncludeNode(e):this._unmarkIncludeNode()}_getNewPosition(t){return C.fromPoint(this._onPointerDownPosition).add(t).mult(this._transform.scale)}_isNodeInsideAnotherNode(t){return this.notDraggedNodesRects.find(e=>p.isIncludePoint(e.rect,t))}onPointerMove(t){this._debounceTimer&&clearTimeout(this._debounceTimer),this._debounceTimer=setTimeout(()=>this._toggleParentNode(t),this.DEBOUNCE_TIME)}_markIncludeNode(t){this._unmarkIncludeNode(),this.fNodeWithRect=t,t.node.setClass("f-parent-for-drop")}_unmarkIncludeNode(){this.fNodeWithRect?.node.removeClass("f-parent-for-drop"),this.fNodeWithRect=null}onPointerUp(){this._unmarkIncludeNode(),this._debounceTimer&&(clearTimeout(this._debounceTimer),this._debounceTimer=null)}static \u0275fac=function(e){o.KEo()};static \u0275dir=o.Sc5({type:n})}return n})();class Od{fTargetNode;fNodes;fDropPosition;constructor(i,t,e){this.fTargetNode=i,this.fNodes=t,this.fDropPosition=e}}const Td=[(()=>{let n=class qe{fComponentsStore;fDraggableDataContext;constructor(t,e){this.fComponentsStore=t,this.fDraggableDataContext=e}handle(t){if(!this._isValid())return;const e=this.getDragHandleItem();e.fNodeWithRect&&this.emitDroppedChildrenEvent(e.fNodeWithRect.node.fId,t.event),e.onPointerUp?.()}_isValid(){return this.fDraggableDataContext.draggableItems.some(t=>t instanceof Nt)}emitDroppedChildrenEvent(t,e){this.fComponentsStore.fDraggable?.fDropToGroup.emit(new Od(t,this.getDraggedNodeIds(),e.getPosition()))}getDragHandleItem(){const t=this.findDragHandleItem();if(!t)throw new Error("NodeDragToParentDragHandler not found");return t}findDragHandleItem(){return this.fDraggableDataContext.draggableItems.find(t=>t instanceof Nt)}getDraggedNodeIds(){return this.fDraggableDataContext.draggableItems.filter(t=>t instanceof b).map(t=>t.fNode.fId)}static \u0275fac=function(e){return new(e||qe)(o.CoB(l),o.CoB(v))};static \u0275prov=o.wxM({token:qe,factory:qe.\u0275fac})};return n=(0,d.UN)([f(Ns)],n),n})()];class Po{event;constructor(i){this.event=i}}const Ad=[(()=>{let n=class Xe{fMediator;fDraggableDataContext;fComponentsStore;get fNodes(){return this.fComponentsStore.fNodes}get transform(){return this.fComponentsStore.fCanvas.transform}get fCanvasPosition(){return u.sum(this.transform.position,this.transform.scaledPosition)}constructor(t,e,s){this.fMediator=t,this.fDraggableDataContext=e,this.fComponentsStore=s}handle(t){if(!this.fComponentsStore.fNodes.find(s=>s.isContains(t.event.targetElement)))throw new Error("Node not found");this.fDraggableDataContext.draggableItems.push(new Nt(this.fComponentsStore,this.fDraggableDataContext,this._getNotDraggedNodesRects()))}_getNotDraggedNodesRects(){const t=this._addParentNodes(this._getNodesBeingDragged());return this._getNotDraggedNodes(t).map(e=>{const s=this.fMediator.send(new N(e.hostElement,!1));return{node:e,rect:p.initialize(s.x+this.fCanvasPosition.x,s.y+this.fCanvasPosition.y,s.width*this.transform.scale,s.height*this.transform.scale)}})}_getNodesBeingDragged(){return this.fDraggableDataContext.draggableItems.filter(t=>t instanceof b).map(t=>t.fNode)}_addParentNodes(t){return t.reduce((e,s)=>(e.push(s,...this.fMediator.send(new qo(s))),e),[])}_getNotDraggedNodes(t){return this.fNodes.filter(e=>!t.includes(e))}static \u0275fac=function(e){return new(e||Xe)(o.CoB(h),o.CoB(v),o.CoB(l))};static \u0275prov=o.wxM({token:Xe,factory:Xe.\u0275fac})};return n=(0,d.UN)([f(Po)],n),n})(),(()=>{let n=class Ze{fDraggableDataContext;constructor(t){this.fDraggableDataContext=t}handle(t){return this.fDraggableDataContext.draggableItems.some(e=>e instanceof b)}static \u0275fac=function(e){return new(e||Ze)(o.CoB(v))};static \u0275prov=o.wxM({token:Ze,factory:Ze.\u0275fac})};return n=(0,d.UN)([P(Po)],n),n})()];class Rs{event;constructor(i){this.event=i}}const Bd=[(()=>{let n=class Ye{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);_fDraggableDataContext=(0,o.uUt)(v);get _transform(){return this._fComponentsStore.fCanvas.transform}get _fHost(){return this._fComponentsStore.fFlow.hostElement}_fNode;handle(t){this._isValid(t)&&(this._fDraggableDataContext.onPointerDownScale=this._transform.scale,this._fDraggableDataContext.onPointerDownPosition=C.fromPoint(t.event.getPosition()).elementTransform(this._fHost).div(this._transform.scale),this._fDraggableDataContext.draggableItems=this._calculateDraggedItems(this._fNode),this._fComponentsStore.fLineAlignment&&this._fMediator.execute(new Ms))}_isValid(t){return this._fDraggableDataContext.isEmpty()&&this._isDragHandleElement(t.event.targetElement)&&!!this._getNode(t.event.targetElement)}_isDragHandleElement(t){return ci(t,".f-drag-handle")}_getNode(t){return this._fNode=this._fComponentsStore.fNodes.find(e=>e.isContains(t)&&!e.fDraggingDisabled),this._fNode}_calculateDraggedItems(t){let e=[];return t.fSelectionDisabled?e=this._dragModelFromSelection(t):(this._fMediator.execute(new ko(t)),e=this._dragModelFromSelection()),e}_dragModelFromSelection(t){return this._fMediator.execute(new ys(t))}static \u0275fac=function(e){return new(e||Ye)};static \u0275prov=o.wxM({token:Ye,factory:Ye.\u0275fac})};return n=(0,d.UN)([f(Rs)],n),n})()];class Ps{event;constructor(i){this.event=i}}const zd=[...Nd,bd,(()=>{let n=class Ke{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);_fDraggableDataContext=(0,o.uUt)(v);get _fHost(){return this._fComponentsStore.fFlow.hostElement}handle(t){if(!this._isValid())return;const e=this._getDifferenceWithLineAlignment(this._getDifferenceBetweenPreparationAndFinalize(t.event.getPosition())),r=this._fDraggableDataContext.draggableItems.find(a=>a instanceof b).getDifferenceWithCellSize(e);this._finalizeMove(r),this._applyConnectionUnderDroppedNode()}_isValid(){return this._fDraggableDataContext.draggableItems.some(t=>t instanceof b)}_finalizeMove(t){this._getItems().forEach(e=>{e.onPointerMove({...t}),e.onPointerUp?.()})}_getItems(){return this._fDraggableDataContext.draggableItems.filter(t=>!(t instanceof Nt))}_getDifferenceBetweenPreparationAndFinalize(t){return C.fromPoint(t).elementTransform(this._fHost).div(this._fDraggableDataContext.onPointerDownScale).sub(this._fDraggableDataContext.onPointerDownPosition)}_getDifferenceWithLineAlignment(t){return this._applyLineAlignmentDifference(t,this._getLineAlignmentDifference(t))}_getLineAlignmentDifference(t){return this._fDraggableDataContext.draggableItems.find(e=>e instanceof Is)?.findNearestCoordinate(t)}_applyLineAlignmentDifference(t,e){return e&&(t.x=e.xResult.value?t.x-e.xResult.distance:t.x,t.y=e.yResult.value?t.y-e.yResult.distance:t.y),t}_applyConnectionUnderDroppedNode(){if(this._fDraggableDataContext.draggableItems[0]instanceof b&&this._fComponentsStore.fDraggable?.emitWhenNodeIntersectedWithConnection){const e=this._fDraggableDataContext.draggableItems[0].fNode;setTimeout(()=>this._fMediator.execute(new vs(e)))}}static \u0275fac=function(e){return new(e||Ke)};static \u0275prov=o.wxM({token:Ke,factory:Ke.\u0275fac})};return n=(0,d.UN)([f(Ps)],n),n})(),...Bd,...Ad,...Td];class Fs{rect;restrictionsRect;constructor(i,t){this.rect=i,this.restrictionsRect=t}}let Gd=(()=>{let n=class Qe{handle(t){this.applyRestrictions(t.rect,t.restrictionsRect)}applyRestrictions(t,e){this.left(t,e),this.top(t,e),this.right(t,e),this.bottom(t,e)}left(t,e){t.x>e.x-0&&(t.width+=t.x-e.x-0,t.x=e.x-0)}top(t,e){t.y>e.y-0&&(t.height+=t.y-e.y-0,t.y=e.y-0)}right(t,e){t.x+t.width<=e.x+e.width+0&&(t.width=e.x+e.width-t.x+0)}bottom(t,e){t.y+t.height<=e.y+e.height+0&&(t.height=e.y+e.height-t.y+0)}static \u0275fac=function(e){return new(e||Qe)};static \u0275prov=o.wxM({token:Qe,factory:Qe.\u0275fac})};return n=(0,d.UN)([f(Fs)],n),n})();class bs{rect;restrictionsRect;constructor(i,t){this.rect=i,this.restrictionsRect=t}}let Ld=(()=>{let n=class Je{handle(t){this.applyRestrictions(t.rect,t.restrictionsRect)}applyRestrictions(t,e){this.left(t,e),this.top(t,e),this.right(t,e),this.bottom(t,e)}left(t,e){t.x<=e.x+0&&(t.width-=e.x-t.x+0,t.x=e.x+0)}top(t,e){t.y<=e.y+0&&(t.height-=e.y-t.y+0,t.y=e.y+0)}right(t,e){t.x+t.width>e.x+e.width-0&&(t.width=e.x+e.width-t.x-0)}bottom(t,e){t.y+t.height>e.y+e.height-0&&(t.height=e.y+e.height-t.y-0)}static \u0275fac=function(e){return new(e||Je)};static \u0275prov=o.wxM({token:Je,factory:Je.\u0275fac})};return n=(0,d.UN)([f(bs)],n),n})();class Os{originalRect;changedRect;difference;fResizeHandleType;constructor(i,t,e,s){this.originalRect=i,this.changedRect=t,this.difference=e,this.fResizeHandleType=s}}const Ts={[z.LEFT_TOP]:{x:-1,y:-1},[z.RIGHT_TOP]:{x:1,y:-1},[z.RIGHT_BOTTOM]:{x:1,y:1},[z.LEFT_BOTTOM]:{x:-1,y:1}};let kd=(()=>{let n=class je{handle(t){return this.change(t.originalRect,t.difference,Ts[t.fResizeHandleType],t.changedRect)}change(t,e,s,r){return p.initialize(t.x+(-1===s.x?e.x:0)+r.x,t.y+(-1===s.y?e.y:0)+r.y,r.width,r.height)}static \u0275fac=function(e){return new(e||je)};static \u0275prov=o.wxM({token:je,factory:je.\u0275fac})};return n=(0,d.UN)([f(Os)],n),n})();class As{originalRect;difference;fResizeHandleType;constructor(i,t,e){this.originalRect=i,this.difference=t,this.fResizeHandleType=e}}let Hd=(()=>{let n=class tn{handle(t){return this.change(t.originalRect,t.difference,Ts[t.fResizeHandleType])}change(t,e,s){const r=p.initialize(0,0,t.width+s.x*e.x,t.height+s.y*e.y);return r.width<0&&(r.x=r.width,r.width=Math.abs(r.width)),r.height<0&&(r.y=r.height,r.height=Math.abs(r.height)),p.copy(r)}static \u0275fac=function(e){return new(e||tn)};static \u0275prov=o.wxM({token:tn,factory:tn.\u0275fac})};return n=(0,d.UN)([f(As)],n),n})();class Bs{fNode;paddings;constructor(i,t){this.fNode=i,this.paddings=t}}let Vd=(()=>{let n=class en{fMediator;constructor(t){this.fMediator=t}handle(t){const e=p.union(this.getChildrenNodes(t.fNode.fId).map(s=>this.normalizeRect(s)));return e?this.concatRectWithParentPadding(e,t.paddings):null}getChildrenNodes(t){return this.fMediator.send(new it(t))}normalizeRect(t){return this.fMediator.send(new N(t.hostElement,!1))}concatRectWithParentPadding(t,e){return p.initialize(t.x-e[0],t.y-e[1],t.width+e[0]+e[2],t.height+ +e[1]+e[3])}static \u0275fac=function(e){return new(e||en)(o.CoB(h))};static \u0275prov=o.wxM({token:en,factory:en.\u0275fac})};return n=(0,d.UN)([f(Bs)],n),n})();class Us{fNode;rect;constructor(i,t){this.fNode=i,this.rect=t}}let Wd=(()=>{let n=class nn{fMediator;constructor(t){this.fMediator=t}handle(t){const e=this.getNodePaddings(t.fNode,t.rect),s=this.fMediator.send(new Bs(t.fNode,e));return{parentRect:this.fMediator.send(new No(t.fNode)),childRect:s,minSize:ft.initialize(e[0]+e[2],e[1]+e[3])}}getNodePaddings(t,e){return this.fMediator.send(new $o(t,e))}static \u0275fac=function(e){return new(e||nn)(o.CoB(h))};static \u0275prov=o.wxM({token:nn,factory:nn.\u0275fac})};return n=(0,d.UN)([f(Us)],n),n})();class zs{event;constructor(i){this.event=i}}class Gs{fMediator;fNode;fResizeHandleType;originalRect;restrictions;childRestrictions=()=>{};constructor(i,t,e){this.fMediator=i,this.fNode=t,this.fResizeHandleType=e}prepareDragSequence(){this.originalRect=this.fMediator.send(new N(this.fNode.hostElement,!1)),this.restrictions=this.fMediator.send(new Us(this.fNode,this.originalRect)),this.restrictions.childRect&&(this.childRestrictions=(i,t)=>{this.applyChildRestrictions(i,t)})}onPointerMove(i){const t=this.changePosition(i,this.changeSize(i,this.restrictions.minSize));this.childRestrictions(t,this.restrictions.childRect),this.applyParentRestrictions(t,this.restrictions.parentRect),this.fNode.updatePosition(t),this.fNode.updateSize(t),this.fNode.redraw()}changeSize(i,t){return this.fMediator.send(new As(this.originalRect,i,this.fResizeHandleType))}changePosition(i,t){return this.fMediator.send(new Os(this.originalRect,t,i,this.fResizeHandleType))}applyChildRestrictions(i,t){this.fMediator.send(new Fs(i,t))}applyParentRestrictions(i,t){this.fMediator.send(new bs(i,t))}onPointerUp(){this.fNode.sizeChange.emit(p.initialize(this.fNode.position.x,this.fNode.position.y,this.fNode.size?.width,this.fNode.size?.height))}}const $d=[(()=>{let n=class on{fDraggableDataContext;constructor(t){this.fDraggableDataContext=t}handle(t){this._isValid()&&this.fDraggableDataContext.draggableItems.forEach(e=>{e.onPointerUp?.()})}_isValid(){return this.fDraggableDataContext.draggableItems.some(t=>t instanceof Gs)}static \u0275fac=function(e){return new(e||on)(o.CoB(v))};static \u0275prov=o.wxM({token:on,factory:on.\u0275fac})};return n=(0,d.UN)([f(zs)],n),n})()];class Fo{event;constructor(i){this.event=i}}const Xd=[Gd,Ld,kd,Hd,Vd,Wd,...$d,(()=>{let n=class sn{fComponentsStore;fDraggableDataContext;fMediator;get transform(){return this.fComponentsStore.fCanvas.transform}get flowHost(){return this.fComponentsStore.fFlow.hostElement}constructor(t,e,s){this.fComponentsStore=t,this.fDraggableDataContext=e,this.fMediator=s}handle(t){this.selectAndUpdateNodeLayer(t.event.targetElement);const e=function Lr(n,i,t){return function kr(n,i){return n.closest(i)}(n,t).dataset[i]}(t.event.targetElement,"fResizeHandleType",".f-resize-handle"),s=[new Gs(this.fMediator,this.getNode(t.event.targetElement),z[e])];this.fDraggableDataContext.onPointerDownScale=this.transform.scale,this.fDraggableDataContext.onPointerDownPosition=C.fromPoint(t.event.getPosition()).elementTransform(this.flowHost).div(this.transform.scale),this.fDraggableDataContext.draggableItems=s}selectAndUpdateNodeLayer(t){this.fMediator.send(new ko(this.getNode(t)))}getNode(t){return this.fComponentsStore.fNodes.find(e=>e.isContains(t))}static \u0275fac=function(e){return new(e||sn)(o.CoB(l),o.CoB(v),o.CoB(h))};static \u0275prov=o.wxM({token:sn,factory:sn.\u0275fac})};return n=(0,d.UN)([f(Fo)],n),n})(),(()=>{let n=class rn{fComponentsStore;fDraggableDataContext;constructor(t,e){this.fComponentsStore=t,this.fDraggableDataContext=e}handle(t){return this.isDragHandlesEmpty()&&this.isDragHandleElement(t.event.targetElement)&&this.isNodeCanBeDragged(this.getNode(t.event.targetElement))}isDragHandlesEmpty(){return!this.fDraggableDataContext.draggableItems.length}getNode(t){return this.fComponentsStore.fNodes.find(e=>e.isContains(t))}isNodeCanBeDragged(t){return!!t&&!t.fDraggingDisabled}isDragHandleElement(t){return ci(t,".f-resize-handle")}static \u0275fac=function(e){return new(e||rn)(o.CoB(l),o.CoB(v))};static \u0275prov=o.wxM({token:rn,factory:rn.\u0275fac})};return n=(0,d.UN)([P(Fo)],n),n})()];class Ls{event;constructor(i){this.event=i}}const Zd=[(()=>{let n=class an{fPlatform;fComponentsStore;fDraggableDataContext;fMediator;constructor(t,e,s,r){this.fPlatform=t,this.fComponentsStore=e,this.fDraggableDataContext=s,this.fMediator=r}handle(t){if(!this._isValid(t))return;const{event:e}=t,s=this.getSelectableItem(e);s&&this.fMediator.send(new Rt(s,s.hostElement.parentElement)),this.isMultiselectEnabled(e)?this.multiSelect(s):this.singleSelect(s)}_isValid(t){return this.fComponentsStore.fFlow.hostElement.contains(t.event.targetElement)&&!this.fDraggableDataContext.draggableItems.length}getSelectableItem(t){return this._findNode(t.targetElement)||this.getConnectionHandler(t.targetElement)}_findNode(t){return this.fComponentsStore.fNodes.find(e=>e.isContains(t))}getConnectionHandler(t){return this.fComponentsStore.fConnections.find(e=>e.isContains(t)||e.fConnectionCenter?.nativeElement?.contains(t))}isMultiselectEnabled(t){return this.isCommandButton(this.fPlatform.getOS(),t.originalEvent)||this.isShiftPressed(t.originalEvent)}isShiftPressed(t){return t.shiftKey}isCommandButton(t,e){return t===q.MAC_OS?e.metaKey:e.ctrlKey}singleSelect(t){t?t.isSelected()||t.fSelectionDisabled?t.fSelectionDisabled&&this.clearSelection():(this.clearSelection(),this.selectItem(t)):this.clearSelection()}multiSelect(t){t&&!t.fSelectionDisabled&&(t.isSelected()?this.deselectItem(t):this.selectItem(t))}deselectItem(t){const e=this.fDraggableDataContext.selectedItems.indexOf(t);e>-1&&this.fDraggableDataContext.selectedItems.splice(e,1),t.deselect(),this.fDraggableDataContext.markSelectionAsChanged()}selectItem(t){this.fDraggableDataContext.selectedItems.push(t),t.select(),this.fDraggableDataContext.markSelectionAsChanged()}clearSelection(){this.fDraggableDataContext.selectedItems.forEach(t=>{t.deselect(),this.fDraggableDataContext.markSelectionAsChanged()}),this.fDraggableDataContext.selectedItems=[]}static \u0275fac=function(e){return new(e||an)(o.CoB(oi),o.CoB(l),o.CoB(v),o.CoB(h))};static \u0275prov=o.wxM({token:an,factory:an.\u0275fac})};return n=(0,d.UN)([f(Ls)],n),n})()];let Yd=(()=>{class n extends Kr{constructor(t){super(t)}static \u0275fac=function(e){o.KEo()};static \u0275dir=o.Sc5({type:n,features:[o.eg9]})}return n})();class ks{event;constructor(i){this.event=i}}class Hs{externalItem;fBrowser;placeholder;onPointerDownRect=p.initialize();difference=u.initialize();constructor(i,t){this.externalItem=i,this.fBrowser=t}getStyle(i){return`position: absolute; left: 0; top: 0; transform: translate(${i.x}px, ${i.y}px)`}prepareDragSequence(){this.onPointerDownRect=this.getExternalItemRect(),this.placeholder=function zr(n){const i=n.cloneNode(!0),t=i.querySelectorAll("[id]"),e=n.nodeName.toLowerCase();i.removeAttribute("id");for(let s=0;s<t.length;s++)t[s].removeAttribute("id");return"canvas"===e?ai(n,i):("input"===e||"select"===e||"textarea"===e)&&ri(n,i),si("canvas",n,i,ai),si("input, textarea, select",n,i,ri),i}(this.externalItem.hostElement),this.placeholder.setAttribute("style",this.getStyle(C.fromPoint(this.onPointerDownRect))),this.fBrowser.document.body.appendChild(this.placeholder)}getExternalItemRect(){const i=this.externalItem.hostElement.getBoundingClientRect();return p.initialize(i.left+(this.fBrowser.window.pageXOffset||this.fBrowser.document.documentElement.scrollLeft),i.top+(this.fBrowser.window.pageYOffset||this.fBrowser.document.documentElement.scrollTop),i.width,i.height)}onPointerMove(i){this.difference=i;const t=C.fromPoint(this.onPointerDownRect).add(this.difference);this.placeholder.setAttribute("style",this.getStyle(t))}onPointerUp(){this.fBrowser.document.body.removeChild(this.placeholder)}}class Kd{rect;data;constructor(i,t){this.rect=i,this.data=t}}const Qd=[(()=>{let n=class cn{fComponentsStore;fDraggableDataContext;fMediator;fBrowser;get flowHost(){return this.fComponentsStore.fFlow.hostElement}get fCreateNode(){return this.fComponentsStore.fDraggable.fCreateNode}get dragHandler(){return this.fDraggableDataContext.draggableItems[0]}constructor(t,e,s,r){this.fComponentsStore=t,this.fDraggableDataContext=e,this.fMediator=s,this.fBrowser=r}handle(t){this._isValid()&&(this.emitEvent(this.getExternalItemElementsFromPoint(t.event.getPosition())),this.dragHandler.onPointerUp())}_isValid(){return this.fDraggableDataContext.draggableItems.some(t=>t instanceof Hs)}getExternalItemElementsFromPoint(t){return this.fBrowser.document.elementsFromPoint(t.x,t.y).filter(e=>!e.closest(".f-external-item"))}emitEvent(t){this.isPointerInCanvasRect(t)&&this.fCreateNode.emit(new Kd(this.getRectInCanvas(),this.dragHandler.externalItem.fData))}isPointerInCanvasRect(t){return!!t.length&&this.flowHost.contains(t[0])}getRectInCanvas(){return this.fMediator.send(new N(this.dragHandler.placeholder,!1))}static \u0275fac=function(e){return new(e||cn)(o.CoB(l),o.CoB(v),o.CoB(h),o.CoB(y))};static \u0275prov=o.wxM({token:cn,factory:cn.\u0275fac})};return n=(0,d.UN)([f(ks)],n),n})()];class bo{event;constructor(i){this.event=i}}const Jd=[(()=>{let n=class dn{fComponentsStore;fDraggableDataContext;fExternalItemService;fBrowser;get flowHost(){return this.fComponentsStore.fFlow.hostElement}constructor(t,e,s,r){this.fComponentsStore=t,this.fDraggableDataContext=e,this.fExternalItemService=s,this.fBrowser=r}handle(t){this.fDraggableDataContext.onPointerDownScale=1,this.fDraggableDataContext.onPointerDownPosition=C.fromPoint(t.event.getPosition()).elementTransform(this.flowHost),this.fDraggableDataContext.draggableItems=[new Hs(this.getExternalItem(t.event.targetElement),this.fBrowser)]}getExternalItem(t){return this.fExternalItemService.getItem($s(t))}static \u0275fac=function(e){return new(e||dn)(o.CoB(l),o.CoB(v),o.CoB(Oo),o.CoB(y))};static \u0275prov=o.wxM({token:dn,factory:dn.\u0275fac})};return n=(0,d.UN)([f(bo)],n),n})(),(()=>{let n=class fn{fExternalItemService;constructor(t){this.fExternalItemService=t}handle(t){const e=this.getExternalItem(t.event.targetElement);return Ws(t.event.targetElement)&&!!e&&!e.fDisabled}getExternalItem(t){return this.fExternalItemService.getItem($s(t))}static \u0275fac=function(e){return new(e||fn)(o.CoB(Oo))};static \u0275prov=o.wxM({token:fn,factory:fn.\u0275fac})};return n=(0,d.UN)([P(bo)],n),n})()];class Vs{event;constructor(i){this.event=i}}function Ws(n){return!!n.closest("[fExternalItem]")}function $s(n){return n.closest("[fExternalItem]")}const tf=[...Qd,...Jd,(()=>{let n=class ln{handle(t){this._isTargetItemExternal(t.event)&&t.event.preventDefault()}_isTargetItemExternal(t){let e=this._isExternalItem(t.target),s=this._isExternalItem(t.target.parentNode);return e||s}_isExternalItem(t){let e=!1;try{e=Ws(t)}catch{}return e}static \u0275fac=function(e){return new(e||ln)};static \u0275prov=o.wxM({token:ln,factory:ln.\u0275fac})};return n=(0,d.UN)([f(Vs)],n),n})()];new o.UbH("F_EXTERNAL_ITEM");let Oo=(()=>{class n{items=[];registerItem(t){this.items.push(t)}getItem(t){return this.items.find(e=>e.hostElement===t)}removeItem(t){const e=this.items.indexOf(t);-1!==e&&this.items.splice(e,1)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=o.wxM({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const To=new o.UbH("F_DRAG_AND_DROP_PLUGIN");let sf=(()=>{class n extends Yd{_fBrowser;_elementReference=(0,o.uUt)(o.GMv);_fMediator=(0,o.uUt)(h);disabled=!1;get hostElement(){return this._elementReference.nativeElement}fSelectionChange=new o._w7;fNodeIntersectedWithConnections=new o._w7;emitWhenNodeIntersectedWithConnection=!1;fCreateNode=new o._w7;fReassignConnection=new o._w7;fCreateConnection=new o._w7;fDropToGroup=new o._w7;vCellSize=1;hCellSize=1;plugins;constructor(t,e){super(t),this._fBrowser=e}ngOnInit(){this._fMediator.send(new os(this))}ngAfterViewInit(){super.subscribe(this._fBrowser.document)}onPointerDown(t){this._fMediator.execute(new ir),this.plugins.forEach(s=>s.onPointerDown?.(t)),this._fMediator.execute(new Ls(t)),this._fMediator.execute(new ms(t)),this._fMediator.execute(new hs(t));const e=t.isMouseLeftButton();return e||this.finalizeDragSequence(),e}prepareDragSequence(t){this.plugins.forEach(e=>e.prepareDragSequence?.(t)),this._fMediator.send(new Fo(t)),this._fMediator.send(new Rs(t)),this._fMediator.send(new Po(t)),this._fMediator.send(new Mo(t)),this._fMediator.send(new bo(t)),this._fMediator.send(new sr)}onSelect(t){this.plugins.forEach(e=>e.onSelect?.(t)),this._fMediator.execute(new Vs(t))}onPointerMove(t){this._fMediator.execute(new or(t))}onPointerUp(t){this.plugins.forEach(e=>e.onPointerUp?.(t)),this._fMediator.execute(new gs(t)),this._fMediator.execute(new rs(t)),this._fMediator.execute(new zs(t)),this._fMediator.execute(new Ps(t)),this._fMediator.execute(new Ns(t)),this._fMediator.send(new is(t)),this._fMediator.execute(new ks(t)),this._fMediator.execute(new nr)}finalizeDragSequence(){this._fMediator.execute(new yo)}ngOnDestroy(){this._fMediator.send(new ar),super.unsubscribe()}static \u0275fac=function(e){return new(e||n)(o.GI1(o.WW2,8),o.GI1(y))};static \u0275dir=o.Sc5({type:n,selectors:[["f-flow","fDraggable",""]],contentQueries:function(e,s,r){if(1&e&&o.szK(r,To,5),2&e){let a;o.wto(a=o.Gqi())&&(s.plugins=a)}},inputs:{disabled:[o.Wk5.None,"fDraggableDisabled","disabled"],emitWhenNodeIntersectedWithConnection:[o.Wk5.HasDecoratorInputTransform,"emitWhenNodeIntersectedWithConnection","emitWhenNodeIntersectedWithConnection",o.cZD],vCellSize:"vCellSize",hCellSize:"hCellSize"},outputs:{fSelectionChange:"fSelectionChange",fNodeIntersectedWithConnections:"fNodeIntersectedWithConnections",fCreateNode:"fCreateNode",fReassignConnection:"fReassignConnection",fCreateConnection:"fCreateConnection",fDropToGroup:"fDropToGroup"},exportAs:["fDraggable"],features:[o.QJr,o.eg9]})}return n})();class rf{nodes;groups;connections;constructor(i,t,e){this.nodes=i,this.groups=t,this.connections=e}}class Ao{event;minimap;constructor(i,t){this.event=i,this.minimap=t}}class Bo{flowRect;canvasPosition;eventPoint;minimap;constructor(i,t,e,s){this.flowRect=i,this.canvasPosition=t,this.eventPoint=e,this.minimap=s}}let af=(()=>{let n=class un{fComponentsStore;get canvasScale(){return this.fComponentsStore.fCanvas.transform.scale}constructor(t){this.fComponentsStore=t}handle(t){return u.sub(t.canvasPosition,u.sub(this.getPositionInViewBox(t.eventPoint,t.minimap),this.getNormalizedFlowCenter(t.flowRect)))}getNormalizedFlowCenter(t){return C.fromPoint(t.gravityCenter).sub(t)}getPositionInViewBox(t,e){const s=this.normalizeEventPoint(t,e);return u.sum(s,p.mult(e.viewBox,this.canvasScale))}normalizeEventPoint(t,e){return this.getEventPointInMinimap(t,e).mult(e.scale).mult(this.canvasScale)}getEventPointInMinimap(t,e){return C.fromPoint(t).elementTransform(e.element)}static \u0275fac=function(e){return new(e||un)(o.CoB(l))};static \u0275prov=o.wxM({token:un,factory:un.\u0275fac})};return n=(0,d.UN)([f(Bo)],n),n})();class qs{fComponentsStore;fMediator;flowRect;canvasPosition;eventPoint;minimap;lastDifference=null;constructor(i,t,e,s,r,a){this.fComponentsStore=i,this.fMediator=t,this.flowRect=e,this.canvasPosition=s,this.eventPoint=r,this.minimap=a}prepareDragSequence(){this.fComponentsStore.fCanvas?.hostElement.classList.add("f-scaled-animate")}onPointerMove(i){this.lastDifference&&this.isSamePoint(i,this.lastDifference)||(this.lastDifference=i,this.fComponentsStore.fCanvas.setPosition(this.getNewPosition(C.fromPoint(this.eventPoint).add(i))),this.fComponentsStore.fCanvas.redraw())}isSamePoint(i,t){return i.x===t.x&&i.y===t.y}getNewPosition(i){return this.fMediator.send(new Bo(this.flowRect,this.canvasPosition,i,this.minimap))}onPointerUp(){this.fComponentsStore.fCanvas?.hostElement.classList.remove("f-scaled-animate"),this.fComponentsStore.fCanvas.emitCanvasChangeEvent()}}const cf=[(()=>{let n=class hn{fComponentsStore;fMediator;fDraggableDataContext;get flowHost(){return this.fComponentsStore.fFlow.hostElement}constructor(t,e,s){this.fComponentsStore=t,this.fMediator=e,this.fDraggableDataContext=s}handle(t){const e=t.event.getPosition(),s=C.fromPoint(this.fComponentsStore.fCanvas.transform.position);this.fComponentsStore.fCanvas.setPosition(this.getNewPosition(e,t.minimap)),this.fComponentsStore.fCanvas.redraw(),this.fComponentsStore.fCanvas.emitCanvasChangeEvent(),this.fDraggableDataContext.onPointerDownScale=1,this.fDraggableDataContext.onPointerDownPosition=C.fromPoint(e).elementTransform(this.flowHost),this.fDraggableDataContext.draggableItems=[new qs(this.fComponentsStore,this.fMediator,this.getFlowRect(),s,e,t.minimap)]}getNewPosition(t,e){return this.fMediator.send(new Bo(this.getFlowRect(),C.fromPoint(this.fComponentsStore.fCanvas.transform.position),t,e))}getFlowRect(){return p.fromElement(this.flowHost)}static \u0275fac=function(e){return new(e||hn)(o.CoB(l),o.CoB(h),o.CoB(v))};static \u0275prov=o.wxM({token:hn,factory:hn.\u0275fac})};return n=(0,d.UN)([f(Ao)],n),n})(),(()=>{let n=class gn{fComponentsStore;fDraggableDataContext;constructor(t,e){this.fComponentsStore=t,this.fDraggableDataContext=e}handle(t){return!this.fDraggableDataContext.draggableItems.length&&!!t.event.targetElement.closest(".f-minimap")&&this.fComponentsStore.flowHost.contains(t.event.targetElement)}static \u0275fac=function(e){return new(e||gn)(o.CoB(l),o.CoB(v))};static \u0275prov=o.wxM({token:gn,factory:gn.\u0275fac})};return n=(0,d.UN)([P(Ao)],n),n})()];class Uo{event;constructor(i){this.event=i}}const df=[(()=>{let n=class pn{fDraggableDataContext;constructor(t){this.fDraggableDataContext=t}handle(t){this.fDraggableDataContext.draggableItems.forEach(e=>{e.onPointerUp?.()})}static \u0275fac=function(e){return new(e||pn)(o.CoB(v))};static \u0275prov=o.wxM({token:pn,factory:pn.\u0275fac})};return n=(0,d.UN)([f(Uo)],n),n})(),(()=>{let n=class mn{fDraggableDataContext;constructor(t){this.fDraggableDataContext=t}handle(t){return this.fDraggableDataContext.draggableItems.some(e=>e instanceof qs)}static \u0275fac=function(e){return new(e||mn)(o.CoB(v))};static \u0275prov=o.wxM({token:mn,factory:mn.\u0275fac})};return n=(0,d.UN)([P(Uo)],n),n})()];class Xs{}let ff=(()=>{let n=class Cn{_fBrowser=(0,o.uUt)(y);_fComponentStore=(0,o.uUt)(l);get _fFlow(){return this._fComponentStore.fFlow}get _fNodes(){return this._fComponentStore.fNodes}get _fCanvas(){return this._fComponentStore.fCanvas}handle(t){return this._createMinimapNodeElements(t)}_createMinimapNodeElements(t){return this._fNodes.map(e=>{const s=this._createNodeElement();return function ni(n,i){n=p.updateIsNotFinite(n),i.setAttribute("x",n.x.toString()),i.setAttribute("y",n.y.toString()),i.setAttribute("width",n.width.toString()),i.setAttribute("height",n.height.toString())}(this._getNodeRect(e),s),this._applyClassList(s,e,e instanceof mt),s})}_createNodeElement(){return W("rect",this._fBrowser)}_getNodeRect(t){return p.div(this._getNodeRectInFlow(t),this._fCanvas.transform.scale)}_getNodeRectInFlow(t){return p.elementTransform(p.fromElement(t.hostElement),this._fFlow.hostElement)}_applyClassList(t,e,s){t.classList.add("f-component",s?"f-minimap-node":"f-minimap-group"),e.isSelected()&&t.classList.add("f-selected")}static \u0275fac=function(e){return new(e||Cn)};static \u0275prov=o.wxM({token:Cn,factory:Cn.\u0275fac})};return n=(0,d.UN)([f(Xs)],n),n})();class Zs{}let lf=(()=>{let n=class vn{_fComponentStore=(0,o.uUt)(l);get _fFlow(){return this._fComponentStore.fFlow}get _fCanvas(){return this._fComponentStore.fCanvas}handle(t){return this._fFlow&&this._fCanvas?this._getRectForMinimapView():p.initialize()}_getRectForMinimapView(){const t=this._calculateViewBox();return t.x=0,t.y=0,t}_calculateViewBox(){return p.div(p.fromElement(this._fFlow.hostElement),this._fCanvas.transform.scale)}static \u0275fac=function(e){return new(e||vn)};static \u0275prov=o.wxM({token:vn,factory:vn.\u0275fac})};return n=(0,d.UN)([f(Zs)],n),n})();class Ys{element;minSize;constructor(i,t){this.element=i,this.minSize=t}}const hf=[af,...df,...cf,ff,(()=>{let n=class xn{_fMediator=(0,o.uUt)(h);_fComponentStore=(0,o.uUt)(l);get _fFlow(){return this._fComponentStore.fFlow}get _fCanvas(){return this._fComponentStore.fCanvas}handle(t){if(!this._fFlow)return{scale:1,viewBox:p.initialize(0,0,0,0)};const e=this._getScaledNodesBoundingBox(t.minSize),s=this._getMinimapRect(t.element),r=this._calculateViewScale(e,s);return{scale:r,viewBox:this._calculateViewBox(e,s,r)}}_getScaledNodesBoundingBox(t){const e=this._calculateNodesBoundingBox(),s=this._convertFromGlobalToFlowRect(e);return function Mr(n,i){const t=Math.max(n.width,i),e=Math.max(n.height,i);return p.initialize(n.x-(t-n.width)/2,n.y-(e-n.height)/2,t,e)}(this._convertRectToMinimapScale(s),t)}_calculateNodesBoundingBox(){return this._fMediator.send(new Pt)||p.initialize(0,0,0,0)}_convertFromGlobalToFlowRect(t){return p.elementTransform(t,this._fFlow.hostElement)}_convertRectToMinimapScale(t){return p.div(t,this._fCanvas.transform.scale)}_getMinimapRect(t){return p.elementTransform(p.fromElement(t),this._fFlow.hostElement)}_calculateViewScale(t,e){return Math.max(t.width/e.width,t.height/e.height)}_calculateViewBox(t,e,s){return this._calculateCenteredViewBox(t,this._calculateViewSize(e,s))}_calculateViewSize(t,e){return ft.initialize(t.width*e||0,t.height*e||0)}_calculateCenteredViewBox(t,e){return p.initialize(t.x-(e.width-t.width)/2,t.y-(e.height-t.height)/2,e.width,e.height)}static \u0275fac=function(e){return new(e||xn)};static \u0275prov=o.wxM({token:xn,factory:xn.\u0275fac})};return n=(0,d.UN)([f(Ys)],n),n})(),lf];class zo{event;constructor(i){this.event=i}}let gf=(()=>{let n=class Dn{fDraggableDataContext;constructor(t){this.fDraggableDataContext=t}handle(t){this.fDraggableDataContext.draggableItems.forEach(e=>{e.onPointerUp?.()})}static \u0275fac=function(e){return new(e||Dn)(o.CoB(v))};static \u0275prov=o.wxM({token:Dn,factory:Dn.\u0275fac})};return n=(0,d.UN)([f(zo)],n),n})();class Ks{fComponentsStore;fSelectionArea;fDraggableDataContext;fMediator;_canBeSelected=[];_selectedByMove=[];get canvasPosition(){return C.fromPoint(this.fComponentsStore.fCanvas.transform.position).add(this.fComponentsStore.fCanvas.transform.scaledPosition)}constructor(i,t,e,s){this.fComponentsStore=i,this.fSelectionArea=t,this.fDraggableDataContext=e,this.fMediator=s}prepareDragSequence(){this._canBeSelected=this.fMediator.send(new Js),this.fSelectionArea.show(),this.fSelectionArea.draw(p.initialize(this.fDraggableDataContext.onPointerDownPosition.x,this.fDraggableDataContext.onPointerDownPosition.y))}onPointerMove(i){const t=C.fromPoint(i).add(this.fDraggableDataContext.onPointerDownPosition),e=Math.min(this.fDraggableDataContext.onPointerDownPosition.x,t.x),s=Math.min(this.fDraggableDataContext.onPointerDownPosition.y,t.y),r=Math.abs(i.x),a=Math.abs(i.y);this.fSelectionArea.draw(p.initialize(e,s,r,a)),this._selectedByMove=[],this._canBeSelected.forEach(c=>{c.element.deselect();const g=p.addPoint(c.rect,this.canvasPosition);p.intersectionWithRect(g,p.initialize(e,s,r,a))&&(c.element.select(),this._selectedByMove.push(c.element))}),this.fMediator.send(new ot)}onPointerUp(){this.fSelectionArea.hide(),this.fDraggableDataContext.selectedItems.push(...this._selectedByMove),this._selectedByMove.length>0&&(this.fDraggableDataContext.isSelectedChanged=!0)}}const pf=[gf,(()=>{let n=class Sn{fDraggableDataContext;constructor(t){this.fDraggableDataContext=t}handle(t){return this.fDraggableDataContext.draggableItems.some(e=>e instanceof Ks)}static \u0275fac=function(e){return new(e||Sn)(o.CoB(v))};static \u0275prov=o.wxM({token:Sn,factory:Sn.\u0275fac})};return n=(0,d.UN)([P(zo)],n),n})()];class Go{event;fSelectionArea;constructor(i,t){this.event=i,this.fSelectionArea=t}}const xf=[...jc,...gd,...vd,...Zd,...tf,...zd,...Xd,...[...pf,(()=>{let n=class wn{fComponentsStore;fDraggableDataContext;fMediator;get flowHost(){return this.fComponentsStore.fFlow.hostElement}constructor(t,e,s){this.fComponentsStore=t,this.fDraggableDataContext=e,this.fMediator=s}handle(t){this.fDraggableDataContext.draggableItems=[new Ks(this.fComponentsStore,t.fSelectionArea,this.fDraggableDataContext,this.fMediator)],this.fDraggableDataContext.onPointerDownScale=1,this.fDraggableDataContext.onPointerDownPosition=C.fromPoint(t.event.getPosition()).elementTransform(this.flowHost)}static \u0275fac=function(e){return new(e||wn)(o.CoB(l),o.CoB(v),o.CoB(h))};static \u0275prov=o.wxM({token:wn,factory:wn.\u0275fac})};return n=(0,d.UN)([f(Go)],n),n})(),(()=>{let n=class En{fDraggableDataContext;constructor(t){this.fDraggableDataContext=t}handle(t){return this.isDragHandlesEmpty()&&this.isShiftPressed(t.event.originalEvent)}isDragHandlesEmpty(){return!this.fDraggableDataContext.draggableItems.length}isShiftPressed(t){return t.shiftKey}static \u0275fac=function(e){return new(e||En)(o.CoB(v))};static \u0275prov=o.wxM({token:En,factory:En.\u0275fac})};return n=(0,d.UN)([P(Go)],n),n})()],...hf];class Qs{}let Df=(()=>{let n=class yn{fDraggableDataContext;constructor(t){this.fDraggableDataContext=t}handle(t){this.fDraggableDataContext.selectedItems.forEach(e=>e.deselect()),this.fDraggableDataContext.selectedItems=[],this.fDraggableDataContext.isSelectedChanged=!0}static \u0275fac=function(e){return new(e||yn)(o.CoB(v))};static \u0275prov=o.wxM({token:yn,factory:yn.\u0275fac})};return n=(0,d.UN)([f(Qs)],n),n})();class Js{}let Sf=(()=>{let n=class Mn{fDraggableDataContext;_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);get fNodes(){return this._fComponentsStore.fNodes}get fConnections(){return this._fComponentsStore.fConnections}get transform(){return this._fComponentsStore.fCanvas.transform}constructor(t){this.fDraggableDataContext=t}handle(){return[...this.getNodesWithRects(),...this.getConnectionsWithRects()].filter(t=>!this.fDraggableDataContext.selectedItems.includes(t.element))}getNodesWithRects(){return this.fNodes.filter(t=>!t.fSelectionDisabled).map(t=>({element:t,rect:p.mult(this._fMediator.send(new N(t.hostElement,!1)),this.transform.scale)}))}getConnectionsWithRects(){return this.fConnections.filter(t=>!t.fSelectionDisabled).map(t=>({element:t,rect:p.mult(this._fMediator.send(new N(t.boundingElement,!1)),this.transform.scale)}))}static \u0275fac=function(e){return new(e||Mn)(o.CoB(v))};static \u0275prov=o.wxM({token:Mn,factory:Mn.\u0275fac})};return n=(0,d.UN)([f(Js)],n),n})();class Lo{}let wf=(()=>{let n=class In{_fDraggableDataContext=(0,o.uUt)(v);handle(){return{nodes:this._getSelectedNodes(),groups:this._getSelectedGroups(),connections:this._getSelectedConnections()}}_getSelectedNodes(){return this._fDraggableDataContext.selectedItems.filter(t=>t.hostElement.classList.contains("f-node")).map(t=>t.hostElement.dataset.fNodeId)}_getSelectedGroups(){return this._fDraggableDataContext.selectedItems.filter(t=>t.hostElement.classList.contains("f-group")).map(t=>t.hostElement.dataset.fGroupId)}_getSelectedConnections(){return this._fDraggableDataContext.selectedItems.filter(t=>!t.hostElement.classList.contains("f-node")&&!t.hostElement.classList.contains("f-group")).map(t=>t.hostElement.id)}static \u0275fac=function(e){return new(e||In)};static \u0275prov=o.wxM({token:In,factory:In.\u0275fac})};return n=(0,d.UN)([f(Lo)],n),n})();class js{nodes;connections;constructor(i,t){this.nodes=i,this.connections=t}}let Ef=(()=>{let n=class _n{fDataContext;fDraggableDataContext;constructor(t,e){this.fDataContext=t,this.fDraggableDataContext=e}handle(t){this.fDraggableDataContext.selectedItems.forEach(e=>{e.deselect()}),this.fDraggableDataContext.selectedItems=[],t.nodes.forEach(e=>{const s=this.fDataContext.fNodes.find(r=>r.fId===e);s&&(s.select(),this.fDraggableDataContext.selectedItems.push(s))}),t.connections.forEach(e=>{const s=this.fDataContext.fConnections.find(r=>r.fId===e);s&&(s.select(),this.fDraggableDataContext.selectedItems.push(s))}),this.fDraggableDataContext.isSelectedChanged=!0}static \u0275fac=function(e){return new(e||_n)(o.CoB(l),o.CoB(v))};static \u0275prov=o.wxM({token:_n,factory:_n.\u0275fac})};return n=(0,d.UN)([f(js)],n),n})();class tr{}let yf=(()=>{let n=class Nn{fDataContext;fDraggableDataContext;constructor(t,e){this.fDataContext=t,this.fDraggableDataContext=e}handle(t){this.fDraggableDataContext.selectedItems.forEach(e=>{e.deselect()}),this.fDraggableDataContext.selectedItems=[],this.fDataContext.fNodes.forEach(e=>{e.select(),this.fDraggableDataContext.selectedItems.push(e)}),this.fDataContext.fConnections.forEach(e=>{e.select(),this.fDraggableDataContext.selectedItems.push(e)}),this.fDraggableDataContext.isSelectedChanged=!0}static \u0275fac=function(e){return new(e||Nn)(o.CoB(l),o.CoB(v))};static \u0275prov=o.wxM({token:Nn,factory:Nn.\u0275fac})};return n=(0,d.UN)([f(tr)],n),n})();class ko{fNode;constructor(i){this.fNode=i}}class er{fItemsContainer;allElements;elementsThatShouldBeInFront;targetIndex;constructor(i,t,e,s){this.fItemsContainer=i,this.allElements=t,this.elementsThatShouldBeInFront=e,this.targetIndex=s}}let Mf=(()=>{let n=class Rn{handle(t){const e=[];for(let s=t.targetIndex+1;s<t.allElements.length;s++){const r=t.allElements[s];t.elementsThatShouldBeInFront.includes(r)||e.push(r)}e.forEach(s=>{t.fItemsContainer.removeChild(s),t.fItemsContainer.insertBefore(s,t.allElements[t.targetIndex])})}static \u0275fac=function(e){return new(e||Rn)};static \u0275prov=o.wxM({token:Rn,factory:Rn.\u0275fac})};return n=(0,d.UN)([f(er)],n),n})();class Rt{item;itemContainer;constructor(i,t){this.item=i,this.itemContainer=t}}class it{fId;constructor(i){this.fId=i}}let If=(()=>{let n=class Pn{fComponentsStore;constructor(t){this.fComponentsStore=t}handle(t){return this.getChildrenNodes(t.fId)}getChildrenNodes(t,e=new Set){if(e.has(t))throw new Error("Circular reference detected in the node hierarchy. Node id: "+t);e.add(t);const s=this.fComponentsStore.fNodes.filter(r=>r.fParentId===t);return s.forEach(r=>{s.push(...this.getChildrenNodes(r.fId,e))}),s}static \u0275fac=function(e){return new(e||Pn)(o.CoB(l))};static \u0275prov=o.wxM({token:Pn,factory:Pn.\u0275fac})};return n=(0,d.UN)([f(it)],n),n})(),_f=(()=>{let n=class Fn{fComponentsStore;fMediator;get fGroupsContainer(){return this.fComponentsStore.fCanvas.fGroupsContainer.nativeElement}get fNodesContainer(){return this.fComponentsStore.fCanvas.fNodesContainer.nativeElement}get fConnectionsContainer(){return this.fComponentsStore.fCanvas.fConnectionsContainer.nativeElement}constructor(t,e){this.fComponentsStore=t,this.fMediator=e}handle(t){switch(t.itemContainer){case this.fGroupsContainer:this.handleGroup(t);break;case this.fNodesContainer:this.handleNode(t);break;case this.fConnectionsContainer:this.handleConnection(t);break;default:throw new Error("Unknown container")}}handleGroup(t){const e=this.getChildrenNodesAndGroups(t.item.fId),s=this.getChildrenGroups(e);this.updateLayers(this.fGroupsContainer,t.item.hostElement,s);const r=this.getChildrenNodes(e);r.length&&this.updateLayers(this.fNodesContainer,r[0],r)}handleNode(t){const e=this.getChildrenNodesAndGroups(t.item.fId),s=this.getChildrenNodes(e);this.updateLayers(t.itemContainer,t.item.hostElement,s)}handleConnection(t){this.updateLayers(t.itemContainer,t.item.hostElement,[])}updateLayers(t,e,s){const r=Array.from(t.children),a=r.findIndex(c=>c===e);this.isAnythingNeedToBeMoved(r,a,s)&&this.fMediator.send(new er(t,r,s,a))}isAnythingNeedToBeMoved(t,e,s){for(let r=e+1;r<t.length;r++)if(!s.includes(t[r]))return!0;return!1}getChildrenGroups(t){const e=Array.from(this.fGroupsContainer.children);return t.filter(s=>this.fGroupsContainer.contains(s)).sort((s,r)=>e.indexOf(s)-e.indexOf(r))}getChildrenNodes(t){const e=Array.from(this.fNodesContainer.children);return t.filter(s=>this.fNodesContainer.contains(s)).sort((s,r)=>e.indexOf(s)-e.indexOf(r))}getChildrenNodesAndGroups(t){return this.fMediator.send(new it(t)).map(e=>e.hostElement)}static \u0275fac=function(e){return new(e||Fn)(o.CoB(l),o.CoB(h))};static \u0275prov=o.wxM({token:Fn,factory:Fn.\u0275fac})};return n=(0,d.UN)([f(Rt)],n),n})();const Nf=[Df,Sf,wf,Ef,yf,(()=>{let n=class bn{fDraggableDataContext;fMediator;constructor(t,e){this.fDraggableDataContext=t,this.fMediator=e}handle(t){this.selectNodeIfNotSelected(t.fNode),this.fMediator.send(new Rt(t.fNode,t.fNode.hostElement.parentElement))}selectNodeIfNotSelected(t){!this.fDraggableDataContext.selectedItems.includes(t)&&!t.fSelectionDisabled&&(this.fDraggableDataContext.selectedItems.push(t),t.select(),this.fDraggableDataContext.isSelectedChanged=!0)}static \u0275fac=function(e){return new(e||bn)(o.CoB(v),o.CoB(h))};static \u0275prov=o.wxM({token:bn,factory:bn.\u0275fac})};return n=(0,d.UN)([f(ko)],n),n})()];let Rf=(()=>{let n=class On{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);get _fSelectionChange(){return this._fComponentsStore.fDraggable.fSelectionChange}_fDraggableDataContext=(0,o.uUt)(v);handle(t){this._fDraggableDataContext.isSelectedChanged&&(this._emitSelectionChange(this._getSelection()),this._fDraggableDataContext.isSelectedChanged=!1,this._fMediator.send(new ot))}_getSelection(){return this._fMediator.send(new Lo)}_emitSelectionChange(t){this._fSelectionChange.emit(new rf(t.nodes,t.groups,t.connections))}static \u0275fac=function(e){return new(e||On)};static \u0275prov=o.wxM({token:On,factory:On.\u0275fac})};return n=(0,d.UN)([f(yo)],n),n})();class nr{}let Pf=(()=>{let n=class Tn{_fComponentsStore=(0,o.uUt)(l);get _hostElement(){return this._fComponentsStore.fDraggable.hostElement}_fDraggableDataContext=(0,o.uUt)(v);handle(t){this._hostElement.classList.remove("f-dragging"),this._fDraggableDataContext.reset()}static \u0275fac=function(e){return new(e||Tn)};static \u0275prov=o.wxM({token:Tn,factory:Tn.\u0275fac})};return n=(0,d.UN)([f(nr)],n),n})();class or{event;constructor(i){this.event=i}}let Ff=(()=>{let n=class An{_fComponentsStore=(0,o.uUt)(l);get _hostElement(){return this._fComponentsStore.fDraggable.hostElement}_fDraggableDataContext=(0,o.uUt)(v);handle(t){this._setDifferenceToDraggableItems(this._getDifferenceBetweenPointerAndPointerDown(t.event))}_setDifferenceToDraggableItems(t){this._fDraggableDataContext.draggableItems.forEach(e=>{e.onPointerMove({...t})})}_getDifferenceBetweenPointerAndPointerDown(t){return this._getPointerPositionInCanvas(t).div(this._fDraggableDataContext.onPointerDownScale).sub(this._fDraggableDataContext.onPointerDownPosition)}_getPointerPositionInCanvas(t){return C.fromPoint(t.getPosition()).elementTransform(this._hostElement)}static \u0275fac=function(e){return new(e||An)};static \u0275prov=o.wxM({token:An,factory:An.\u0275fac})};return n=(0,d.UN)([f(or)],n),n})();class ir{}let bf=(()=>{let n=class Bn{_fDraggableDataContext=(0,o.uUt)(v);handle(t){this._fDraggableDataContext.reset()}static \u0275fac=function(e){return new(e||Bn)};static \u0275prov=o.wxM({token:Bn,factory:Bn.\u0275fac})};return n=(0,d.UN)([f(ir)],n),n})();class sr{}class rr{}let Of=(()=>{let n=class Un{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);get _hostElement(){return this._fComponentsStore.fDraggable.hostElement}_fDraggableDataContext=(0,o.uUt)(v);handle(t){this._fDraggableDataContext.draggableItems.length>0&&(this._hostElement.classList.add("f-dragging"),this._fMediator.send(new yo))}static \u0275fac=function(e){return new(e||Un)};static \u0275prov=o.wxM({token:Un,factory:Un.\u0275fac})};return n=(0,d.UN)([f(rr)],n),n})(),Tf=(()=>{let n=class zn{_fMediator=(0,o.uUt)(h);_fDraggableDataContext=(0,o.uUt)(v);handle(t){this._callPrepareDragSequence(),this._fMediator.send(new rr)}_callPrepareDragSequence(){this._fDraggableDataContext.draggableItems.forEach(t=>{t.prepareDragSequence?.()})}static \u0275fac=function(e){return new(e||zn)};static \u0275prov=o.wxM({token:zn,factory:zn.\u0275fac})};return n=(0,d.UN)([f(sr)],n),n})();class ar{}const Af=[Kc,Rf,Pf,Ff,bf,Tf,xd,Of,(()=>{let n=class Gn{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fDraggable=void 0}static \u0275fac=function(e){return new(e||Gn)};static \u0275prov=o.wxM({token:Gn,factory:Gn.\u0275fac})};return n=(0,d.UN)([f(ar)],n),n})()];class cr{fComponent;constructor(i){this.fComponent=i}}let Bf=(()=>{let n=class Ln{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fFlow=t.fComponent}static \u0275fac=function(e){return new(e||Ln)};static \u0275prov=o.wxM({token:Ln,factory:Ln.\u0275fac})};return n=(0,d.UN)([f(cr)],n),n})();class Uf{}let zf=(()=>{let n=class kn{_fComponentsStore=(0,o.uUt)(l);handle(t){const e=this._fComponentsStore.fFlow;if(!e)throw new Error("Flow not found in store");return e}static \u0275fac=function(e){return new(e||kn)};static \u0275prov=o.wxM({token:kn,factory:kn.\u0275fac})};return n=(0,d.UN)([f(Uf)],n),n})();class Ho{}let Gf=(()=>{let n=class Hn{_fComponentsStore=(0,o.uUt)(l);handle(){return this._fComponentsStore.flowHost}static \u0275fac=function(e){return new(e||Hn)};static \u0275prov=o.wxM({token:Hn,factory:Hn.\u0275fac})};return n=(0,d.UN)([f(Ho)],n),n})();class dr{}let Lf=(()=>{let n=class Vn{_fComponentsStore=(0,o.uUt)(l);handle(t){return this._fComponentsStore.fConnections.map(this._mapToConnectionState)}_mapToConnectionState(t){return{id:t.fId,fOutputId:t.fOutputId,fInputId:t.fInputId,fType:t.fType,fBehavior:t.fBehavior,isSelected:t.isSelected()}}static \u0275fac=function(e){return new(e||Vn)};static \u0275prov=o.wxM({token:Vn,factory:Vn.\u0275fac})};return n=(0,d.UN)([f(dr)],n),n})();class Vo{type;constructor(i){this.type=i}}let kf=(()=>{let n=class Wn{fComponentsStore;constructor(t){this.fComponentsStore=t}handle(t){return this.fComponentsStore.fNodes.filter(e=>e instanceof t.type).map(e=>({id:e.fId,parent:e.fParentId,position:e.position,size:e.size,fOutputs:this._getOutputs(e.hostElement),fInputs:this._getInputs(e.hostElement),isSelected:e.isSelected()}))}_getOutputs(t){return this.fComponentsStore.fOutputs.filter(e=>t.contains(e.hostElement)).map(e=>({id:e.fId,fConnectableSide:e.fConnectableSide}))}_getInputs(t){return this.fComponentsStore.fInputs.filter(e=>t.contains(e.hostElement)).map(e=>({id:e.fId,fConnectableSide:e.fConnectableSide}))}static \u0275fac=function(e){return new(e||Wn)(o.CoB(l))};static \u0275prov=o.wxM({token:Wn,factory:Wn.\u0275fac})};return n=(0,d.UN)([f(Vo)],n),n})();class fr{}const Hf=[(()=>{let n=class $n{_fMediator=(0,o.uUt)(h);_fComponentsStore=(0,o.uUt)(l);handle(t){return{position:this._getCanvasPosition(this._fComponentsStore.fCanvas.transform),scale:this._fComponentsStore.fCanvas.transform.scale,nodes:this._fMediator.send(new Vo(mt)),groups:this._fMediator.send(new Vo(Ui)),connections:this._fMediator.send(new dr)}}_getCanvasPosition(t){return u.sum(t.position,t.scaledPosition)}static \u0275fac=function(e){return new(e||$n)};static \u0275prov=o.wxM({token:$n,factory:$n.\u0275fac})};return n=(0,d.UN)([f(fr)],n),n})(),kf,Lf];class lr{}const Wf=[Bf,zf,Gf,...Hf,(()=>{let n=class qn{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fFlow=void 0}static \u0275fac=function(e){return new(e||qn)};static \u0275prov=o.wxM({token:qn,factory:qn.\u0275fac})};return n=(0,d.UN)([f(lr)],n),n})()];class ur{fComponent;constructor(i){this.fComponent=i}}let $f=(()=>{let n=class Xn{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fLineAlignment=t.fComponent}static \u0275fac=function(e){return new(e||Xn)};static \u0275prov=o.wxM({token:Xn,factory:Xn.\u0275fac})};return n=(0,d.UN)([f(ur)],n),n})();class hr{}const qf=[$f,(()=>{let n=class Zn{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.fLineAlignment=void 0}static \u0275fac=function(e){return new(e||Zn)};static \u0275prov=o.wxM({token:Zn,factory:Zn.\u0275fac})};return n=(0,d.UN)([f(hr)],n),n})()];class Wo{fComponent;constructor(i){this.fComponent=i}}let Xf=(()=>{let n=class Yn{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.addComponent(this._fComponentsStore.fNodes,t.fComponent)}static \u0275fac=function(e){return new(e||Yn)};static \u0275prov=o.wxM({token:Yn,factory:Yn.\u0275fac})};return n=(0,d.UN)([f(Wo)],n),n})();class Pt{}let Zf=(()=>{let n=class Kn{_fComponentsStore=(0,o.uUt)(l);handle(t){return p.union(this._getNodesRects())}_getNodesRects(){return this._fComponentsStore.fNodes.map(t=>this._getElementRect(t.hostElement))}_getElementRect(t){return p.fromElement(t)}static \u0275fac=function(e){return new(e||Kn)};static \u0275prov=o.wxM({token:Kn,factory:Kn.\u0275fac})};return n=(0,d.UN)([f(Pt)],n),n})();class gr{fNodes;constructor(i){this.fNodes=i}}let Yf=(()=>{let n=class Qn{_fComponentsStore=(0,o.uUt)(l);handle(t){return p.union(this._getNodesRects(t.fNodes||this._fComponentsStore.fNodes))}_getNodesRects(t){return t.map(e=>this._getElementRect(e,p.fromElement(e.hostElement)))}_getElementRect(t,e){return p.initialize(t.position.x,t.position.y,e.width,e.height)}static \u0275fac=function(e){return new(e||Qn)};static \u0275prov=o.wxM({token:Qn,factory:Qn.\u0275fac})};return n=(0,d.UN)([f(gr)],n),n})();class $o{fNode;rect;constructor(i,t){this.fNode=i,this.rect=t}}let Kf=(()=>{let n=class Jn{fBrowser;constructor(t){this.fBrowser=t}handle(t){return t.fNode.fIncludePadding?this.getPaddingData(t.fNode,t.rect):[0,0,0,0]}getPaddingData(t,e){const s=this.fBrowser.window.getComputedStyle(t.hostElement);return[this.fBrowser.toPixels(s.paddingLeft,e.width,e.height,s.fontSize),this.fBrowser.toPixels(s.paddingTop,e.width,e.height,s.fontSize),this.fBrowser.toPixels(s.paddingRight,e.width,e.height,s.fontSize),this.fBrowser.toPixels(s.paddingBottom,e.width,e.height,s.fontSize)]}static \u0275fac=function(e){return new(e||Jn)(o.CoB(y))};static \u0275prov=o.wxM({token:Jn,factory:Jn.\u0275fac})};return n=(0,d.UN)([f($o)],n),n})();class Qf{}let Jf=(()=>{let n=class jn{_fComponentsStore=(0,o.uUt)(l);handle(t){return this._fComponentsStore.fNodes}static \u0275fac=function(e){return new(e||jn)};static \u0275prov=o.wxM({token:jn,factory:jn.\u0275fac})};return n=(0,d.UN)([f(Qf)],n),n})();class qo{fNode;constructor(i){this.fNode=i}}let jf=(()=>{let n=class to{_fComponentsStore=(0,o.uUt)(l);handle(t){return this._getParentNodes(t.fNode,new Set,[])}_getParentNodes(t,e,s){if(e.has(t.fId))throw new Error("Circular reference detected in the node hierarchy. Node id: "+t.fId);e.add(t.fId);const r=this._fComponentsStore.fNodes.find(a=>a.fId===t.fParentId);return r?(s.push(r),this._getParentNodes(r,e,s)):s}static \u0275fac=function(e){return new(e||to)};static \u0275prov=o.wxM({token:to,factory:to.\u0275fac})};return n=(0,d.UN)([f(qo)],n),n})();class Xo{fComponent;destroyRef;constructor(i,t){this.fComponent=i,this.destroyRef=t}}let tl=(()=>{let n=class eo{_fMediator=(0,o.uUt)(h);handle(t){const{hostElement:e,connectors:s,stateChanges:r}=t.fComponent;new L(new va(e),r).pipe(n=>(n(),n),gt(10)).listen(t.destroyRef,()=>{this._calculateConnectorsConnectableSide(s,e),this._fMediator.send(new et)})}_calculateConnectorsConnectableSide(t,e){t.forEach(s=>{s.fConnectableSide=(new Ka).handle(new Qa(s,e))})}static \u0275fac=function(e){return new(e||eo)};static \u0275prov=o.wxM({token:eo,factory:eo.\u0275fac})};return n=(0,d.UN)([f(Xo)],n),n})();class Zo{fComponent;constructor(i){this.fComponent=i}}const el=[Xf,Zf,Yf,Kf,Jf,jf,tl,(()=>{let n=class no{_fComponentsStore=(0,o.uUt)(l);handle(t){this._fComponentsStore.removeComponent(this._fComponentsStore.fNodes,t.fComponent)}static \u0275fac=function(e){return new(e||no)};static \u0275prov=o.wxM({token:no,factory:no.\u0275fac})};return n=(0,d.UN)([f(Zo)],n),n})()];class pr{position;constructor(i){this.position=i}}let nl=(()=>{let n=class oo{_fComponentsStore=(0,o.uUt)(l);get _transform(){return this._fComponentsStore.fCanvas.transform}handle(t){return C.fromPoint(t.position).elementTransform(this._fComponentsStore.flowHost).sub(this._transform.scaledPosition).sub(this._transform.position).div(this._transform.scale)}static \u0275fac=function(e){return new(e||oo)};static \u0275prov=o.wxM({token:oo,factory:oo.\u0275fac})};return n=(0,d.UN)([f(pr)],n),n})();class mr{}let ol=(()=>{let n=class io{fComponentsStore;fMediator;fBrowser;get fGroupsContainer(){return this.fComponentsStore.fCanvas.fGroupsContainer.nativeElement}get fNodesContainer(){return this.fComponentsStore.fCanvas.fNodesContainer.nativeElement}get fNodesContainerElements(){return Array.from(this.fNodesContainer.children)}constructor(t,e,s){this.fComponentsStore=t,this.fMediator=e,this.fBrowser=s}handle(t){this.getGroups().forEach(e=>{this.moveChildrenNodes(this.getSortedChildrenNodes(e))})}getGroups(){return this.fComponentsStore.fNodes.filter(t=>this.fGroupsContainer.contains(t.hostElement))}getSortedChildrenNodes(t){const e=this.fNodesContainerElements;return this.getChildrenNodes(t.fId).sort((s,r)=>e.indexOf(s)-e.indexOf(r))}getChildrenNodes(t){return this.fMediator.send(new it(t)).filter(e=>this.fNodesContainer.contains(e.hostElement)).map(e=>e.hostElement)}moveChildrenNodes(t){const e=this.fBrowser.document.createDocumentFragment();t.forEach(s=>{e.appendChild(s)}),this.fNodesContainer.appendChild(e)}static \u0275fac=function(e){return new(e||io)(o.CoB(l),o.CoB(h),o.CoB(y))};static \u0275prov=o.wxM({token:io,factory:io.\u0275fac})};return n=(0,d.UN)([f(mr)],n),n})();class Yo{fItemsContainer;constructor(i){this.fItemsContainer=i}}let il=(()=>{let n=class so{fComponentsStore;fMediator;fBrowser;fItemsContainer;get fItemsFromContainer(){return Array.from(this.fItemsContainer.children)}constructor(t,e,s){this.fComponentsStore=t,this.fMediator=e,this.fBrowser=s}handle(t){this.fItemsContainer=t.fItemsContainer,this.getItems().forEach(e=>{this.moveChildrenItems(this.getSortedChildrenItems(e),e)})}getItems(){return this.fComponentsStore.fNodes.filter(t=>this.fItemsContainer.contains(t.hostElement))}getSortedChildrenItems(t){const e=this.fItemsFromContainer,s=e.indexOf(t.hostElement);return this.getChildrenGroups(t.fId).filter(r=>e.indexOf(r)<s).sort((r,a)=>e.indexOf(r)-e.indexOf(a))}getChildrenGroups(t){return this.fMediator.send(new it(t)).filter(e=>this.fItemsContainer.contains(e.hostElement)).map(e=>e.hostElement)}moveChildrenItems(t,e){let s=e.hostElement.nextElementSibling;const r=this.fBrowser.document.createDocumentFragment();t.forEach(a=>{r.appendChild(a)}),this.fItemsContainer.insertBefore(r,s)}static \u0275fac=function(e){return new(e||so)(o.CoB(l),o.CoB(h),o.CoB(y))};static \u0275prov=o.wxM({token:so,factory:so.\u0275fac})};return n=(0,d.UN)([f(Yo)],n),n})();class Cr{}function W(n,i){return i.document.createElementNS("http://www.w3.org/2000/svg",n)}const al=[...za,...Vc,..._a,...Yc,...Af,...Wf,...qf,...el,ma,...Nf,If,$a,nl,(()=>{let n=class ro{fMediator;fComponentsStore;constructor(t,e){this.fMediator=t,this.fComponentsStore=e}handle(t){this.fComponentsStore.fCanvas&&(this.fMediator.send(new Yo(this.fComponentsStore.fCanvas.fGroupsContainer.nativeElement)),this.fMediator.send(new mr),this.fMediator.send(new Yo(this.fComponentsStore.fCanvas.fNodesContainer.nativeElement)))}static \u0275fac=function(e){return new(e||ro)(o.CoB(h),o.CoB(l))};static \u0275prov=o.wxM({token:ro,factory:ro.\u0275fac})};return n=(0,d.UN)([f(Cr)],n),n})(),il,ol,_f,Mf];new o.UbH("F_BACKGROUND");class gl{position;scale;constructor(i,t){this.position=i,this.scale=t}}const pl=new o.UbH("F_CANVAS");let ml=(()=>{class n{transform=j.default();getPosition(){return this.transform.position}setPosition(t){this.transform.position=t}emitCanvasChangeEvent(){this.fCanvasChange.emit(new gl(u.sum(this.transform.position,this.transform.scaledPosition),this.transform.scale))}static \u0275fac=function(e){return new(e||n)};static \u0275dir=o.Sc5({type:n})}return n})(),vr=(()=>{class n extends ml{_elementReference=(0,o.uUt)(o.GMv);fCanvasChange=new o._w7;set position(t){this._fMediator.send(new Si(this.transform,t))}set scale(t){this._fMediator.send(new wi(this.transform,t))}get hostElement(){return this._elementReference.nativeElement}fGroupsContainer;fNodesContainer;fConnectionsContainer;_fMediator=(0,o.uUt)(h);ngOnInit(){this._fMediator.send(new Ci(this))}redraw(){this._fMediator.send(new mo(this.transform)),this.hostElement.setAttribute("style",`transform: ${j.toString(this.transform)}`),this._fMediator.send(new ot)}redrawWithAnimation(){this._fMediator.send(new mo(this.transform)),this.hostElement.setAttribute("style",`transition: transform ${function rl(){return/android|iPad|iPhone|iPod/i.test(navigator.userAgent||navigator.vendor||window.opera)}()?80:150}ms ease-in-out; transform: ${j.toString(this.transform)}`),Ei(this.hostElement,()=>this.redraw())}centerGroupOrNode(t,e=!0){this._fMediator.send(new vi(t,e))}fitToScreen(t=u.initialize(),e=!0){this._fMediator.send(new xi(t,e))}resetScaleAndCenter(t=!0){this._fMediator.send(new Ii(t))}setZoom(t,e=u.initialize()){this._fMediator.send(new _i(t,e))}resetZoom(){this._fMediator.send(new Mi)}ngOnDestroy(){this._fMediator.send(new yi)}static \u0275fac=(()=>{let t;return function(s){return(t||(t=o.otF(n)))(s||n)}})();static \u0275cmp=o.In1({type:n,selectors:[["f-canvas"]],viewQuery:function(e,s){if(1&e&&(o.CC$(da,7),o.CC$(fa,7),o.CC$(la,7)),2&e){let r;o.wto(r=o.Gqi())&&(s.fGroupsContainer=r.first),o.wto(r=o.Gqi())&&(s.fNodesContainer=r.first),o.wto(r=o.Gqi())&&(s.fConnectionsContainer=r.first)}},hostAttrs:[1,"f-component","f-canvas"],inputs:{position:"position",scale:"scale"},outputs:{fCanvasChange:"fCanvasChange"},exportAs:["fComponent"],features:[o.M5G([{provide:pl,useExisting:n}]),o.eg9],ngContentSelectors:ha,decls:12,vars:0,consts:[["fGroupsContainer",""],["fConnectionsContainer",""],["fNodesContainer",""]],template:function(e,s){1&e&&(o.kPM(ua),o.SAx(0),o.I0R(1,"div",null,0),o._Xx(3),o.C$Y(),o.I0R(4,"div",null,1),o._Xx(6,1),o._Xx(7,2),o._Xx(8,3),o.C$Y(),o.I0R(9,"div",null,2),o._Xx(11,4),o.C$Y(),o.k70())},styles:["[_nghost-%COMP%]{position:absolute;overflow:visible;width:100%;height:100%;left:0;top:0;transform-origin:0 0;pointer-events:none}.f-scaled-animate[_nghost-%COMP%]{transition:transform .09s}"],changeDetection:0})}return n})();const Cl=new o.UbH("F_FLOW");class vl{}let xl=0,Dr=(()=>{class n extends vl{fBrowser;_destroyRef=(0,o.uUt)(o.eM9);_fMediator=(0,o.uUt)(h);_elementReference=(0,o.uUt)(o.GMv);fId="f-flow-"+xl++;get hostElement(){return this._elementReference.nativeElement}fLoaded=new o._w7;_isLoaded=!1;constructor(t){super(),this.fBrowser=t}ngOnInit(){this._fMediator.send(new cr(this))}ngAfterContentInit(){this.fBrowser.isBrowser()&&(this._listenCountChanges(),this._listenDataChanges())}_listenCountChanges(){this._fMediator.send(new hi).listen(this._destroyRef,()=>{this._fMediator.send(new Cr)})}_listenDataChanges(){this._fMediator.send(new ui).listen(this._destroyRef,()=>{this._fMediator.send(new qi),this._emitLoaded()})}_emitLoaded(){this._isLoaded||(this._isLoaded=!0,this.fLoaded.emit())}redraw(){this._fMediator.send(new et)}reset(){this._isLoaded=!1}getNodesBoundingBox(){return this._fMediator.send(new gr)}getSelection(){return this._fMediator.send(new Lo)}getPositionInFlow(t){return this._fMediator.send(new pr(t))}getState(){return this._fMediator.send(new fr)}selectAll(){this._fMediator.send(new tr)}select(t,e){this._fMediator.send(new js(t,e))}clearSelection(){this._fMediator.send(new Qs)}ngOnDestroy(){this._fMediator.send(new lr)}static \u0275fac=function(e){return new(e||n)(o.GI1(y))};static \u0275cmp=o.In1({type:n,selectors:[["f-flow"]],hostAttrs:[1,"f-component","f-flow"],hostVars:1,hostBindings:function(e,s){2&e&&o.e48("id",s.fId)},inputs:{fId:[o.Wk5.None,"fFlowId","fId"]},outputs:{fLoaded:"fLoaded"},features:[o.M5G([h,...wa,v,ut,...al,...xf,{provide:Cl,useExisting:n}]),o.eg9],ngContentSelectors:pa,decls:7,vars:0,template:function(e,s){1&e&&(o.kPM(ga),o.SAx(0),o._Xx(1),o._Xx(2,1),o._Xx(3,2),o._Xx(4,3),o._Xx(5,4),o._Xx(6,5),o.k70())},styles:["[_nghost-%COMP%]{display:block;position:relative;width:100%;height:100%;overflow:hidden;pointer-events:all;-webkit-user-select:none;user-select:none;touch-action:none}"],changeDetection:0})}return n})();new o.UbH("F_ZOOM");let wl=(()=>{class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=o.a4G({type:n});static \u0275inj=o.s3X({imports:[A.MD]})}return n})();const El=()=>({x:24,y:24}),yl=()=>({x:244,y:24}),Il=[{path:"**",component:yr.i,children:[{path:"**",component:(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275cmp=o.In1({type:n,selectors:[["app-test"]],decls:7,vars:4,consts:[["fDraggable",""],["fOutputId","output1","fInputId","input1"],["fNode","","fDragHandle","","fNodeOutput","","fOutputId","output1","fOutputConnectableSide","right",3,"fNodePosition"],["fNode","","fDragHandle","","fNodeInput","","fInputId","input1","fInputConnectableSide","left",3,"fNodePosition"]],template:function(e,s){1&e&&(o.I0R(0,"f-flow",0)(1,"f-canvas"),o.wR5(2,"f-connection",1),o.I0R(3,"div",2),o.OEk(4," Drag me "),o.C$Y(),o.I0R(5,"div",3),o.OEk(6," Drag me "),o.C$Y()()()),2&e&&(o.yG2(3),o.E7m("fNodePosition",o.q4q(2,El)),o.yG2(2),o.E7m("fNodePosition",o.q4q(3,yl)))},dependencies:[vr,Vi,zi,ki,Dr,mt,Ti,sf]})}}return n})()}]}];let _l=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=o.a4G({type:n})}static{this.\u0275inj=o.s3X({imports:[ti.qQ.forChild(Il),ti.qQ]})}}return n})();var Nl=G(7312);let Rl=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=o.a4G({type:n})}static{this.\u0275inj=o.s3X({imports:[wl,A.MD,Nl.G,_l]})}}return n})()}}]);